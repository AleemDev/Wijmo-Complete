/*
 *
 * Wijmo Library 0.8.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){a.widget("ui.wijgrid",{options:{allowColSizing:false,allowKeyboardNavigation:false,allowPaging:false,allowSorting:false,allowEditing:false,columns:[],culture:"",customFilterOperators:[],data:null,filterOperatorsSortMode:"alphabeticalCustomFirst",groupIndent:10,nullString:undefined,pageIndex:0,pageSize:10,pagerSettings:{mode:"numeric",pageButtonCount:10,position:"bottom"},scrollMode:"none",selectionMode:"singleRow",showFilter:false,showRowHeader:false,staticRowIndex:-1,key_reverse:false,key_pageSize:10,aftercelledit:null,aftercellupdate:null,beforecelledit:null,beforecellupdate:null,currencychanging:null,currencychanged:null,filteroperatorslistshowing:null,groupaggregate:null,grouptext:null,invalidcellvalue:null,pageindexchanging:null,pageindexchanged:null,selectionchanged:null,sorting:null,sorted:null},_staticColumnIndex:-1,_dataLoading:function(){this.element.addClass("ui-wijgrid-loading")},_dataLoaded:function(a){this.element.removeClass("ui-wijgrid-loading");this._requiresDataBinding=false;this._doRefresh(a)},_ensureControl:function(a){if(this._initialized){this._ownerise(false);this._widgetsToOptions()}this._ownerise(true);if(this._requiresDataBinding){if(typeof a==="number")a|=2;else if(a.updateMode)a.updateMode|=2;this._dataStore.load(a)}else this._doRefresh(a)},_doRefresh:function(f){var k=255;if(typeof f==="number")k=f;else if(typeof f.updateMode==="number")k=f.updateMode;if(!this._initialized)try{this.element.empty();a.ui.wijgrid.traverse(this.options.columns,function(a){a.isBand=a.columns||a.clientType==="c1band"});var C=(new a.ui.wijgrid.bandProcessor)._getVisibleHeight(this.options.columns,true),d=a.ui.wijgrid.getAllLeaves(this.options.columns),i=this._dataStore.getFieldsCount(),p=this._dataStore.dataMode()===a.ui.wijgrid.dataMode.dom,g=null;if(p){if(this._field("thead")&&this._field("thead").length)g=this._field("thead")[0];i=Math.max(g?g.length:0,i)}var s=i-d.length;if(s>0)for(var c=0;c<s;c++){var x=a.extend(true,{},a.ui.c1basefield.prototype.options,a.ui.c1field.prototype.options),v=a.extend({dynamic:true,isLeaf:true},x);this.options.columns.push(v)}this._extendColumnOptions();a.ui.wijgrid.setTraverseIndex(this.options.columns);d=[];a.ui.wijgrid.traverse(this.options.columns,a.proxy(function(a){a.isLeaf&&!a.isBand&&d.push(a)},this));for(var h=this._dataStore.getFieldsNames(),o=[],c=0,m=d.length;c<m;c++){var b=d[c],e=b.dataKey;if(a.ui.wijgrid.validDataKey(e)){if(typeof e==="string")e=e.toLowerCase();if(h[e])delete h[e]}else o.push(b)}var c=0;for(var B in h){var e=h[B];if(!isNaN(e))e=parseInt(e);var b=o[c++];if(b)b.dataKey=e}for(var c=0,m=d.length;c<m;c++){var b=d[c];if(b.headerText===undefined){var u=false;if(p){var r=typeof b.dataKey==="number"?b.dataKey:c;if(r<g.length){b.headerText=g[r];u=true}}if(!u)if(a.ui.wijgrid.validDataKey(b.dataKey))b.headerText=""+b.dataKey}}}finally{this._initialized=true}var j=[];this.options.showRowHeader&&j.push(a.extend({dynamic:true,clientType:"c1basefield",dynamic:true,dataIndex:-1,travIdx:-1,parentVis:true,visible:true,isLeaf:true,isBand:false,owner:this},a.ui.c1basefield.prototype.options,{allowSizing:false}));a.each(this.options.columns,function(b,a){j.push(a)});var d=[];this._field("spanTable",(new a.ui.wijgrid.bandProcessor).generateSpanTable(j,d));this._field("leaves",d);var w=0,y=0;this._field("visibleLeaves",a.grep(d,function(b,c){b.leavesIdx=c;if(a.ui.wijgrid.validDataKey(b.dataKey))b.dataIndex=y++;else b.dataIndex=-1;if(b.parentVis){b.visLeavesIdx=w++;return true}return false}));var t=this._dataStore.getDataSlice();this.dataTable=[];for(var n=0,A=t.length;n<A;n++){for(var z=t[n],l=[],c=0,m=d.length;c<m;c++){var b=d[c];if(a.ui.wijgrid.validDataKey(b.dataKey)){var q=z[b.dataKey];l.push({value:q.value,originalRowIndex:q.originalRowIndex})}}l.rowType="data";this.dataTable.push(l)}this._refresh(k);f&&f.callback&&f.callback()},_create:function(){this.rendered=false;this._requiresDataBinding=true;this._dataStore=new a.ui.wijgrid.dataStore(this);if(!this.element.is("div"))throw"invalid markup";this.element.addClass("ui-widget ui-wijgrid ui-widget-content ui-corner-all");this.filterOperatorsCache=new a.ui.wijgrid.filterOperatorsCache;this._registerFilterOperator(a.ui.wijgrid.embeddedFilters);this.options.disabled&&this.disable()},_init:function(){__wijReadOptionEvents(["currencychanging","currencychanged","filteroperatorslistshowing","groupaggregate","grouptext","pageindexchanging","pageindexchanged","selectionchanged","sorting","sorted","beforecelledit","beforecellupdate","aftercellupdate","aftercelledit","invalidcellvalue"],this);this.$topPagerDiv=null;this.$bottomPagerDiv=null;this.filterOperatorsCache.removeCustom();a.each(this.options.customFilterOperators,function(b,a){a.custom=true});this._registerFilterOperator(this.options.customFilterOperators);this._field("closestCulture",a.findClosestCulture(this.options.culture));this.options.data===null&&!this._field("thead")&&this._field("thead",(new a.ui.wijgrid.htmlTableDataReader(this)).readTHead());this._initialized=false;this._ensureControl({updateMode:255})},_setOption:function(d,b){var f=this["_preset_"+d],c=this.options[d];if(f!==undefined)b=f.apply(this,[b,c]);var g=b!==c;a.Widget.prototype._setOption.apply(this,arguments);if(g){var e=this["_postset_"+d];e!==undefined&&e.apply(this,[b,c])}},destroy:function(){var b;(b=this._field("selectionui"))&&b.dispose();(b=this._field("resizer"))&&b.dispose();a.ui.wijgrid.iterateChildrenWidgets(this.element,function(b,a){a.destroy()});this.element.empty();this.element.removeClass("ui-widget ui-wijgrid ui-widget-content ui-corner-all");a.Widget.prototype.destroy.apply(this,arguments)},columns:function(){return this._field("columns")||[]},currency:function(c,d){if(arguments.length===0){var b=this._field("currency");!b&&this._field("currency",b=a.ui.wijgrid.cellInfo.prototype.outsideValue);return b}else{var b=arguments.length===1?c._clone():new a.ui.wijgrid.cellInfo(c,d);if(!b.isEqual(a.ui.wijgrid.cellInfo.prototype.outsideValue)){if(!b._isValid())throw"invalid arguments";b._clip(this._getDataCellsRange())}b._setGridView(this);this._changeCurrency(b);return this._field("currency")}},data:function(){return this._dataStore.dataSource().items},selection:function(){var b=this._field("selection");!b&&this._field("selection",b=new a.ui.wijgrid.selection(this));return b},beginEdit:function(){return this._beginEditInternal(null)},endEdit:function(){return this._endEditInternal(null)},pageCount:function(){return this._field("pageCount")||1},_headerRows:function(){var b=this._field("headerRowsAccessor");if(!b){var c=this.options.showFilter?1:0;this._field("headerRowsAccessor",b=new a.ui.wijgrid.rowAccessor(this._field("view"),1,0,c))}return b},_filterRow:function(){if(this.options.showFilter){var b=new a.ui.wijgrid.rowAccessor(this._field("view"),1,0,0);return b.item(b.length()-1)}return null},_rows:function(){var b=this._field("rowsAccessor");!b&&this._field("rowsAccessor",b=new a.ui.wijgrid.rowAccessor(this._field("view"),2,0,0));return b},_selectionui:function(){var b=this._field("selectionui");!b&&this._field("selectionui",b=new a.ui.wijgrid.selectionui(this));return b},_registerFilterOperator:function(c){if(c&&a.isArray(c))for(var b=0,d=c.length;b<d;b++)this.filterOperatorsCache.add(c[b]);else for(var b=0,d=arguments.length;b<d;b++)this.filterOperatorsCache.add(arguments[b])},_postset_allowSorting:function(){this._ensureControl(1|2)},_postset_columns:function(){throw"read-only";},_postset_allowPaging:function(){this._requiresDataBinding=true;this._ensureControl(255)},_postset_culture:function(){throw"read-only";},_postset_customFilterOperators:function(b){this.filterOperatorsCache.removeCustom();a.each(this.options.customFilterOperators,function(b,a){a.custom=true});this._registerFilterOperator(b)},_postset_data:function(){throw"read-only";},_postset_disabled:function(b){a.ui.wijgrid.iterateChildrenWidgets(this.element,function(c,a){a.option("disabled",b)})},_postset_groupIndent:function(){this._ensureControl(2)},_preset_pageIndex:function(a,c){if(isNaN(a))throw"out of range";var b=this.pageCount();if(a>b-1)a=b-1;if(a<0)a=0;if(this.options.allowPaging&&a!==c)if(!this._trigger("pageindexchanging",null,{newPageIndex:a}))a=c;return a},_postset_pageIndex:function(){if(this.options.allowPaging){this._requiresDataBinding=true;this._ensureControl({updateMode:2|4,callback:a.proxy(function(){this._trigger("pageindexchanged",null)},this)})}},_preset_pageSize:function(a){if(isNaN(a))throw"out of range";if(a<=0)a=1;return a},_postset_pageSize:function(){this.options.pageIndex=0;if(this.options.allowPaging){this._requiresDataBinding=true;this._ensureControl(2|4)}},_postset_pagerSettings:function(){this._ensureControl(4)},_postset_scrollMode:function(b,a){if(b==="none"||a==="none")this._ensureControl(0);else this._field("view").refreshPanel()},_postset_selectionMode:function(){var b=this.selection(),c=this.currency();b.beginUpdate();b.clear();c&&c._isValid()&&b._selectRange(new a.ui.wijgrid.cellInfoRange(c,c),false,false,0,null);b.endUpdate()},_postset_showFilter:function(){this._ensureControl(8)},_postset_showRowHeader:function(){this._ensureControl(1|2)},_postset_staticRowIndex:function(){this.options.scrollMode!=="none"&&this._ensureControl(0)},_columnWidgetsFactory:function(d,b){var c,e=b.clientType;if(!e&&b.isBand)e="c1band";b=a.extend({owner:this},b,{disabled:this.options.disabled});switch(e){case"c1basefield":c=d.c1basefield(b);break;case"c1boundfield":c=d.c1boundfield(b);break;case"c1band":c=d.c1band(b);break;default:c=d.c1field(b)}return c},_field:function(a,b){return arguments.length===1?this.element.data(a):this.element.data(a,b)},_extendColumnOptions:function(){a.ui.wijgrid.traverse(this.options.columns,a.proxy(function(b){b.isBand=b.columns||b.clientType==="c1band";a.ui.wijgrid.shallowMerge(b,a.ui.c1basefield.prototype.options);if(!b.isBand){a.ui.wijgrid.shallowMerge(b,a.ui.c1field.prototype.options);if(!b.clientType)b.clientType="c1field";switch(b.dataType){case undefined:case"string":if(!b.dataParser)b.dataParser=wijgridStringParser;break;case"boolean":if(!b.dataParser)b.dataParser=wijgridBoolParser;break;case"number":if(!b.dataParser)b.dataParser=wijgridNumberParser;break;case"currency":if(!b.dataParser)b.dataParser=wijgridCurrencyParser;break;case"datetime":if(!b.dataParser)b.dataParser=wijgridDateTimeParser;break;default:throw a.ui.wijgrid.stringFormat('Unsupported dataType value: "{0}"',b.dataType);}if(a.isFunction(b.dataParser))b.dataParser=new b.dataParser}else b.clientType="c1band"},this))},_buildFilterInfo:function(){var b=this._field("leaves"),c=a.map(b,a.proxy(function(b){if(!b.isBand&&b.dataIndex>=0&&b.filterOperator){var d=b.filterOperator.toLowerCase(),c;if(d!=="nofilter"&&(c=this.filterOperatorsCache.getByName(d)))if(a.inArray(b.dataType||"string",c.applicableTo)>=0)if(c.arity===1||c.arity>1&&b.filterValue!==undefined)return[{column:b,operator:c}]}return null},this));return c},_buildSortInfo:function(){var b=this._field("leaves"),c=a.map(b,function(a){if((a.visible||a.visible===undefined)&&!a.isBand&&a.dataIndex>=0)var b=a.sortDirection==="ascending"||a.sortDirection==="descending"||a.sortFlag?[{dataKey:a.dataKey,dataIndex:a.dataIndex,sortDirection:a.sortDirection}]:null;delete a.sortFlag;return b});return c},_widgetsToOptions:function(){var b=a.ui.wijgrid.flatten(this.options.columns);a.ui.wijgrid.traverse(this.columns(),function(c){var d=b[c.options.travIdx];a.extend(true,d,c.options)})},_recreateColumnWidgets:function(){a.each(this.columns(),function(b,a){a.destroy()});var g=[],c=this._headerRows();if(c&&c.length()){var b=[];a.ui.wijgrid.traverse(this.options.columns,function(a){a.parentVis&&b.push(a)});for(var e=0,i=b.length;e<i;e++){var d=b[e],h=c.item(d.thY),j=(new a.ui.wijgrid.rowAccessor).getCell(h,d.thX),f=this._columnWidgetsFactory(a(j),d);g.push(f.data(f.data("widgetName")))}}this._field("columns",g)},_ownerise:function(b){if(b){var c=this;a.ui.wijgrid.traverse(this.options.columns,function(b){b.owner=c;var a;if(a=b.groupInfo){a.owner=b;if(a.expandInfo)for(var d=0,e=a.expandInfo.length;d<e;d++)a.expandInfo[d].owner=a}})}else a.ui.wijgrid.traverse(this.options.columns,function(c){delete c.owner;var a;if(a=c.groupInfo){delete a.owner;if(a.expandInfo)for(var b=0,d=a.expandInfo.length;b<d;b++)delete a.expandInfo[b].owner}})},_updateSplits:function(){this._field("view").updateSplits!=null&&this._field("view").updateSplits()},_refresh:function(d){this.updateMode=d===undefined?0:d;if(this._field("selectionui")){this._field("selectionui").dispose();this._field("selectionui",null)}this._field("headerRowsAccessor")&&this._field("headerRowsAccessor",null);this._field("rowsAccessor")&&this._field("rowsAccessor",null);this._field("resizer")&&this._field("resizer").dispose();if(this.updateMode&2){(new a.ui.wijgrid.grouper).group(this,this.dataTable,this._field("leaves"));(new a.ui.wijgrid.merger).merge(this.dataTable,this._field("visibleLeaves"))}var c;if(this.options.scrollMode!=="none"&&(this._staticColumnIndex>=0||this.options.staticRowIndex>=0))this._field("view",c=new a.ui.wijgrid.fixedView(this));else this._field("view",c=new a.ui.wijgrid.flatView(this));c.initialize();this._render();this._ownerise(false);this._recreateColumnWidgets();this._ownerise(true);if(this.updateMode&(2|4)&&this.options.allowPaging){this.$topPagerDiv&&this.$topPagerDiv.wijpager(this._pagerSettings2PagerWidgetSettings());this.$bottomPagerDiv&&this.$bottomPagerDiv.wijpager(this._pagerSettings2PagerWidgetSettings())}this._attachEvents();a(c.focusableElement()).attr("tabIndex",0);if(this.currency()._isValid())this.currency(this.currency());else this.currency(new a.ui.wijgrid.cellInfo(0,0));this._field("selection",null);var b=this.currency();if(b._isValid()){this.selection()._startNewTransaction(b);this.selection()._selectRange(new a.ui.wijgrid.cellInfoRange(b,b),false,false,0,null)}this._selectionui();var e=new a.ui.wijgrid.resizer(this);a.ui.wijgrid.traverse(this.columns(),function(b){var a=b.options;a.visible&&a.parentVis&&a.isLeaf&&e.addElement(b)});this._field("resizer",e);this.rendered=true;this.updateMode=0;this.options.scrollMode!=="none"&&this._updateSplits()},_render:function(){var c=this._field("view");c.render(255);var b=this.options.scrollMode!=="none"?c.element.find(".ui-wijgrid-content-area"):this.element;if(this.updateMode&(2|4)){if(this.$topPagerDiv){this.$topPagerDiv.data("wijpager")&&this.$topPagerDiv.wijpager("destroy");this.$topPagerDiv.empty()}this.$topPagerDiv&&this.$topPagerDiv.remove();this.$topPagerDiv=null;if(this.options.allowPaging&&(this.options.pagerSettings.position==="top"||this.options.pagerSettings.position==="topAndBottom"))!this.$topPagerDiv&&b.prepend(this.$topPagerDiv=a('<div class="ui-wijgrid-header ui-wijsuperpanel-header ui-widget-header ui-corner-top"></div>'))}if(this.updateMode&(2|4)){if(this.$bottomPagerDiv){this.$bottomPagerDiv.data("wijpager")&&this.$bottomPagerDiv.wijpager("destroy");this.$bottomPagerDiv.empty()}this.$bottomPagerDiv&&this.$bottomPagerDiv.remove();this.$bottomPagerDiv=null;if(this.options.allowPaging&&(this.options.pagerSettings.position==="bottom"||this.options.pagerSettings.position==="topAndBottom"))!this.$bottomPagerDiv&&b.append(this.$bottomPagerDiv=a('<div class="ui-wijgrid-footer ui-wijsuperpanel-footer ui-state-default ui-corner-bottom"></div>'))}},_attachEvents:function(){var b=this._field("view"),c=a(b.focusableElement());c.bind("keydown."+this.widgetName,a.proxy(this._onKeyDown,this));c.bind("keypress."+this.widgetName,a.proxy(this._onKeyPress,this));a.each(b.subTables(),a.proxy(function(d,c){var b=c.element();if(b){b.tHead&&a(b.tHead).bind("click."+this.widgetName,a.proxy(this._onClick,this));b.tBodies.length&&a(b.tBodies[0]).bind("click."+this.widgetName,a.proxy(this._onClick,this)).bind("dblclick."+this.widgetName,a.proxy(this._onDblClick,this)).bind("mousemove."+this.widgetName,a.proxy(this._onMouseMove,this))}},this));a.each(b.getJoinedTables(true,0),a.proxy(function(d,b){if(b&&typeof b!=="number"){var c=b.element();a(c).find("> tbody").find("> tr.ui-wijgrid-groupheaderrow > td .ui-wijgrid-grouptogglebtn").bind("click."+this.widgetName,a.proxy(this._onGroupBtnClick,this))}},this));b.attachEvents()},_sortBy:function(b){if(this.options.allowSorting){b.options.sortFlag=true;var c=this.columns(),d=a.inArray(b,c);if(d>=0){a.each(c,function(c,a){if(a!==b)a.options.sortDirection="none"});this._requiresDataBinding=true;this._ensureControl({updateMode:1|2,callback:a.proxy(function(){b.options.sortFlag=false},this)})}}},_pagerSettings2PagerWidgetSettings:function(){return a.extend({},this.options.pagerSettings,{disabled:this.options.disabled,pageCount:this.pageCount(),pageIndex:this.options.pageIndex,pageindexchanging:a.proxy(this._onPagerWidgetPageIndexChanging,this),pageindexchanged:a.proxy(this._onPagerWidgetPageIndexChanged,this)})},_onPagerWidgetPageIndexChanging:function(b,a){a.handled=true},_onPagerWidgetPageIndexChanged:function(b,a){this._setOption("pageIndex",a.newPageIndex)},_onClick:function(d){if(!this._canInteract()||!d.target)return;var i=this._getParentSubTable(d.target,["td","th"],this._field("view").subTables());if(i){var j=this._field("view"),h=i[0],g=a(h).closest("tr");if(!(g.is(".ui-wijgrid-datarow")||g.is(".ui-wijgrid-headerrow")))return;if(!g.length)return;var b=j.getAbsCellInfo(h)._dataToAbs(this._getDataToAbsOffset()),e=0;if(b.cellIndex()<0||b.rowIndex()<0)if(b.rowIndex()>=0){b=new a.ui.wijgrid.cellInfo(0,b.rowIndex());e=2}else{b=new a.ui.wijgrid.cellInfo(b.cellIndex(),0);e=1}this._changeCurrency(b);var f=this.currency(),c=this.selection();(!d.shiftKey||!c._multipleRangesAllowed()&&this.options.selectionMode.toLowerCase()!=="singlerange")&&c._startNewTransaction(f);c.beginUpdate();if(d.shiftKey&&d.ctrlKey)c._clearRange(new a.ui.wijgrid.cellInfoRange(f,f),e);else c._selectRange(new a.ui.wijgrid.cellInfoRange(c._anchorCell(),f),d.ctrlKey,d.shiftKey,e,null);c.endUpdate()}},_onDblClick:function(a){this._beginEditInternal(a)},_onGroupBtnClick:function(d){var g=a(d.target).closest("tr"),f=new a.ui.wijgrid.groupHelper,b=f.getGroupInfo(g[0]);if(b){var e=f.getColumnByGroupLevel(this._field("leaves"),b.level);if(e){var c=e.groupInfo.expandInfo[b.index];if(c.isExpanded)c.collapse(d.shiftKey);else c.expand(d.shiftKey);this._field("view").ensureWidth()}}},_onKeyDown:function(b){if(!this._canInteract)return true;var d=b.target.tagName.toLowerCase();if((d==="input"||d==="option"||d==="select"||d==="textarea")&&a(b.target).closest("tr.ui-wijgrid-datarow").length===0)return true;if(this.options.allowEditing)if(b.which===113){this._beginEditInternal(b);return false}else if(b.which===a.ui.keyCode.ESCAPE&&(this.currency()._isValid()&&this.currency()._isEdit())){this._endEditInternal(b);return false}if(!this.options.allowKeyboardNavigation)return true;var f=false,e;switch(b.which){case a.ui.keyCode.LEFT:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.TAB:e=this._getNextCurrencyPos(this._getDataCellsRange(),this.currency(),b.keyCode,b.shiftKey);f=this._canMoveToAnotherCell(b.target,b.which)}if(f){var h=this._changeCurrency(new a.ui.wijgrid.cellInfo(e.cellIndex,e.rowIndex)),g=this.currency(),c=this.selection();(!b.shiftKey||!c._multipleRangesAllowed()&&this.options.selectionMode.toLowerCase()!=="singlerange")&&c._startNewTransaction(g);c.beginUpdate();c._selectRange(new a.ui.wijgrid.cellInfoRange(c._anchorCell(),g),false,b.shiftKey,0,null);c.endUpdate();return false}return true},_onKeyPress:function(b){if(this._canInteract()&&this.options.allowEditing){var d=b.which,e=this.currency();if(d&&e._isValid()&&!e._isEdit()){var c=b.target.tagName.toLowerCase();if(c!=="input"&&c!=="option"&&c!=="select"&&c!=="textarea"){var f=a(b.target).closest(".ui-wijgrid-table");if(f.length){var g=a.map(this._field("view").subTables(),function(a){return a.element()});if(a.inArray(f[0],g)>=0)if(a.wij.charValidator.isPrintableChar(String.fromCharCode(d))){this._beginEditInternal(b);return false}}}}}},_onMouseMove:function(k){if(!this._canInteract())return;var j=this._field("view"),i=this._getParentSubTable(k.target,["td","th"],j.subTables());if(i){var h=i[0],d=a(h).closest("tr");if(!d.length||!(d.is(".ui-wijgrid-datarow")||d.is(".ui-wijgrid-headerrow")))return;var f=j.getAbsCellInfo(h)._dataToAbs(this._getDataToAbsOffset()),g=this._field("hoveredRow");if(f.rowIndex()!==g){var b=this._rows().item(g);if(b){b[0]&&a(b[0]).removeClass("ui-state-hover");b[1]&&a(b[1]).removeClass("ui-state-hover")}}var e=f.rowIndex();this._field("hoveredRow",e);if(e>=0){var c=this._rows().item(e);if(c){c[0]&&a(c[0]).addClass("ui-state-hover");c[1]&&a(c[1]).addClass("ui-state-hover")}}}},_fieldResized:function(b,a){if(a<=0)a=1;b.option("width",a)},_changeCurrency:function(b){var d=null,a=this.currency(),c=this._getDataCellsRange();if(c._isValid()&&c._containsCellInfo(b)||b.isEqual(b.outsideValue))if(a.cellIndex()!==b.cellIndex()||a.rowIndex()!==b.rowIndex()){var f={cellIndex:b.cellIndex(),rowIndex:b.rowIndex(),oldCellIndex:a.cellIndex(),oldRowIndex:a.rowIndex()};if(this._trigger("currencychanging",null,f)){var e=false;if(!this.options.allowEditing||!a._isEdit()||(e=this._endEditInternal(null))){c._containsCellInfo(a)&&this._changeCurrencyUI(a,false);a=b._clone();a._setGridView(this);d=this._changeCurrencyUI(a,true);this._field("currency",a);this._trigger("currencychanged")}}}else d=this._changeCurrencyUI(a,true);return d},_changeCurrencyUI:function(b,i){if(b&&!b.isEqual(b.outsideValue)){var e=this._field("view"),k=this._field("visibleLeaves"),j=this._getDataToAbsOffset(),c=b.cellIndex()+j.x,f=b.rowIndex()+j.y;if(f>=0){var d=e.getJoinedRows(f,0);if(d&&d[0]&&this.options.showRowHeader)if(i)a(d[0].cells[0]).addClass("ui-state-active ui-wijgrid-currency-rowheadercell");else a(d[0].cells[0]).removeClass("ui-state-active ui-wijgrid-currency-rowheadercell");if(c>=0&&c<k.length){var g=e.getHeaderCell(c);if(g)if(i)a(g).addClass("ui-state-active ui-wijgrid-currency-headercell");else a(g).removeClass("ui-state-active ui-wijgrid-currency-headercell");var h=e.getCell(c,f);if(h)if(i)a(h).addClass("ui-state-active ui-wijgrid-currency-cell");else a(h).removeClass("ui-state-active ui-wijgrid-currency-cell")}return e.getCell(c,f)}}return null},_beginEditInternal:function(d){if(this._canInteract()&&this.options.allowEditing){var b=this.currency()._column();if(b&&!b.readOnly){var c=(new a.ui.wijgrid.cellEditorHelper).currencyEditStart(this,d);c&&this._field("view").ensureWidth(0);return c}}return false},_endEditInternal:function(c){if(this._canInteract()&&this.options.allowEditing){var b=(new a.ui.wijgrid.cellEditorHelper).currencyEditEnd(this,c);b&&this._field("view").ensureWidth(0);return b}return false},_parseDOM:function(a,b){return a.dataParser.parseDOM(b,this._field("closestCulture"),a.dataFormatString,this.options.nullString)},_parse:function(a,b){return a.dataParser.parse(b,this._field("closestCulture"),a.dataFormatString,this.options.nullString)},_toStr:function(a,b){return a.dataParser.toStr(b,this._field("closestCulture"),a.dataFormatString,this.options.nullString)},_canInteract:function(){return!this.options.disabled},_canMoveToAnotherCell:function(d,b){var h=d.tagName.toLowerCase();switch(h){case"input":if(a(d).hasClass("wijgridinput")){if(d.type==="text"){var f=d.value.length,e=(new a.ui.wijgrid.domSelection(d)).getSelection(),c=a.ui.keyCode,g=b===c.UP||b==c.DOWN||b===c.PAGE_DOWN||b==c.PAGE_UP||e.length===0&&(e.start===0&&(b===c.LEFT||b===c.HOME)||e.end>=f&&(b===c.RIGHT||b===c.END));return g}return true}return false;case"textarea":case"select":return false}return true},_getDataToAbsOffset:function(){var c=0,a=0;if(this.options.showRowHeader)c++;var b=this._headerRows();if(b)a+=b.length();if(this._filterRow())a++;return{x:c,y:a}},_getDataCellsRange:function(){var d=0,e=0,b=this._field("visibleLeaves").length-1;if(this.options.showRowHeader)b--;var f=this.dataTable,c=f.length-1;if(b<0||c<0)d=e=b=c=-1;return new a.ui.wijgrid.cellInfoRange(new a.ui.wijgrid.cellInfo(d,e),new a.ui.wijgrid.cellInfo(b,c))},_getNextCurrencyPos:function(b,f,h,g){var d=f.cellIndex(),c=f.rowIndex();switch(h){case a.ui.keyCode.PAGE_UP:if(this.options.key_reverse&&c===b.topLeft().rowIndex())c=b.bottomRight().rowIndex();else{c-=this.options.key_pageSize;var e;if(c<(e=b.topLeft().rowIndex()))c=e}break;case a.ui.keyCode.PAGE_DOWN:if(this.options.key_reverse&&c===b.bottomRight().rowIndex())c=b.TopLeft().RowIndex();else{c+=this.options.key_pageSize;var e;if(c>(e=b.bottomRight().rowIndex()))c=e}break;case a.ui.keyCode.END:d=this.options.key_reverse&&d===b.bottomRight().cellIndex()?b.topLeft().cellIndex():b.bottomRight().cellIndex();break;case a.ui.keyCode.HOME:d=this.options.key_reverse&&d==b.topLeft().cellIndex()?b.bottomRight().cellIndex():b.topLeft().cellIndex();break;case a.ui.keyCode.LEFT:if(d>b.topLeft().cellIndex())d--;else if(this.options.key_reverse)d=b.bottomRight().cellIndex();break;case a.ui.keyCode.UP:if(c>b.topLeft().rowIndex())c--;else if(this.options.key_reverse)c=b.bottomRight().rowIndex();break;case a.ui.keyCode.RIGHT:if(d<b.bottomRight().cellIndex())d++;else if(this.options.key_reverse)d=b.topLeft().cellIndex();break;case a.ui.keyCode.ENTER:case a.ui.keyCode.DOWN:if(c<b.bottomRight().rowIndex())c++;else if(this.options.key_reverse)c=b.topLeft().rowIndex();break;case a.ui.keyCode.TAB:if(false)if(g){d--;if(d<b.topLeft().cellIndex()){d=b.bottomRight().cellIndex();c--;if(c<b.topLeft().rowIndex())c=b.bottomRight().rowIndex()}}else{d++;if(d>b.bottomRight().cellIndex()){d=b.topLeft().cellIndex();c++;if(c>b.bottomRight().rowIndex())c=b.topLeft().rowIndex()}}}return{cellIndex:d,rowIndex:c}},_getParentSubTable:function(b,f,g){for(var e=a.map(g,function(a){return a.element()}),c=null,d=null;b!==null&&c===null;b=b.parentNode){var h=b.tagName?b.tagName.toLowerCase():undefined;if(a.inArray(h,f)>=0)d=b;else if(a.inArray(b,e)>=0)c=b}return d&&c?[d,c]:null},_getRealStaticRowIndex:function(){if(this.options.staticRowIndex>=0){var a=this._field("spanTable").length-1;if(this.options.showFilter)a++;return a}else return this.options.staticRowIndex}})})(jQuery);(function(a){a.widget("ui.c1basefield",{options:{allowSizing:true,dataKey:undefined,headerText:undefined,visible:true,width:undefined},_create:function(){this.element.addClass("ui-widget ui-c1basefield ui-state-default");this._field("owner",this.options.owner);delete this.options.owner;this._field("widgetName",this.widgetName);this.options.disabled&&this.disable()},_init:function(){this.element.text(this.options.headerText);this.element.wrapInner('<span class="ui-wijgrid-headertext" />')},_field:function(a,b){return arguments.length===1?this.element.data(a):this.element.data(a,b)},_setOption:function(d,b){var f=this["_preset_"+d],c=this.options[d];if(f!==undefined)b=f.apply(this,[b,c]);var g=b!==c;a.Widget.prototype._setOption.apply(this,arguments);if(g){var e=this["_postset_"+d];e!==undefined&&e.apply(this,[b,c])}},_preset_clientType:function(){throw"read-only";},_postset_headerText:function(a){this._headerTextDOM(a)},_postset_visible:function(){this._field("owner")._ensureControl(255)},_postset_width:function(b){var f=this._field("owner"),c=f._field("view"),d=this.element.width(),e=c.getJoinedCols(this.options.leavesIdx);a.each(e,function(c,a){if(a)a.width=b});c.forEachColumnCell(this.options.leavesIdx,function(c){a(c).setOutWidth(b);return true});c.ensureWidth(b-d)},_canSize:function(){return this.options.allowSizing&&this._field("owner").options.allowColSizing}})})(jQuery);(function(a){a.widget("ui.c1field",a.ui.c1basefield,{options:{aggregate:"none",allowSort:true,dataType:"string",dataParser:undefined,dataFormatString:undefined,filterOperator:"nofilter",filterValue:undefined,groupInfo:{expandInfo:[],groupSingleRow:true,collapsedImageClass:"ui-icon-plus",expandedImageClass:"ui-icon-minus",position:"none",outlineMode:"startExpanded",headerText:undefined,footerText:undefined},readOnly:false,rowMerge:"none",showFilter:true,sortDirection:"none",valueRequired:false},_create:function(){a.ui.c1basefield.prototype._create.apply(this,arguments);this.element.addClass("ui-widget ui-c1field")},destroy:function(){a.ui.c1basefield.prototype.destroy.apply(this,arguments);if(this.$filterEditor){switch(this.options.dataType){case"number":case"currency":this.$filterEditor.wijinputnumber("destroy");break;case"datetime":this.$filterEditor.wijinputdate("destroy");break;default:this.$filterEditor.wijinputmask("destroy")}this.$filterEditor=null}this._removeDropDownFilterList()},_init:function(){a.ui.c1basefield.prototype._init.apply(this,arguments);this.$filterEditor=null;this._refreshHeaderCell();var b=this._field("owner");this.filterRow=b._filterRow();b.options.showFilter&&this.options.showFilter&&this.options.dataIndex>=0&&this._prepareFilterCell()},_setOption:function(){a.ui.c1basefield.prototype._setOption.apply(this,arguments)},_postset_aggregate:function(){this._field("owner")._ensureControl(2)},_postset_allowSort:function(){this.element.find("#contentCell").empty();this._headerTextDOM(this.options.headerText);this._refreshHeaderCell()},_postset_dataType:function(){throw"read-only";},_postset_dataParser:function(){this._field("owner")._ensureControl(2)},_postset_dataFormatString:function(){this._field("owner")._ensureControl(2)},_postset_filterOperator:function(){this._field("owner")._requiresDataBinding=true;this._field("owner")._ensureControl(2|8)},_postset_filterValue:function(){this._field("owner")._requiresDataBinding=true;this._field("owner")._ensureControl(2|8)},_postset_groupInfo:function(){this._field("owner")._ensureControl(2)},_postset_rowMerge:function(){this._field("owner")._ensureControl(2)},_postset_showFilter:function(){this._field("owner")._ensureControl(8)},_preset_sortDirection:function(a,b){var c=this._field("owner");if(!c._trigger("sorting",null,null))a=b;return a},_postset_sortDirection:function(){var a=this._field("owner");a._sortBy(this);a._trigger("sorted",null,null)},_postset_width:function(){a.ui.c1basefield.prototype._postset_width.apply(this,arguments)},_canSort:function(){var a=this._field("owner");return a&&a.options.allowSorting&&this.options.allowSort&&this.options.dataIndex>=0},_refreshHeaderCell:function(){this.element.empty().text(this.options.headerText);if(this._canSort()){this.element.wrapInner('<a class="ui-wijgrid-headertext" href="#" />');var b=this.element.find("> a");b.bind("click."+this.widgetName,this,this._onHrefClick);switch(this.options.sortDirection){case"ascending":b.append(a('<span class="ui-icon ui-icon-triangle-1-n">ascending</span>'));break;case"descending":b.append(a('<span class="ui-icon ui-icon-triangle-1-s">descending</span>'))}}else this.element.wrapInner('<span class="ui-wijgrid-headertext" />')},_prepareFilterCell:function(){var e=this.options.visLeavesIdx;if(e>=0){var c=this._field("owner"),d=null;if(this.filterRow)d=a((new a.ui.wijgrid.rowAccessor).getCell(this.filterRow,e));else throw"exception";d.find(".ui-wijgrid-filtericon").attr("class",this._getFilterOpIconCss(c,this.options.filterOperator));this.$filterEditor=d.find("input");var g=this._getFilterEditorWidth();this.$filterEditor.setOutWidth(g);var b=c._parse(this.options,this.options.filterValue);switch(this.options.dataType){case undefined:if(b===null)b="";case"boolean":if(b===null)b=false;case"string":if(b===null)b="";this.$filterEditor.wijinputmask({disabled:c.options.disabled,text:b});break;case"number":if(b!==null)this.$filterEditor.wijinputnumber({disabled:c.options.disabled,value:b});else this.$filterEditor.wijinputnumber({disabled:c.options.disabled});break;case"datetime":if(b!==null)this.$filterEditor.wijinputdate({disabled:c.options.disabled,date:b});else this.$filterEditor.wijinputdate({disabled:c.options.disabled});break;case"currency":if(b!==null)this.$filterEditor.wijinputnumber({disabled:c.options.disabled,type:"currency",value:b});else this.$filterEditor.wijinputnumber({disabled:c.options.disabled,type:"currency"})}var f=d.find(".ui-wijgrid-filter-trigger");f.bind("mouseenter",function(){var b=a(this);b.addClass("ui-state-hover")}).bind("mouseleave",function(){var b=a(this);b.removeClass("ui-state-hover");b.removeClass("ui-state-active")}).bind("mouseup",this,function(){a(this).removeClass("ui-state-active")}).bind("mousedown",{column:this},this._onFilterBtnClick)}},_onFilterBtnClick:function(h){var b=h.data.column;if(b.$dropDownFilterList)return false;var c=b._field("owner"),i=h.data.column.options.filterOperator.toLowerCase(),g=c.filterOperatorsCache.getByDataType(b.options.dataType);c.filterOperatorsCache.sort(g,c.options.filterOperatorsSortMode);var d=a.extend(true,{},{operators:g});c._trigger("filteroperatorslistshowing",null,d);var f=[];if(d.operators)for(var k in d.operators){var e=d.operators[k];f.push({label:e.name,value:e.name,selected:e.name.toLowerCase()===i})}b.$dropDownFilterList=a('<div class="ui-wijgrid-filterlist"></div').appendTo(document.body).wijlist({autoSize:true,maxItemsCount:8,selected:function(g,f){var d=c.filterOperatorsCache.getByName(f.item.value);b._removeDropDownFilterList();var a=false;if(d)if(d.arity>1){var e=c._parse(b.options,b.$filterEditor.val());if(e!==null&&(b.options.dataType==="string"||!isNaN(e))){b.options.filterValue=e;a=true}}else a=true;if(a){b.options.filterOperator=d.name;c._requiresDataBinding=true;c._ensureControl(2|4)}}});b.$dropDownFilterList.wijlist("setItems",f).wijlist("renderList");f.length>8&&b.$dropDownFilterList.width(b.$dropDownFilterList.width()+20);b.$dropDownFilterList.$button=a(this);b.$dropDownFilterList.wijlist("refreshSuperPanel").position({of:a(this),my:"left top",at:"left bottom"});var j=b.$dropDownFilterList.eventGuid=(new Date).getTime();a(document).bind("mousedown."+b.widgetName+"."+j,{column:b},b._onDocMouseDown)},_getFilterOpIconCss:function(d,c){var b="filter-nofilter",a=d.filterOperatorsCache.getByName(c.toLowerCase());if(a)if(a.css)b=a.css;else b="filter-"+a.name.toLowerCase();return"ui-wijgrid-filtericon "+b},_onDocMouseDown:function(c){var b=a(c.target),d=b.is(".ui-wijgrid-filter-trigger")?b:b.parents(".ui-wijgrid-filter-trigger:first"),e=b.parents(".ui-wijgrid-filterlist:first");!(d.length&&d[0]===c.data.column.$dropDownFilterList.$button[0]||e.length&&e[0]===c.data.column.$dropDownFilterList[0])&&c.data.column._removeDropDownFilterList()},_onHrefClick:function(b){if(b.data.options.disabled)return false;if(b.data.options.allowSort){var a=b.data.options.sortDirection;a=a=="none"?"ascending":a=="ascending"?"descending":"ascending";b.data.option("sortDirection",a)}return false},_removeDropDownFilterList:function(){if(this.$dropDownFilterList){var b=this.$dropDownFilterList.eventGuid;this.$dropDownFilterList.remove();this.$dropDownFilterList=null;a(document).unbind("mousedown."+this.widgetName+"."+b,this._onDocMouseDown)}},_getFilterEditorWidth:function(){if(this.$filterEditor){var b=this.$filterEditor.closest(".ui-wijgrid-filter"),a=b.width()-b.find(".ui-wijgrid-filtericon").outerWidth();if(!a||a<0)a=0;return a}else throw"exception";},_somemethod:function(){}})})(jQuery);(function(a){a.widget("ui.c1band",a.ui.c1basefield,{options:{columns:[]},_create:function(){a.ui.c1basefield.prototype._create.apply(this,arguments);this.element.addClass("ui-widget ui-c1band")}})})(jQuery);$.extend($.ui.wijgrid,{bandProcessor:function(){var b,g,a,f,d,e,c;this.generateSpanTable=function(j,i){b=g=e=d=0;a=[];f=[];c=[];var h=this._generateSpanTable(j,i,true);return h},this._generateSpanTable=function(e,c,i){b=this._getVisibleHeight(e,i);c=c||[];$.ui.wijgrid.traverse(e,function(a){a.isLeaf&&c.push(a);f.push(a)});g=c.length;for(var d=0;d<b;d++){a[d]=[];for(var h=0;h<g;h++)a[d][h]={column:null,colSpan:0,rowSpan:0}}this._setTableValues(e,0,0);return a},this._getVisibleHeight=function(a,d){var b=0;if($.isArray(a))for(var c=0,e=a.length;c<e;c++){var f=this._getVisibleHeight(a[c],d);b=Math.max(b,f)}else{var g=a.visible===undefined?true:a.visible;a.parentVis=g&&d;if(a.isBand){for(var c=0,e=a.columns.length;c<e;c++){var f=this._getVisibleHeight(a.columns[c],a.parentVis);b=Math.max(b,f)}if(!a.parentVis)return b;a.isLeaf=b==0;b++}else{a.isLeaf=true;if(a.parentVis)b=1}}return b},this._getVisibleParent=function(a){while(a){a=f[a.parentIdx];if(a&&(a.parentVis||a.parentVis===undefined))return a}return null},this._setTableValues=function(f,g,k){if($.isArray(f))for(var h=0,n=f.length;h<n;h++)this._setTableValues(f[h],g,k);else{if(f.travIdx===undefined)throw"undefined travIdx";var l=k+d;if(f.parentVis){var i=l+e;a[g][i].column=f;c[f.travIdx]=i}if(f.isBand)for(var h=0,n=f.columns.length;h<n;h++)this._setTableValues(f.columns[h],g+1,k);if(f.parentVis)if(d-l===0){a[g][c[f.travIdx]].rowSpan=b-g;d++}else a[g][c[f.travIdx]].colSpan=d-l;else if(!f.isBand&&b>0){var j=this._getVisibleParent(f),m=j?j.isLeaf:false;if(m)e++;if(g>=b)g=b-1;var i=k+d+e;a[g][i].column=f;if(!m){j&&c[j.travIdx]===i&&this._shiftTableElements(i,g);e++}}}},this._shiftTableElements=function(d,e){for(var b=0;b<e;b++){a[b][d+1]=a[b][d];a[b][d]={column:null,colSpan:0,rowSpan:0};if(a[b][d+1].column)c[a[b][d+1].column.travIdx]++}}},getAllLeaves:function(b){var a=[];this._getAllLeaves(b,a);return a},_getAllLeaves:function(c,e){if(c)for(var d=0,f=c.length;d<f;d++){var b=c[d],a;if(b.options){if($.isFunction(b.columns))a=b.columns()}else a=b.columns;if(a&&a.length)this._getAllLeaves(a,e);else e.push(b)}},getColumnByTravIdx:function(c,d){var e=null;if(c)for(var f=0,g=c.length;f<g&&!e;f++){var a=c[f],b;if(a.options){if(a._field("travIdx")===d)return a;if($.isFunction(a.columns))b=a.columns()}else{if(a.travIdx===d)return a;b=a.columns}if(b)e=this.getColumnByTravIdx(b,d)}return e},getLeaves:function(b){var a=[];this._getLeaves(b,a);return a},_getLeaves:function(a,d){if(a)for(var c=0,e=a.length;c<e;c++){var b=a[c];b.isLeaf&&d.push(b);this._getLeaves(b.columns,d)}},setTraverseIndex:function(a){return this._setTraverseIndex(a,0,-1)},_setTraverseIndex:function(d,b,f){if(d)for(var e=0,g=d.length;e<g;e++){var a=d[e],c;if(a.options){a._field("travIdx",b++);a._field("parentIdx",f);if($.isFunction(a.columns))c=a.columns()}else{a.travIdx=b++;a.parentIdx=f;c=a.columns}if(c)b=this._setTraverseIndex(c,b,b-1)}return b},flatten:function(b){var a=[];this.traverse(b,function(b){a.push(b)});return a},traverse:function(c,b){if(c&&$.isFunction(b))for(var d=0,f=c.length;d<f;d++){var a=c[d];b(a);var e=$.isFunction(a.columns)?a.columns():a.columns;e&&this.traverse(e,b)}}});$.extend($.ui.wijgrid,{htmlTableDataReader:function(a){this.readTHead=function(){var e=a.element.find(" > table");if(!e.length)throw"table not found";var f=[],g=e[0].tHead;if(g)for(var c=0,j=1;c<j;c++){for(var h=g.rows[c],d=[],b=0,i=h.cells.length;b<i;b++)d.push(h.cells[b].innerHTML);f.push(d)}return f},this.readTBody=function(){var f=a.element.find(" > table");if(!f.length)throw"table not found";var g=[],d=f.find("> tbody");if(d.length)for(var c=0,j=d[0].rows.length;c<j;c++){for(var h=d[0].rows[c],e=[],b=0,i=h.cells.length;b<i;b++)e[b]={value:h.cells[b].innerHTML,originalRowIndex:c};g.push(e)}return g}}});$.extend($.ui.wijgrid,{dataMode:{dom:1,statical:2,remoteStatical:4,remoteDynamical:8},dataStore:function(b){var a=null,h=0,m=this,d=false,c=null,i,g=false,e=false;this.dataMode=function(){return f()},this.dataSource=function(){return a},this.getFieldsCount=function(){if(!d)throw"data is not loaded yet";return a.items&&a.items.length?p(a.items[0]):0},this.getFieldsNames=function(){if(!d)throw"data is not loaded yet";var e=[];if(a.items&&a.items.length)for(var c in a.items[0]){var b=c;if(typeof b==="string")b=c.toLowerCase();e[b]=c}return e},this.getTotalRowsCount=function(){if(!d)throw"data is not loaded yet";return f()===$.ui.wijgrid.dataMode.remoteDynamical?h:a.items.length},this.getDataSlice=function(){if(!d)throw"data is not loaded yet";if(!g){g=true;q()}if(!e){e=true;if(f()!==$.ui.wijgrid.dataMode.remoteDynamical)i=r();else i=$.extend(true,[],c);if(b.options.allowPaging){var a=Math.ceil(m.getTotalRowsCount()/b.options.pageSize)||1;b._field("pageCount",a)}}return i},this.load=function(c){if(!a)a=$.proxy(o,this)(b);if(f()===$.ui.wijgrid.dataMode.remoteDynamical)a.load(c);else if(!d)a.load(c);else{j(a,c);k(a,c)}},this.updateValue=function(b,f,e){if(!d)throw"data is not loaded yet";a.items[b][f]=e;c[b][f]=e};var o=function(c){var b=null,a=c.options.data;if(a===null)b=new wijdatasource({data:c.element.find("> table"),reader:new l(new n),loading:$.proxy(j,this),loaded:$.proxy(k,this)});else if($.isArray(a))b=new wijdatasource({data:a,reader:new l(new wijarrayreader),loading:$.proxy(j,this),loaded:$.proxy(k,this)});else b=new wijdatasource({data:a.data,reader:new l(a.reader),proxy:a.proxy,loading:$.proxy(function(b,c){a.loading&&a.loading(b,c);$.proxy(j,this)(b,c)},this),loaded:$.proxy(function(b,c){a.loaded&&a.loaded(b,c);$.proxy(k,this)(b,c)},this)});return b},j=function(d,a){g=false;e=false;i=null;c=null;b._dataLoading(a)},k=function(h,l){d=true;if(m.dataMode()===$.ui.wijgrid.dataMode.remoteDynamical){g=false;e=true}else{g=false;e=false}for(var j=[],a=0,n=h.items.length;a<n;a++){var f=h.items[a],i=$.isArray(f)?[]:{};for(var k in f)i[k]={value:f[k],originalRowIndex:a};j.push(i)}c=j;b._dataLoaded(l)},f=function(){return!a.data?$.ui.wijgrid.dataMode.dom:a.data.proxy?a.data.proxy.dynamic===true?$.ui.wijgrid.dataMode.remoteDynamical:$.ui.wijgrid.dataMode.remoteStatical:$.ui.wijgrid.dataMode.statical},p=function(a){if($.isArray(a))return a.length;else{var b=0;for(var c in a)b++;return b}},q=function(){if(c&&c.length){var e=[];$.ui.wijgrid.traverse(b.options.columns,function(a){$.ui.wijgrid.validDataKey(a.dataKey)&&e.push(a)});for(var i=Math.min(e.length,m.getFieldsCount()),g=0,j=c.length;g<j;g++)for(var h=c[g],f=0;f<i;f++){var a=null,d=e[f];if(d&&d.dataParser){a=b._parse(d,h[d.dataKey].value);switch(d.dataType){case"datetime":if(a!==null&&!(a instanceof Date))throw"invalid value.";break;case"number":case"currency":if(a!==null&&(typeof a!=="number"||isNaN(a)))throw"invalid value.";break;case"boolean":if(a!==null&&(typeof a!=="boolean"||isNaN(a)))throw"invalid value.";}h[d.dataKey].value=a}}}},r=function(){if(c&&c.length){var d=b._buildFilterInfo(),a=null;if(b.options.allowSorting)a=b._buildSortInfo();var e=(new $.ui.wijgrid.dataHelper).getDataSlice(b,$.extend(true,[],c),d,a);return e}return[]},l=function(a){this.read=function(b){if(a&&$.isFunction(a.read))a.read(b);else b.items=b.data;if(b.items&&$.isArray(b.items)){var c=0;if(f()===$.ui.wijgrid.dataMode.remoteDynamical){c=1;if(b.items.length<1||b.items[0].length!==1)throw"invalid data";h=parseInt(b.items[0][0]);if(isNaN(h))throw"invalid data";b.items.splice(0,1)}}else{h=0;b.items=[]}}},n=function(){this.read=function(b){b.items=[];if(b&&b.data&&b.data.length){b.items=a(b.data);b.data=null}else throw"invalid data source";};function a(j){var e=[],c=j.find("> tbody:first");if(c.length)for(var f=c[0],b=0,i=f.rows.length;b<i;b++){for(var g=f.rows[b],d=[],a=0,h=g.cells.length;a<h;a++)d[a]=g.cells[a].innerHTML;e[b]=d}return e}}},dataHelper:function(){this.getDataSlice=function(d,c,i,j){c=a(c,i,d);d.options.allowSorting&&$.proxy(b,this)(c,j);if(d.options.allowPaging){var e=Math.min(c.length-1,d.options.pageIndex*d.options.pageSize);if(e<0)e=0;for(var k=Math.min(c.length,e+d.options.pageSize),g=[],f=e,l=0,h=0;f<k;f++,h++)g[h]=c[f];c=g}return c};var a=function(c,b,m){var i,f;if(!c||(i=c.length)===0||!b||(f=b.length)===0)return c;for(var h={},a=0;a<f;a++){var d=b[a],n=d.operator,l=d.column;if(n.arity>1)h[a]=m._parse(l,l.filterValue)}for(var j=[],a=0;a<i;a++){for(var k=c[a],g=true,e=0;e<f&&g;e++){var d=b[e],o=k[d.column.dataIndex].value;g&=d.operator.operator(o,h[e])}g&&j.push($.extend(true,[],k))}return j},b=function(i,f){if(f.length){var a=[];a.push("var _wijgriddatahelper = this;");a.push("var _wijgridSortFunc = function(a, b)\n{\n");for(var e=0,j=f.length;e<j;e++){var d="arg"+e,b=f[e],c=typeof b.dataKey==="string"?'"'+b.dataKey+'"':b.dataKey;if(b.sortDirection==="ascending"||b.sortDirection==="descending")if(b.sortDirection==="ascending")a.push("var ",d," = _wijgriddatahelper._sortAsc","(a[",c,"].value, b[",c,"].value);\n");else a.push("var ",d," = _wijgriddatahelper._sortDesc","(a[",c,"].value, b[",c,"].value);\n");else a.push("var ",d," = _wijgriddatahelper._sortDigitAsc","(a[",c,"].originalRowIndex, b[",c,"].originalRowIndex);\n");a.push("if (",d," == 0)\n");a.push("{\n")}var g=f.length-1;if(g>=0){var d="arg"+g,b=f[g],c=typeof b.dataKey==="string"?'"'+b.dataKey+'"':b.dataKey;if(b.sortDirection==="ascending"||b.sortDirection==="descending")if(b.sortDirection==="ascending")a.push("var ",d," = _wijgriddatahelper._sortDigitAsc","(a[",c,"].originalRowIndex, b[",c,"].originalRowIndex);\n");else a.push("var ",d," = _wijgriddatahelper._sortDigitDesc","(a[",c,"].originalRowIndex, b[",c,"].originalRowIndex);\n")}for(var e=f.length-1;e>=0;e--){a.push("}\n");var d="arg"+e;a.push("return ",d,";\n")}a.push("}");var h=a.join("");eval(h);i.sort(_wijgridSortFunc)}};this._sortAsc=function(a,b){if(a instanceof Date)a=a.getTime();if(b instanceof Date)b=b.getTime();return a===b?0:a===null?-1:b===null?1:a<b?-1:1};this._sortDesc=function(a,b){if(a instanceof Date)a=a.getTime();if(b instanceof Date)b=b.getTime();return a===b?0:a===null?1:b===null?-1:a<b?1:-1};this._sortDigitAsc=function(a,b){return a-b};this._sortDigitDesc=function(a,b){return b-a}}});$.extend($.ui.wijgrid,{groupRange:function(c,f,g,e){this.value=-1;switch(arguments.length){case 4:this.isExpanded=c;this.cr=f;this.sum=g;this.position=e;break;case 1:this.isExpanded=c;this.cr=new $.ui.wijgrid.cellRange(-1,-1);this.sum=-1;this.position="none";break;default:this.isExpanded=false;this.cr=new $.ui.wijgrid.cellRange(-1,-1);this.sum=-1;this.position="none"}this.isSubRange=function(a){return this.cr.r1>=a.cr.r1&&this.cr.r2<=a.cr.r2},this.toString=function(){return this.cr.r1+"-"+this.cr.r2},this._getHeaderImageClass=function(b){var a=this.owner;return a?b?a.expandedImageClass||"ui-icon-minus":a.collapsedImageClass||"ui-icon-plus":null},this.collapse=function(){var a,f,e;if((a=this.owner)&&(f=a.owner)&&(e=f.owner)){var b=new $.ui.wijgrid.groupHelper,c=e._field("leaves");if(b.isParentExpanded(c,this.cr,a.level))if(a.position!=="footer"&&a.outlineMode!=="none"){var g=b.getGroupedColumnsCount(c);d(b,e._rows(),c,this,g)}}},this.expand=function(h){var c,f,e;if((c=this.owner)&&(f=c.owner)&&(e=f.owner)){var a=new $.ui.wijgrid.groupHelper,d=e._field("leaves");if(a.isParentExpanded(d,this.cr,c.level)){var g=a.getGroupedColumnsCount(d);b(a,e._rows(),d,this,g,h,true)}}};var d=function(l,e,n,b,k){var j=b.owner,i=b.cr.r1,m=b.cr.r2;switch(j.position){case"header":case"headerAndFooter":i++}for(var d=i;d<=m;d++){var c=e.item(d);if(c){if(c[0])c[0].style.display="none";if(c[1])c[1].style.display="none"}}b.isExpanded=false;a(e,b);for(var d=j.level+1;d<=k;d++)for(var g=l.getChildGroupRanges(n,b.cr,b.owner.level),f=0,o=g.length;f<o;f++){var h=g[f];h.isExpanded=false;a(e,h)}},b=function(l,e,m,f,k,n,o){var r=f.owner,g=f.cr.r1,h=f.cr.r2;switch(r.position){case"header":var c=e.item(g);if(c){if(c[0])c[0].style.display="";if(c[1])c[1].style.display=""}g++;break;case"footer":var c=e.item(h);if(c){if(c[0])c[0].style.display="";if(c[1])c[1].style.display=""}h--;break;case"headerAndFooter":var c=e.item(g);if(c){if(c[0])c[0].style.display="";if(c[1])c[1].style.display=""}if(o){var c=e.item(h);if(c){if(c[0])c[0].style.display="";if(c[1])c[1].style.display=""}}g++;h--}if(o){f.isExpanded=true;a(e,f)}else return;if(f.owner.level===k)for(var d=g;d<=h;d++){var c=e.item(d);if(c){if(c[0])c[0].style.display="";if(c[1])c[1].style.display=""}}else{var i=l.getChildGroupRanges(m,f.cr,f.owner.level);if(n)for(var d=0,p=i.length;d<p;d++){var j=i[d];b(l,e,m,j,k,n,true)}else for(var d=0,p=i.length;d<p;d++){var j=i[d],q=j.owner.position==="footer"||j.owner.outlineMode==="none"?true:false;b(l,e,m,j,k,false,q)}}},a=function(d,a){if(a.owner.position!=="footer"){var b=null,c=d.item(a.cr.r1);if(c)if(c[0])b=$(c[0]).find("div.ui-wijgrid-grouptogglebtn:first-child");if(b&&b.length){b.toggleClass(a._getHeaderImageClass(!a.isExpanded),false);b.toggleClass(a._getHeaderImageClass(a.isExpanded),true)}}}},grouper:function(){this.group=function(e,f,b){this._grid=e;this._data=f;this._leaves=b;this._visibleLeaves=e._field("visibleLeaves");this._groupRowIdx=0;this._groupHelper=new $.ui.wijgrid.groupHelper;for(var d=1,c=0,g=b.length;c<g;c++){var a=b[c];this._groupRowIdx=0;if(a.dynamic!==true&&a.groupInfo&&(a.groupInfo.position&&a.groupInfo.position!=="none")&&a.dataIndex>=0){a.groupInfo.level=d;a.groupInfo.expandInfo=[];this._processRowGroup(a,d++)}}delete this._grid;delete this._data;delete this._leaves;delete this._visibleLeaves},this._processRowGroup=function(d,c){for(var e=0;e<this._data.length;e++){if(this._data[e].rowType!=="data")continue;var a=this._getGroupCellRange(e,d,c),g=true,l=d.groupInfo.outlineMode==="startCollapsed";if(l||this._groupHelper.isParentCollapsed(this._leaves,a,c)){if(d.groupInfo.groupSingleRow===false&&a.r1==a.r2)continue;g=false}if(c&&this._grid.options.groupIndent)for(var k=a.r1;k<=a.r2;k++)this._addIndent(this._data[k][0],c);switch(d.groupInfo.position){case"header":var b=this._addGroupRange(d.groupInfo,a,g);this._updateByGroupRange(b,c);var f=this._groupHelper.isParentCollapsed(this._leaves,b.cr,c),j=this._buildGroupRow(b,a,true,f);if(!g)for(var h=a.r1;h<=a.r2;h++)this._data[h].display="none";this._data.splice(a.r1,0,j);if(f)j.display="none";e=a.r2+1;break;case"footer":var b=this._addGroupRange(d.groupInfo,a,true);this._updateByGroupRange(b,c);var i=this._buildGroupRow(b,a,false,false);this._data.splice(a.r2+1,0,i);e=a.r2+1;var f=this._groupHelper.isParentCollapsed(this._leaves,b.cr,c);if(f)i.display="none";break;case"headerAndFooter":var b=this._addGroupRange(d.groupInfo,a,g);this._updateByGroupRange(b,c);var f=this._groupHelper.isParentCollapsed(this._leaves,b.cr,c),j=this._buildGroupRow(b,a,true,f),i=this._buildGroupRow(b,a,false,false);if(!g)for(var h=a.r1;h<=a.r2;h++)this._data[h].display="none";this._data.splice(a.r2+1,0,i);if(f||!g)i.display="none";this._data.splice(a.r1,0,j);if(f)j.display="none";e=a.r2+2;break;default:throw $.ui.wijgrid.stringFormat('Unknown Position value: "{0}"',d.groupInfo.position);}this._groupRowIdx++}},this._buildGroupRow=function(k,f,e){var d=k.owner,a=d.owner,q=a.owner,h=[];h.id=(e?"GH":"GF")+this._groupRowIdx+"-"+d.level;h.rowType=e?"groupHeader":"groupFooter";var i="",p;if(a.dataIndex>=0&&(p=this._data[f.r1][a.dataIndex].value)!==null)i=q._toStr(a,p);this._grid.options.showRowHeader&&h.push({html:"&nbsp;"});var g={html:""};if(e&&d.outlineMode!=="none")if(k.isExpanded)g.html='<div class="ui-icon '+k._getHeaderImageClass(true)+' ui-wijgrid-grouptogglebtn">&nbsp;</div>';else g.html='<div class="ui-icon '+k._getHeaderImageClass(false)+' ui-wijgrid-grouptogglebtn">&nbsp;</div>';h.push(g);var m=0,j="";if(a.aggregate&&a.aggregate!=="none"){j=this._getAggregate(f,a,a,e,i);if(a.parentVis)m=1}var b=e?d.headerText:d.footerText;if(b==="custom"){var o={data:this._data,column:a,groupByColumn:d.owner,groupText:i,text:"",groupingStart:f.r1,groupingEnd:f.r2,isGroupHeader:e,aggregate:j};if(this._grid._trigger("grouptext",null,o))b=o.text}else{if(b===undefined||b===null){if(e)b="{1}: {0}";if(j||j===0)b=b?b+" {2}":"{2}"}b=$.ui.wijgrid.stringFormat(b,i,a&&a.headerText?a.headerText:"",j.toString())}if(!b)b="&nbsp;";g.html+="<span>"+b+"</span>";this._addIndent(g,d.level-1);for(var n=m,c=this._grid.options.showRowHeader?1:0;c<f.c1;c++)if(this._leaves[c].parentVis)n++;c=f.c1+m;for(;c<this._leaves.length;c++){var a=this._leaves[c];if(a.dynamic!==true&&a.aggregate&&a.aggregate!=="none")break;if(a.parentVis)n++}for(;c<this._leaves.length;c++){var a=this._leaves[c];if(a.parentVis){var l=this._getAggregate(f,a,d.owner,e,i);if(!l&&l!==0)l="&nbsp;";h.push({html:l.toString()})}}g.colSpan=n;return h},this._getAggregate=function(c,a,g,h,i){var b="";if(!a.parentVis||!a.aggregate||a.aggregate==="none")return b;if(a.aggregate==="custom"){var f={data:this._data,column:a,groupByColumn:g,groupText:i,text:"",groupingStart:c.r1,groupingEnd:c.r2,isGroupHeader:h};if(this._grid._trigger("groupaggregate",null,f))b=f.text}else{for(var e=new this._tally,d=c.r1;d<=c.r2;d++)e.add(this._data[d][a.dataIndex].value);b=e.getValueString(a)}return b},this._getGroupCellRange=function(b,c,f){var g=c.leavesIdx,a=new $.ui.wijgrid.cellRange(b,g),d=this._groupHelper.getParentGroupRange(this._leaves,a,f);if(this._data[b].rowType==="data"){var h=this._data[b][c.dataIndex].value,e=0;for(a.r2=b,e=this._data.length-1;a.r2<e;a.r2++){if(this._data[a.r2+1].rowType!=="data"||d&&a.r2+1>d.r2)break;if(this._data[a.r2+1][c.dataIndex].value!==h)break}}return a},this._addGroupRange=function(a,b,g){var c=null,d=this._groupHelper.getChildGroupIndex(b,a.expandInfo);if(d>=0&&d<a.expandInfo.length)c=a.expandInfo[d];else{var h=new $.ui.wijgrid.cellRange(b.r1,b.r1,b.r2,b.r2),f=a.position==="footer"?true:g&&a.outlineMode!=="startCollapsed";c=new $.ui.wijgrid.groupRange(f,h,-1,a.position);c.owner=a;a.expandInfo.push(c)}if(c){var i=b.r1,e=b.r2;if(a.position==="headerAndFooter")e+=2;if(a.position!=="headerAndFooter")e++;c.cr.r2=e}return c},this._updateByGroupRange=function(c,g){for(var d=0,i=this._leaves.length;d<i;d++){var b=this._leaves[d].groupInfo;if(b&&b.level<g)for(var h=b.expandInfo?b.expandInfo.length:0,e=0;e<h;e++){var a=b.expandInfo[e],f=c.position==="headerAndFooter"?2:1;if(a.cr.r1>=c.cr.r1&&!(a.cr.r1===c.cr.r1&&a.position==="footer"))a.cr.r1+=f;if(a.cr.r2>=c.cr.r1)a.cr.r2+=f}}},this._addIndent=function(c,b){var a;if(b>0&&(a=this._grid.options.groupIndent))c.paddingLeft=a*b+"px"},this._tally=function(){this._sum=0;this._sum2=0;this._cntNumbers=0;this._cntStrings=0;this._max=0;this._min=0;this._minString=undefined;this._maxString=undefined;this.add=function(a){if(a===null||a==="")return;this._cntStrings++;if(typeof a==="string"){if(this._minString===undefined||a<this._minString)this._minString=a;if(this._maxString===undefined||a>this._maxString)this._maxString=a;a=this._parseValue(a)}if(!isNaN(a)){if(this._cntNumbers===0){this._min=a;this._max=a}this._cntNumbers++;this._sum+=a;this._sum2+=a*a;if(a<this._min)this._min=a;if(a>this._max)this._max=a}},this.getValueString=function(a){if(this._cntNumbers){var c=this._getValue(a.aggregate),b=a.owner;return b._toStr(a,c)}if(this._cntStrings)switch(a.aggregate){case"max":return this._maxString;case"min":return this._minString;case"count":return this._cntStrings.toString()}return""},this._getValue=function(b){switch(b){case"average":return this._cntNumbers===0?0:this._sum/this._cntNumbers;case"count":return this._cntStrings;case"max":return this._max;case"min":return this._min;case"sum":return this._sum;case"std":return this._cntNumbers<=1?0:Math.sqrt(this._getValue("var"));case"stdPop":return this._cntNumbers<=1?0:Math.sqrt(this._getValue("varPop"));case"var":return this._cntNumbers<=1?0:this._getValue("varPop")*this._cntNumbers/(this._cntNumbers-1);case"vapPop":if(this._cntNumbers<=1)return 0;var a=this._sum/this._cntNumbers;return this._sum2/this._cntNumbers-a*a}return 0},this._parseValue=function(a){var d=false,b=a.length;if(b>0&&a.indexOf("%")===b-1){d=true;a=a.substr(0,b-1)}var c=parseFloat(a);return isNaN(c)?NaN:d?c/100:c}}}});$.extend($.ui.wijgrid,{groupHelper:function(){this.getGroupInfo=function(b){if(b){if(!$.ui.wijgrid._getGroupInfoRegExp)$.ui.wijgrid._getGroupInfoRegExp=new RegExp(".*G([HF]){1}(\\d+)-(\\d+)$");var a=$.ui.wijgrid._getGroupInfoRegExp.exec(b.id);if(a){var e=parseInt(a[3]),d=parseInt(a[2]),c=a[1]==="H";return{level:e,index:d,isHeader:c,toString:function(){return(this.isHeader?"GH":"GF")+this.index+"-"+this.level}}}}return null},this.getColumnByGroupLevel=function(c,d){for(var b=0,e=c.length;b<e;b++){var a=c[b];if(a.groupInfo&&a.groupInfo.level===d)return a}return null},this.getGroupedColumnsCount=function(c){for(var d=0,a=0,e=c.length;a<e;a++){var b=c[a].groupInfo;if(b&&b.position!=="none")d++}return d};this.getChildGroupIndex=function(f,d){var a=0,c=d.length-1;while(a<=c){var b=(c-a>>1)+a,e=d[b].cr.r1-f.r1;if(e===0)return b;if(e<0)a=b+1;else c=b-1}return a},this.getParentGroupIndex=function(c,b){var a=this.getChildGroupIndex(c,b);if(a>0)a--;return a<b.length?a:-1},this.getChildGroupRanges=function(h,e,i){var f=[],c=this.getColumnByGroupLevel(h,i+1);if(c)for(var a=c.groupInfo.expandInfo,g=this.getChildGroupIndex(e,a),b=g,j=a.length;b<j;b++){var d=a[b];if(d.cr.r2<=e.r2)f.push(d);else break}return f},this.getParentGroupRange=function(d,f,b){if(b===undefined)b=65535;if(b-2>=0)for(var c=d.length-1;c>=0;c--){var a=d[c].groupInfo;if(!a||!a.expandInfo||a.level<0||a.level>=b)continue;var e=this.getParentGroupIndex(f,a.expandInfo);if(e>=0)return a.expandInfo[e]}return null},this.isParentCollapsed=function(e,c,d){if(d===1)return false;for(var b=d;b>1;b--){var a=this.getParentGroupRange(e,c,b);if(a&&!a.isExpanded)return true;c=a.cr}return false},this.isParentExpanded=function(e,c,d){if(d===1)return true;for(var b=d;b>1;b--){var a=this.getParentGroupRange(e,c,b);if(a&&a.isExpanded)return true;c=a.cr}return false}}});$.extend($.ui.wijgrid,{cellRange:function(b,a,d,c){switch(arguments.length){case 2:this.r1=this.r2=b;this.c1=this.c2=a;break;case 4:this.r1=b;this.r2=d;this.c1=a;this.c2=c;break;default:this.r1=0;this.r2=0;this.c1=0;this.c2=0}this.isSingleCell=function(){return this.r1===this.r2&&this.c1===this.c2}},merger:function(){this.merge=function(d,b){this.leaves=b;this.data=d;for(var c=0,e=b.length;c<e;c++){var a=b[c];a.dataIndex>=0&&!a.isBand&&(a.rowMerge==="free"||a.rowMerge==="restricted")&&this.mergeColumn(a)}delete this.data;delete this.leaves};this.mergeColumn=function(e){for(var d=e.dataIndex,b=0,g=this.data.length;b<g;b++){if(this.data[b].rowType!=="data")continue;var a=this.getCellRange(b,e);if(a.r1!==a.r2){var f=a.r2-a.r1+1;this.data[a.r1][d].rowSpan=f;for(var c=a.r1+1;c<=a.r2;c++)this.data[c][d].visible=false}b=a.r2}};this.getCellRange=function(b,d){var c=d.dataIndex,a=new $.ui.wijgrid.cellRange(b,c),j=this.data[b][c].value,i=this.data.length;for(a.r2=b;a.r2<i-1;a.r2++){var e=this.data[a.r2+1];if(e.rowType!=="data"||e[c].value!==j)break}var g=d.leavesIdx;if(g>0&&d.rowMerge==="restricted"){var f=this.leaves[g-1];if(f.dataIndex>=0){var h=this.getCellRange(b,f);a.r1=Math.max(a.r1,h.r1);a.r2=Math.min(a.r2,h.r2)}}return a}}});$.extend($.ui.wijgrid,{stringFormat:function(a){if(!a)return"";for(var b=1,c=arguments.length;b<c;b++)a=a.replace(new RegExp("\\{"+(b-1)+"\\}","gm"),arguments[b]);return a},validDataKey:function(a){return a!==undefined&&!(a<0)},iterateChildrenWidgets:function(a,b){if(a&&b){if(a.nodeType)a=$(a);a.find(".ui-widget").each(function(a,c){$.each($(c).data(),function(d,c){c.widgetName&&d!=="owner"&&b(a,c)})})}},domSelection:function(a){this.getSelection=function(){var b=0,c=0;if(a.selectionStart){b=a.selectionStart;c=a.selectionEnd}else if(document.selection){var d=document.selection.createRange().duplicate();c=d.text.length;b=Math.abs(d.moveStart("character",-a.value.length));c+=b}return{start:b,end:c,length:c-b}};this.setSelection=function(c){if(a.selectionStart)a.setSelectionRange(c.start,c.end);else{var b=a.createTextRange();b.collapse(true);b.moveStart("character",c.start);b.moveEnd("character",c.end);b.select()}}},bounds:function(c,d){if(c){var b=c.nodeType?$(c):c,a=b.offset();if(a)return d?{top:a.top,left:a.left,width:b[0].clientWidth||0,height:b[0].clientHeight||0}:{top:a.top,left:a.left,width:b.outerWidth(),height:b.outerHeight()}}return null},_getDOMText:function(a,c,b){if(b===undefined)b=0;if(a&&(!c||c&&b<2))if(a.nodeType===3)return a.nodeValue;else if(a.nodeType===1){switch(a.type){case"button":case"text":case"textarea":case"select-one":return a.value;case"checkbox":return a.checked.toString()}for(var e="",d=0;a.childNodes[d];d++)e+=this._getDOMText(a.childNodes[d],c,b+1);return e}return""}});$.extend($.ui.wijgrid,{measurments:[],timerOn:function(a){this.measurments[a]=(new Date).getTime()},timerOff:function(a){var b=((new Date).getTime()-this.measurments[a])/1e3;delete this.measurments[a];return b},shallowMerge:function(a,c){if(c&&a)for(name in c){var d=c[name],b=typeof d;if((b==="string"||b==="boolean"||b=="number")&&a[name]===undefined)a[name]=d}}});var wijgridStringParser={parseDOM:function(d,b,c,a){return this.parse($.ui.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,c,d,b){return a===null||a===b?null:a===undefined||a==="&nbsp;"?"":""+a},toStr:function(a,c,d,b){return a===null?b:a}},wijgridNumberParser={parseDOM:function(d,b,c,a){return this.parse($.ui.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,c,d,b){return typeof a==="number"&&isNaN(a)?NaN:!a&&a!==0||a==="&nbsp;"||a===b?null:$.parseFloat(a,10,c.name)},toStr:function(b,d,a,c){return b===null?c:$.format(b,a?a:"n",d.name)}},wijgridCurrencyParser={parseDOM:function(d,b,c,a){return this.parse($.ui.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,b,d,c){if(typeof a==="number"&&isNaN(a))return NaN;if(!a&&a!==0||a==="&nbsp;"||a===c)return null;if(typeof a==="string")a=a.replace(b.numberFormat.currency.symbol,"");return $.parseFloat(a,10,b.name)},toStr:function(b,d,a,c){return b===null?c:$.format(b,a?a:"c",d.name)}},wijgridDateTimeParser={parseDOM:function(d,b,c,a){return this.parse($.ui.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,c,d,b){if(a instanceof Date)return a;if(!a||a==="&nbsp;"||a===b)return null;var e=$.parseDate(a,d,c.name);return e},toStr:function(b,d,a,c){return b===null?c:$.format(b,a?a:"d",d.name)}},wijgridBoolParser={parseDOM:function(d,b,c,a){return this.parse($.ui.wijgrid._getDOMText(d,true),b,c,a)},parse:function(a,d,e,c){var b=typeof a;if(b==="boolean")return a;if(b==="string")a=$.trim(a);if(!a||a==="&nbsp;"||a===c)return null;switch(a.toLowerCase()){case"true":return true;case"false":return false}return NaN},toStr:function(a,c,d,b){return a===null?b:a?"true":"false"}};$.extend($.ui.wijgrid,{filterOperatorsCache:function(){var a={};this.add=function(b){if(b&&b.name&&b.operator){var c=b.name.toLowerCase();if(!a[c])a[c]=b}},this.clear=function(){a.length=0},this.getByName=function(b){return a[b.toLowerCase()]},this.getByDataType=function(d){var c=[];for(var e in a){var b=a[e];$.inArray(d,b.applicableTo)>=0&&c.push(b)}return c},this.removeCustom=function(){for(var b in a)if(a[b].custom)delete a[b]};this.sort=function(a,e){switch(e.toLowerCase()){case"alphabetical":a.sort(d);break;case"alphabeticalcustomfirst":a.sort(c);break;case"alphabeticalembeddedFirst":a.sort(b)}return a};function d(c,d){var a=c.name.toLowerCase(),b=d.name.toLowerCase();if(a!==b){if(a==="nofilter")return-1;if(b==="nofilter")return 1}return a===b?0:a<b?-1:1}function b(c,d){var a=c.name.toLowerCase(),b=d.name.toLowerCase();if(a!==b){if(a==="nofilter")return-1;if(b==="nofilter")return 1}if(c.custom!==d.custom){if(c.custom)return 1;if(d.custom)return-1}return a===b?0:a<b?-1:1}function c(c,d){var a=c.name.toLowerCase(),b=d.name.toLowerCase();if(a!==b){if(a==="nofilter")return-1;if(b==="nofilter")return 1}if(c.custom!==d.custom){if(c.custom)return-1;if(d.custom)return 1}return a===b?0:a<b?-1:1}}});$.ui.wijgrid.embeddedFilters=[{name:"NoFilter",arity:1,applicableTo:["string","number","datetime","currency","boolean"],operator:function(){return true}},{name:"Contains",arity:2,applicableTo:["string"],operator:function(a,b){return a===b?true:a?a.indexOf(b)>=0:false}},{name:"NotContain",arity:2,applicableTo:["string"],operator:function(a,b){return a===b?false:a?a.indexOf(b)<0:true}},{name:"BeginsWith",arity:2,applicableTo:["string"],operator:function(a,b){return a===b?true:a?a.indexOf(b)===0:false}},{name:"EndsWith",arity:2,applicableTo:["string"],operator:function(a,b){if(a===b)return true;if(a){var c=a.lastIndexOf(b);return c>=0?a.length-c===b.length:false}return false}},{name:"Equals",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b===a}},{name:"NotEqual",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b!==a}},{name:"Greater",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b>a}},{name:"Less",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b<a}},{name:"GreaterOrEqual",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b>=a}},{name:"LessOrEqual",arity:2,applicableTo:["string","number","datetime","currency","boolean"],operator:function(b,a){if(b instanceof Date)b=b.getTime();if(a instanceof Date)a=a.getTime();return b<=a}},{name:"IsEmpty",arity:1,applicableTo:["string"],operator:function(a){return!a&&a!==0&&a!==false}},{name:"NotIsEmpty",arity:1,applicableTo:["string"],operator:function(a){return!!a||a===0||a===false}},{name:"IsNull",arity:1,applicableTo:["string","number","datetime","currency","boolean"],operator:function(a){return a===null}},{name:"NotIsNull",arity:1,applicableTo:["string","number","datetime","currency","boolean"],operator:function(a){return a!==null}}];$.extend($.ui.wijgrid,{htmlTableAccessor:function(d){var b=[],c=0,a=d;e();function e(){for(var f=[],h=0,n=a.rows.length;h<n;h++){var e=[];b[h]=e;for(var k=a.rows[h],g=0,d=0,m=k.cells.length;g<m;g++,d++){for(var j=k.cells[g];f[d]>1;d++){f[d]--;e[d]={cellIdx:-1,colIdx:-1}}if(!(f[d]>1))f[d]=j.rowSpan;e[d]={cellIdx:g,colIdx:-1};e[g].colIdx=d;for(var l=j.colSpan;l>1;l--)e[++d]={cellIdx:-1,colIdx:-1}}for(var i=f.length;d<i;d++){f[d]--;e[d]={cellIdx:-1,colIdx:-1}}c=Math.max(c,i)}}this.element=function(){return d};this.getCellIdx=function(a,d){return a<c?b[d][a].cellIdx:-1};this.getColumnIdx=function(a,e){if(typeof a!=="number"){var d=a;a=d.cellIndex;e=d.parentNode.rowIndex}return a<c?b[e][a].colIdx:-1};this.getSectionLength=function(d){var b=a;switch(d){case 1:b=a.tHead;break;case 2:var c;if((c=a.tBodies)&&c.length)b=c[0];break;case 3:b=a.tFoot}return b?b.rows.length:0};this.getSectionRow=function(d,e){var b=a;switch(e){case 1:b=a.tHead;break;case 2:var c;if((c=a.tBodies)&&c.length)b=c[0];break;case 3:b=a.tFoot}return b?b.rows[d]:undefined};this.forEachColumnCellNatural=function(b,f,h){for(var c=0,g=a.rows.length;c<g;c++){var e=a.rows[c];if(b<e.cells.length){var d=f(e.cells[b],b,h);if(d!==true)return d}}return true};this.forEachColumnCell=function(f,g,i){for(var c=0,h=b.length;c<h;c++){var j=a.rows[c],d=this.getCellIdx(f,c);if(d>=0){var e=g(j.cells[d],c,i);if(e!==true)return e}}return true};this.forEachRowCell=function(f,e,h){for(var d=a.rows[f],b=0,g=d.cells.length;b<g;b++){var c=e(d.cells[b],b,h);if(c!==true)return c}return true};this.colGroupTag=function(){var b=a.getElementsByTagName("colgroup");return b!=null&&b.length>0?b[0]:null};this.colTags=function(){var a=this.colGroupTag();return a!=null?a.getElementsByTagName("col"):[]}}});$.ui.wijgrid.cellInfo=function(a,b){var d=false,c=null;this.cellIndex=function(b){if(b===undefined)return a;a=b};this.rowIndex=function(a){if(a===undefined)return b;b=a};this.isEqual=function(c){return c&&c.rowIndex()===b&&c.cellIndex()===a};this.tableCell=function(){if(c&&this._isValid()){var d=c._getDataToAbsOffset();return c._field("view").getCell(a+d.x,b+d.y)}return null};this.value=function(){return c&&this._isValid()?c.dataTable[b][a].value:undefined};this.toString=function(){return a+":"+b};this._dataToAbs=function(c){a-=c.x;b-=c.y;return this};this._clip=function(e){var d=false,c;if(a<(c=e.topLeft().cellIndex())){d=true;a=c}if(a>(c=e.bottomRight().cellIndex())){d=true;a=c}if(b<(c=e.topLeft().rowIndex())){d=true;b=c}if(b>(c=e.bottomRight().rowIndex())){d=true;b=c}return d};this._clone=function(){return new $.ui.wijgrid.cellInfo(a,b)};this._column=function(){if(c&&this._isValid()){var b=c._getDataToAbsOffset();return c._field("visibleLeaves")[a+b.x]}return null};this._row=function(){return c&&this._isValid()?c._rows().item(b):null};this._isValid=function(){return a>=0&&b>=0};this._isEdit=function(a){if(!arguments.length)return d;d=a};this._setGridView=function(a){c=a}};$.ui.wijgrid.cellInfo.prototype.outsideValue=new $.ui.wijgrid.cellInfo(-1,-1);$.ui.wijgrid.cellInfoRange=function(d,c){if(!d||!c)throw"invalid arguments";var a=d._clone(),b=c._clone();this.bottomRight=function(){return b};this.isEqual=function(c){return c&&a.isEqual(c.topLeft())&&b.isEqual(c.bottomRight())};this.topLeft=function(){return a};this.toString=function(){return a.toString()+" - "+b.toString()};this._isIntersect=function(c){if(c){var d=c.bottomRight().rowIndex()-c.topLeft().rowIndex()+1,f=b.rowIndex()-a.rowIndex()+1;if(c.topLeft().rowIndex()+d-a.rowIndex()<d+f){var e=c.bottomRight().cellIndex()-c.topLeft().cellIndex()+1,g=b.cellIndex()-a.cellIndex()+1;return c.topLeft().cellIndex()+e-a.cellIndex()<e+g}}return false};this._isValid=function(){return a._isValid()&&b._isValid()};this._clip=function(c){return a._clip(c)|b._clip(c)};this._clone=function(){return new $.ui.wijgrid.cellInfoRange(a._clone(),b._clone())};this._containsCellInfo=function(c){return c&&c.cellIndex()>=a.cellIndex()&&c.cellIndex()<=b.cellIndex()&&c.rowIndex()>=a.rowIndex()&&c.rowIndex()<=b.rowIndex()};this._containsCellRange=function(a){return a&&this._containsCellInfo(a.topLeft())&&this._containsCellInfo(a.bottomRight())};this._extend=function(d,c){if(d===1){a.rowIndex(c.topLeft().rowIndex());b.rowIndex(c.bottomRight().rowIndex())}else if(d===2){a.cellIndex(c.topLeft().cellIndex());b.cellIndex(c.bottomRight().cellIndex())}return this};this._normalize=function(){var c=a.cellIndex(),e=a.rowIndex(),d=b.cellIndex(),f=b.rowIndex();a.cellIndex(Math.min(c,d));a.rowIndex(Math.min(e,f));b.cellIndex(Math.max(c,d));b.rowIndex(Math.max(e,f))}};$.extend($.ui.wijgrid,{flatView:function(a){var b=null,c=null;this.element=a.element;this.initialize=function(){b=null;c=null;this._createLayout()};this._createLayout=function(){var c=a.options,b=this.element.find(".ui-wijgrid-flatview")[0];b!=null&&b.parentNode.removeChild(b);b=this.element.find(".ui-wijgrid-fixedview")[0];b!=null&&b.parentNode.removeChild(b);c.scrollMode!=="none"&&this.element.wrapInner('<div class="ui-wijgrid-fixedview"><div class="ui-wijgrid-split-area ui-wijgrid-split-area-se ui-wijgrid-content-area"></div></div>')};this.updateSplits=function(){var d=this,a=d._getMappedScrollMode(),e=this.element.find(".ui-wijgrid-content-area");e.width(this.element.width()).height(this.element.height());if(a.hScrollBarVisibility==="visible"||a.hScrollBarVisibility==="auto"){var f=b.colTags(),c=$(b.element());c.css("tableLayout","");$.each(f,function(e,c){if(c.width===""){var b=d.getHeaderCell(e);if(b){var a=b.offsetWidth;if(a){c.width=a;b.width=a+"px"}}}});var g=0;$.each(f,function(b,a){if(a.width)g+=parseInt(a.width)});c.css("width",g);c.css("tableLayout","fixed")}var a=d._getMappedScrollMode();e.wijsuperpanel({vScroller:{scrollBarVisibility:a.vScrollBarVisibility},hScroller:{scrollBarVisibility:a.hScrollBarVisibility},allowResize:false,scrolling:jQuery.proxy(this._onScrolling,this),scrolled:jQuery.proxy(this._onScrolled,this)});return};this._getMappedScrollMode=function(){var c=a.options.scrollMode,b=hScrollBarVisibility="auto";switch(c){case"horizontal":b="hidden";hScrollBarVisibility="visible";break;case"vertical":b="visible";hScrollBarVisibility="hidden";break;case"both":b="visible";hScrollBarVisibility="visible"}return{vScrollBarVisibility:b,hScrollBarVisibility:hScrollBarVisibility}};this.refreshPanel=function(){var b=this.element.find(".ui-wijgrid-content-area"),a=this._getMappedScrollMode();b.wijsuperpanel({vScroller:{scrollBarVisibility:a.vScrollBarVisibility},hScroller:{scrollBarVisibility:a.hScrollBarVisibility}});b.wijsuperpanel("paintPanel")};this.updateSplitAreaBounds=function(){var b=a.options,d=b.width||this.element.width(),c=b.height||this.element.height();if(c<=0)c=this.element.find(".ui-wijgrid-split-area-se .ui-wijgrid-table:first")[0].offsetHeight;var f=17,e=17;this.element.height(c);this.element.width(d);this.element.find(".ui-wijgrid-split-area-se").height(c-b.splitDistanceY).css("top",b.splitDistanceY);this.element.find(".ui-wijgrid-split-area-se").width(d-b.splitDistanceX).css("left",b.splitDistanceX)};this._onSplitContentScrollNW=function(){this.element.find(".ui-wijgrid-split-area-sw")[0].scrollLeft=this.element.find(".ui-wijgrid-split-area-nw")[0].scrollLeft;this.element.find(".ui-wijgrid-split-area-ne")[0].scrollTop=this.element.find(".ui-wijgrid-split-area-nw")[0].scrollTop};this._onSplitContentScrollNE=function(){this.element.find(".ui-wijgrid-split-area-se")[0].scrollLeft=this.element.find(".ui-wijgrid-split-area-ne")[0].scrollLeft;this.element.find(".ui-wijgrid-split-area-nw")[0].scrollTop=this.element.find(".ui-wijgrid-split-area-ne")[0].scrollTop};this._onSplitContentScrollSW=function(){this.element.find(".ui-wijgrid-split-area-nw")[0].scrollLeft=this.element.find(".ui-wijgrid-split-area-sw")[0].scrollLeft;this.element.find(".ui-wijgrid-split-area-se")[0].scrollTop=this.element.find(".ui-wijgrid-split-area-sw")[0].scrollTop};this._onSplitContentScrollSE=function(){this.element.find(".ui-wijgrid-split-area-ne")[0].scrollLeft=this.element.find(".ui-wijgrid-split-area-se")[0].scrollLeft;this.element.find(".ui-wijgrid-split-area-sw")[0].scrollTop=this.element.find(".ui-wijgrid-split-area-se")[0].scrollTop};this.render=function(){var B=document.createDocumentFragment(),k=a._field("visibleLeaves"),p=B.appendChild(document.createElement("table")),q=null,o=a._field("spanTable");if(o&&o.length){q=p.createTHead();for(var H=o[0].length,j=0,F=o.length;j<F;j++){var h=q.insertRow(-1);h.className="ui-wijgrid-headerrow";for(var I=0,i=0;i<H;i++){var f=o[j][i];if(f.column&&(f.column.visible||f.column.visible===undefined)){f.column.thX=I++;f.column.thY=j;var e=document.createElement("th");if(i===0&&a.options.showRowHeader)e.className="ui-state-default ui-wijgrid-rowheader";if(f.colSpan>1)e.colSpan=f.colSpan;if(f.rowSpan>1)e.rowSpan=f.rowSpan;e.innerHTML=f.column.headerText?f.column.headerText:"&nbsp;";h.appendChild(e)}}}}if(a.options.showFilter){if(!q)q=p.createTHead();for(var s="",n=0,A=k.length;n<A;n++){var g=k[n];if(g.dataIndex>=0&&!g.isBand&&g.showFilter)s+='<td><div class="ui-wijgrid-filter ui-widget ui-state-default ui-corner-all"><span class="ui-wijgrid-filtericon"></span><input type="text" class="ui-wijgrid-filter-input" style="width:1px" /><a class="ui-wijgrid-filter-trigger ui-corner-right ui-state-default" href="#"><span class="ui-icon ui-icon-triangle-1-s"></span></a></div></td>';else s+="<td>&nbsp;</td>"}$(q).append('<tr class="ui-wijgrid-filterrow">'+s+"</tr>")}for(var v=document.createElement("colgroup"),n=0,A=k.length;n<A;n++){var z=document.createElement("col"),g=k[n];if(g.width)z.width=g.width;v.appendChild(z)}p.appendChild(v);for(var y=a.dataTable,x=p.appendChild(document.createElement("tbody")),r=0,j=0,G=y.length;j<G;j++){var c=y[j],C=c.length,h=x.insertRow(-1),m="ui-wijgrid-row ui-widget-content";switch(c.rowType){case"data":m+=" ui-wijgrid-datarow";h.setAttribute("dataRowIndex",r);if(r%2!==0)m+=" ui-wijgrid-alternatingrow";r++;break;case"groupHeader":m+=" ui-wijgrid-groupheaderrow";break;case"groupFooter":m+=" ui-wijgrid-groupfooterrow"}if(m)h.className=m;if(c.display)h.style.display="none";if(c.id)h.id=c.id;for(var i=0,E=k.length;i<E;i++){var g=k[i],D=g.dataIndex,b=0,w=false,u=false;switch(c.rowType){case"data":u=true;b=D;if(b>=0&&(!c[b]||c[b].visible===false))continue;break;case"groupHeader":case"groupFooter":b=i;if(b>=C)w=true}if(w)break;var e=document.createElement("td"),l=undefined;if(b>=0)if(u&&g.dataParser){var t=c[b].value;e.className="wijdata-type-"+(g.dataType||"string");if(g.dataType==="boolean")l=t?'<input type="checkbox" checked="checked" disabled="disabled" />':'<input type="checkbox" disabled="disabled" />';else l=a._toStr(g,t)}else l=c[b].html;if(!l)l="&nbsp;";if(i===0&&a.options.showRowHeader)e.className+=" ui-wijgrid-rowheader";e.className+=" wijgridtd";e.innerHTML=l;if(b>=0){if(c[b].rowSpan>1)e.rowSpan=c[b].rowSpan;if(c[b].colSpan>1)e.colSpan=c[b].colSpan;if(c[b].paddingLeft)e.style.paddingLeft=c[b].paddingLeft}h.appendChild(e)}!h.cells.length&&x.removeChild(h)}d(p)};this.attachEvents=function(){};this.subTables=function(){return[b]};this.focusableElement=function(){return b.element()};this.forEachRowCell=function(c,a,d){return b.forEachRowCell(c,a,d)};this.forEachColumnCell=function(c,a,d){return b.forEachColumnCell(c,a,d)};this.ensureWidth=function(i){if(a.options.scrollMode!=="none"){if(a.options.scrollMode==="vertical")return;var h=$(b.element());h.css({width:""});var f=0;$.each(b.colTags(),function(b,a){if(a.width)f+=parseInt(a.width)});f&&h.width(f);c.wijsuperpanel("paintPanel")}else{var g=a.element.width(),e=$(b.element()).width(),d=e<=g?e:Math.max(g,e);if(!d)d=0;d+=i;if(d<0)d=0;a.element.width(d)}};this.getCell=function(e,a){var c=b.getCellIdx(e,a);if(c>=0){var d=this.getJoinedRows(a,0);if(d[0])return d[0].cells[c]}return null};this.getAbsoluteRowIndex=function(a){return a.rowIndex};this.getJoinedCols=function(c){var a=$(b.element()).find("> colgroup");if(a.length)if(c<a[0].childNodes.length)return[a[0].childNodes[c],null];return[null,null]};this.getJoinedRows=function(a,c){return[b.getSectionRow(a,c),null]};this.getJoinedTables=function(c,a){return[b,null,a]};this.getHeaderCell=function(d){var c=a._field("visibleLeaves")[d],b=a._headerRows();return b?(new $.ui.wijgrid.rowAccessor).getCell(b.item(c.thY),c.thX):null};this.getAbsCellInfo=function(a){return new $.ui.wijgrid.cellInfo(b.getColumnIdx(a),a.parentNode.rowIndex)};this.getVisibleAreaBounds=function(){var c=$.ui.wijgrid.bounds(b.element());if(a.options.scrollMode==="none")return c;else{var d=$.ui.wijgrid.bounds(this.element.find(".ui-wijgrid-split-area-se:first")[0]);return{top:c.top,left:c.left,width:Math.min(d.width,c.width),height:Math.min(d.height,c.height)}}};var d=function(e){var d=$(e);d.addClass("ui-wijgrid-table").find("> tbody").addClass("ui-widget-content ui-wijgrid-data");if(a.options.scrollMode!=="none"){c=a.element.find(".ui-wijgrid-content-area").empty();d.appendTo(c)}else{a.element.find(" > :not(.ui-wijpager)").remove();if(a.$topPagerDiv)a.$topPagerDiv.after(d);else a.element.prepend(d)}b=new $.ui.wijgrid.htmlTableAccessor(e)}}});$.ui.wijgrid.selection=function(a){var f=0,j,d=new $.ui.wijgrid.cellInfoOrderedCollection(a),b=new $.ui.wijgrid.cellInfoOrderedCollection(a),c=new $.ui.wijgrid.cellInfoOrderedCollection(a),e=new $.ui.wijgrid.cellInfoOrderedCollection(a),h=null,i=null;this.selectedCells=function(){return c};this.addRange=function(b,e,d,f){if(!b&&arguments.length==1)throw"invalid argument";var c=arguments.length===4?new $.ui.wijgrid.cellInfoRange(new $.ui.wijgrid.cellInfo(b,e),new $.ui.wijgrid.cellInfo(d,f)):b._clone();c._normalize();if(!c._isValid())throw"invalid argument";this.beginUpdate();this._startNewTransaction(a._field("currency"));this._selectRange(c,false,true,0,null);this.endUpdate()};this.clear=function(){this.beginUpdate();b._clear();b._addFrom(c);this.endUpdate()};this.selectAll=function(){this.beginUpdate();this._selectRange(a._getDataCellsRange(),false,false,0,null);this.endUpdate()};this.beginUpdate=function(){f++};this.endUpdate=function(){if(f>0){f--;if(f===0){k();if(d.length()||b.length()){h!=null&&h.UnderlyingDataChanged();i!=null&&i.UnderlyingDataChanged();a._trigger("selectionchanged",null,{addedCells:d,removedCells:b})}d=new $.ui.wijgrid.cellInfoOrderedCollection(a);b._clear()}}};this._multipleRangesAllowed=function(){var b=a.options.selectionMode;return b&&((b=b.toLowerCase())==="multicolumn"||b==="multirow"||b==="multirange")};this._anchorCell=function(){return j};this._startNewTransaction=function(b){if(b){j=b._clone();e=new $.ui.wijgrid.cellInfoOrderedCollection(a)}};this._clearRange=function(h,m){var f=a.options.selectionMode.toLowerCase();if(h._isValid()&&f!=="none"&&c.length()>0){var d=h._clone();d._normalize();d._clip(a._getDataCellsRange());if(!h._isValid())return;d=g(d,f,m,null);this.beginUpdate();switch(f){case"singlecell":d._containsCellInfo(c.item(0))&&this.clear();break;case"singlecolumn":case"singlerow":case"singlerange":for(var o=d.bottomRight().rowIndex(),n=d.bottomRight().cellIndex(),e=false,j=d.topLeft().rowIndex();!e&&j<=o;j++)for(var i=d.topLeft().cellIndex();!e&&i<=n;i++){e=c.indexOf(i,j)>=0;e&&this.clear()}break;case"multicolumn":case"multirow":case"multirange":for(var p=c.length(),k=0;k<p;k++){var l=c.item(k);d._containsCellInfo(l)&&b._add(l)}}this.endUpdate()}};this._selectRange=function(h,k,f,i,j){var d=a.options.selectionMode.toLowerCase();if(d!=="none"&&h._isValid()){var c=h._clone();c._normalize();c._clip(a._getDataCellsRange());if(!c._isValid())return;this.beginUpdate();if(!this._multipleRangesAllowed())this.clear();else if(k||f){if(f){b._clear();b._addFrom(e)}}else this.clear();c=g(c,d,i,j);l(c,true);this.endUpdate()}};function g(b,f,e,c){var d=a._getDataCellsRange();switch(f){case"singlecell":b=c===null?new $.ui.wijgrid.cellInfoRange(b.topLeft(),b.topLeft()):new $.ui.wijgrid.cellInfoRange(c,c);break;case"singlecolumn":b=c===null?new $.ui.wijgrid.cellInfoRange(b.topLeft(),b.topLeft()):new $.ui.wijgrid.cellInfoRange(c,c);b._extend(1,d);break;case"singlerow":b=c===null?new $.ui.wijgrid.cellInfoRange(b.topLeft(),b.topLeft()):new $.ui.wijgrid.cellInfoRange(c,c);b._extend(2,d);break;case"singlerange":b._extend(e,d);break;case"multicolumn":b._extend(1,d);break;case"multirow":b._extend(2,d);break;case"multirange":b._extend(e,d)}return b}function k(){for(var l=a._getDataToAbsOffset(),j=l.x,k=l.y,n=a._field("view"),h=b.length(),g=0;g<h;g++){var f=b.item(g);if(d.indexOf(f)<0){var i=n.getCell(f.cellIndex()+j,f.rowIndex()+k);i&&$(i).removeClass("ui-state-highlight");c._remove(f);e._remove(f)}else{b._removeAt(g);g--;h--}}h=d.length();for(var g=0;g<h;g++){var f=d.item(g),m=c.indexOf(f);if(m<0){var i=n.getCell(f.cellIndex()+j,f.rowIndex()+k);i&&$(i).addClass("ui-state-highlight");c._insertUnsafe(f,~m);e._add(f)}else{d._removeAt(g);g--;h--}}}function l(e,l){var h=e.topLeft().cellIndex(),j=e.topLeft().rowIndex(),i=e.bottomRight().cellIndex(),k=e.bottomRight().rowIndex();if(l)for(var g=d.length(),c=j;c<=k;c++)for(var a=h;a<=i;a++){var f=new $.ui.wijgrid.cellInfo(a,c);if(g===0)d._appendUnsafe(f);else d._add(f)}else for(var g=b.length(),c=j;c<=k;c++)for(var a=h;a<=i;a++){var f=new $.ui.wijgrid.cellInfo(a,c);if(g===0)b._appendUnsafe(f);else b._add(f)}}};$.ui.wijgrid.cellInfoOrderedCollection=function(b){if(!b)throw"argument is null";var a=[];this.item=function(b){return a[b]};this.length=function(){return a.length};this.indexOf=function(c,g){if(arguments.length===1){g=c.rowIndex();c=c.cellIndex()}var b=0,f=a.length-1;while(b<=f){var e=b+(f-b>>1),h=a[e],d=h.rowIndex()-g;if(d===0)d=h.cellIndex()-c;if(d<0)b=e+1;else if(d>0)f=e-1;else return e}return~b};this.toString=function(){for(var c="",b=0,d=a.length;b<d;b++)c+=a[b].toString()+"\n";return c};this._add=function(c){var d=this.indexOf(c);if(d<0){a.splice(~d,0,c);c._setGridView(b);return true}return false};this._addFrom=function(d){if(d){var e=d.length(),f=a.length;if(f===0){a.length=e;for(var c=0;c<e;c++){a[c]=d.item(c);a[c]._setGridView(b)}}else for(var c=0;c<e;c++)this._add(d.item(c))}};this._appendUnsafe=function(c){a[a.length]=c;c._setGridView(b)};this._insertUnsafe=function(c,b){a.splice(b,0,c)};this._clear=function(){a.length=0};this._remove=function(c){var b=this.indexOf(c);if(b>=0){a.splice(b,1);return true}return false};this._removeAt=function(b){a.splice(b,1)};this._getColumnsIndicies=function(){var e=[],c=a.length;if(c){for(var d=[],b=0;b<c;b++)d[a[b].cellIndex()]=1;c=d.length;for(var f=0,b=0;b<c;b++)if(d[b])e[f++]=b}return e};this._getSelectedRowsIndicies=function(){var e=[],c=a.length;if(c){for(var d=[],b=0;b<c;b++)d[a[b].rowIndex()]=1;c=d.length;for(var f=0,b=0;b<c;b++)if(d[b])e[f++]=b}return e};this._rectangulate=function(){var h=a.length;if(h){for(var c=4294967295,e=4294967295,d=0,f=0,g=0;g<h;g++){var b=a[g];c=Math.min(c,b.cellIndex());e=Math.min(e,b.rowIndex());d=Math.max(d,b.cellIndex());f=Math.Max(f,b.rowIndex())}return new $.ui.wijgrid.cellInfoRange(new $.ui.wijgrid.cellInfo(c,e),new $.ui.wijgrid.cellInfo(d,f))}return null}};$.extend($.ui.wijgrid,{selectionui:function(a){var p=10,s="{0}."+a.widgetName+".selectionui",b=new $.ui.wijgrid.cellInfoOrderedCollection(a),j,d,f,c,g=false,i=false,h=a._field("view"),r=a._field("visibleLeaves").length;a.element.bind(e("mousedown"),o);this.dispose=function(){a.element.unbind(e("mousedown"),o);k()};function o(c){if(!a._canInteract()||a.options.selectionMode.toLowerCase()==="none")return;var b=h.getVisibleAreaBounds(),e={x:c.pageX,y:c.pageY},f=c.target&&c.target.tagName!==undefined?c.target.tagName.toLowerCase():undefined,g=$(c.target);if((!f||(f==="td"||f==="th")&&g.hasClass("wijgridtd")||f==="div"&&g.hasClass("wijgriddiv"))&&(e.x>b.left&&e.x<b.left+b.width)&&(e.y>b.top&&e.y<b.top+b.height)){q();j=e;d=l(j)}}function m(v){if(!d||!d._isValid())return;var o={x:v.pageX,y:v.pageY};if(!g)g=Math.abs(j.x-o.x)>p||Math.abs(j.y-o.y)>p;if(g){var w=l(o);if(!w._isValid())return;f=w;var e=new $.ui.wijgrid.cellInfoRange(d,f);e._normalize();e._clip(a._getDataCellsRange());if(e._isValid()&&!e.isEqual(c)){var n=a._getDataToAbsOffset();c=e;for(var m=new $.ui.wijgrid.cellInfoOrderedCollection(a),y=e.bottomRight().rowIndex(),x=e.bottomRight().cellIndex(),s=e.topLeft().rowIndex();s<=y;s++)for(var q=e.topLeft().cellIndex();q<=x;q++)m._appendUnsafe(new $.ui.wijgrid.cellInfo(q,s));for(var k=0,r=b.length();k<r;k++){var i=b.item(k);if(m.indexOf(i)<0){if(a.selection().selectedCells().indexOf(i)<0){var t=h.getCell(i.cellIndex()+n.x,i.rowIndex()+n.y);t&&$(t).removeClass("ui-state-highlight")}b._removeAt(k);k--;r--}}for(var k=0,r=m.length();k<r;k++){var i=m.item(k);if(b.indexOf(i)<0&&a.selection().selectedCells().indexOf(i)<0)if(b._add(i)){var u=h.getCell(i.cellIndex()+n.x,i.rowIndex()+n.y);u&&$(u).addClass("ui-state-highlight")}}}}}function n(e){k();if(g){g=false;if(c&&c._isValid()){a._changeCurrency(f);(!e.shiftKey||!a.selection()._multipleRangesAllowed()&&a.options.selectionMode.toLowerCase()!=="singleRange")&&a.selection()._startNewTransaction(d);a.selection().beginUpdate();a.selection()._selectRange(c,e.shiftKey,e.ctrlKey,0,f);a.selection().endUpdate();for(var m=a._field("view"),j=a._getDataToAbsOffset(),i=0,n=b.length();i<n;i++){var h=b.item(i);if(a.selection().selectedCells().indexOf(h)<0){var l=m.getCell(h.cellIndex()+j.x,h.rowIndex()+j.y);l!=null&&$(l).removeClass("ui-state-highlight")}}b._clear();d=f=c=null;return false}}}function q(){if(!i)try{a.element.disableSelection();a.element.css({MozUserSelect:"none",WebkitUserSelect:"none"});$(document).bind(e("mousemove"),m).bind(e("mouseup"),n)}finally{i=true}}function k(){if(i)try{a.element.enableSelection();a.element.css({MozUserSelect:"",WebkitUserSelect:""});$(document).unbind(e("mousemove"),m).unbind(e("mouseup"),n)}finally{i=false}}function e(a){return $.ui.wijgrid.stringFormat(s,a)}function l(f){var c=0,e=r-1,b=0,i=-1;while(c<=e){b=(e-c>>1)+c;var d=$.ui.wijgrid.bounds(h.getHeaderCell(b));if(f.x<d.left)e=b-1;else if(f.x>d.left+d.width)c=b+1;else{i=b;break}}if(i===-1)return $.ui.wijgrid.cellInfo.prototype.outsideValue;var g=new $.ui.wijgrid.rowAccessor(h,0,0,0),j=-1,c=0,e=g.length()-1,b=0;while(c<=e){b=(e-c>>1)+c;var m=g.item(b),d=$.ui.wijgrid.bounds(g.getCell(m,0));if(f.y<d.top)e=b-1;else if(f.y>d.top+d.height)c=b+1;else{j=b;break}}if(j==-1)return $.ui.wijgrid.cellInfo.prototype.outsideValue;var k=a._getDataToAbsOffset(),l=new $.ui.wijgrid.cellInfo(i-k.x,j-k.y);l._clip(a._getDataCellsRange());return l}}});$.ui.wijgrid.rowAccessor=function(d,c,a,b){if(!a)a=0;if(!b)b=0;this.item=function(b){var e=this.length();return b<e?d.getJoinedRows(b+a,c):null};this.length=function(){var g=d.getJoinedTables(true,0),e=0,f;if(f=g[0])e=f.getSectionLength(c);if(f=g[1])e+=f.getSectionLength(c);e-=a+b;if(e<0)e=0;return e};this.iterateCells=function(b,e,i){if(b&&e)for(var f=0,c=0,j=b.length;c<j;c++){var a=b[c];if(a)for(var d=0,g=a.cells.length;d<g;d++){var h=e(a.cells[d],f++,i);if(h!==true)return}}};this.getCell=function(d,b){var a;if(a=d[0]){var c=a.cells.length;if(b<c)return a.cells[b];b-=c;if(a=d[1]){c=a.cells.length;if(b<c)return a.cells[b]}}return null};this.cellsCount=function(c){var b=0,a;if(a=c[0]){b=a.cells.Length;if(a=c[1])b+=a.cells.Length}return b}};$.extend($.ui.wijgrid,{cellEditorHelper:function(){this.currencyEditStart=function(e,h){var d=false,a=e.currency();if(a._isValid()&&!a._isEdit()&&a._column().dataIndex>=0){var c=a._row();if(c&&c.length){var g=c[0].attributes.dataRowIndex!==undefined?parseInt(c[0].attributes.dataRowIndex.value):undefined;if(g!==undefined){var f={cell:a,event:h,handled:false};if(d=e._trigger("beforecelledit",null,f))if(!f.handled)d=b(e,f);if(d){a._isEdit(true);if(e.options.showRowHeader){$(c[0].cells[0]).empty();$(c[0].cells[0]).append($("<div>&nbsp;</div>").addClass("ui-icon ui-icon-pencil"))}}}}}return d};this.currencyEditEnd=function(e,i){var a=e.currency();if(!a._isValid()||!a._isEdit())return;var f=false,h=a._row();if(h&&h.length){var o=h[0].attributes.dataRowIndex!==undefined?parseInt(h[0].attributes.dataRowIndex.value):undefined;if(o===undefined)return f;var n=i&&i.which===$.ui.keyCode.ESCAPE;if(!i||!n){var b={cell:a,value:undefined};if(f=e._trigger("beforecellupdate",null,b)){if(b.value===undefined)b.value=d(e,a);var j=false;if(b.cell._column().dataType==="datetime"){var p=b.value?b.value.getTime():null,q=a.value()?a.value().getTime():null;j=p!==q}else j=b.value!==a.value();if(j){var g=a._column(),l=e._parse(g,b.value);if(l===null&&g.valueRequired||g.dataType&&g.dataType!=="string"&&isNaN(l)){e._trigger("invalidcellvalue",null,{cell:a,value:b.value});f=false}else{var m=a.cellIndex(),k=e.dataTable[a.rowIndex()];k[m].value=b.value;e._dataStore.updateValue(k[m].originalRowIndex,g.dataKey,b.value);e._trigger("aftercellupdate",null,{cell:a})}}}}else f=true;if(f){var b={cell:a,event:i,handled:false};e._trigger("aftercelledit",null,b);if(!b.handled)f=c(e,b);f&&a._isEdit(false);e.options.showRowHeader&&$(h[0].cells[0]).html("&nbsp;");e.element.focus();$(e._field("view").focusableElement()).focus();a.tableCell().focus()}}return f};function b(h,c){var i=c.cell._column();if(i.dataIndex>=0){var g=c.cell.value(),j=true;try{var f=c.cell.tableCell();if(i.dataType==="boolean"){var d=document.createElement("input");d.type="checkbox";d.className="wijgridinput ui-wijinput ui-state-focus";$(d).bind("keydown",h,a);f.innerHTML="";f.appendChild(d);d.focus();d.checked=g}else{var b=document.createElement("input");b.type="text";b.className="wijgridinput ui-wijinput ui-state-focus";$(b).bind("keydown",h,a);if(c.event&&c.event.type==="keypress"&&c.event.which)b.value=String.fromCharCode(c.event.which);else switch(c.cell._column().dataType){case"currency":case"number":if(g!==null){b.value=g;break}default:var l=h._toStr(c.cell._column(),g);b.value=l}f.innerHTML="";f.appendChild(b);var k=b.value.length;(new $.ui.wijgrid.domSelection(b)).setSelection({start:k,end:k});b.focus();if($.browser.mozilla&&document.createEvent&&b.dispatchEvent){var e=document.createEvent("KeyboardEvent");e.initKeyEvent("keypress",false,true,null,false,false,false,false,0,$.ui.keyCode.SPACE);b.dispatchEvent(e);e=document.createEvent("KeyboardEvent");e.initKeyEvent("keypress",false,true,null,false,false,false,false,$.ui.keyCode.BACKSPACE,0);b.dispatchEvent(e)}}}catch(m){alert(m.message);j=false}return j}return false}function c(g,b){var d=b.cell._column();if(d.dataIndex>=0){var e=true;try{var c=b.cell.tableCell();if(d.dataType==="boolean"){var a=document.createElement("input");a.type="checkbox";c.innerHTML="";c.appendChild(a);a.checked=b.cell.value();a.disabled=true}else{var f=g._toStr(d,b.cell.value());$(c).html(f)}}catch(h){alert("defaultAfterCellEdit: "+h.message);e=false}return e}return false}function a(a){if(a.which===$.ui.keyCode.ENTER){var b=a.data;if(b){b._endEditInternal(a);return false}}}function d(d,c){var a=$(c.tableCell()).find(":input:first");if(a.length){var b=a.attr("type")==="checkbox"?a[0].checked:a.val();b=d._parse(c._column(),b);return b}return null}}});$.extend($.ui.wijgrid,{fixedView:function(a){var g,b={},e,c,f,d;this.element=a.element;this.initialize=function(){g=a.dataTable.length;this._createLayout()};this._createLayout=function(){var a=this.element.find(".ui-wijgrid-flatview")[0];a!=null&&a.parentNode.removeChild(a);a=this.element.find(".ui-wijgrid-fixedview")[0];a!=null&&a.parentNode.removeChild(a);this.element.wrapInner('<div class="ui-wijgrid-fixedview"><div class="ui-wijgrid-scroller"><div class="ui-wijgrid-split-area-se ui-wijgrid-content-area"></div></div></div>');var b=this.element.find(".ui-wijgrid-scroller");b.after('<div class="ui-wijgrid-split-area ui-wijgrid-split-area-nw" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>');b.after('<div class="ui-wijgrid-split-area ui-wijgrid-split-area-ne" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>');b.after('<div class="ui-wijgrid-split-area ui-wijgrid-split-area-sw" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>')};this._onScrolled=function(){this.element.find(".ui-wijgrid-split-area-ne")[0].scrollLeft=parseInt((this.element.find(".ui-wijsuperpanel-templateouterwrapper").css("left")+"").replace("px",""))*-1};this._onScrolling=function(b,a){if(a.dir=="h")this.element.find(".ui-wijgrid-split-area-ne")[0].scrollLeft=parseInt((this.element.find(".ui-wijsuperpanel-templateouterwrapper").css("left")+"").replace("px",""))*-1;else this.element.find(".ui-wijgrid-split-area-sw")[0].scrollTop=parseInt((this.element.find(".ui-wijsuperpanel-templateouterwrapper").css("top")+"").replace("px","")*-1)};this.updateSplits=function(){var b=a.options;if(b.splits)this.element.addClass("ui-wijgrid-splits-enabled");else this.element.removeClass("ui-wijgrid-splits-enabled");var q=this.element.find(".ui-wijgrid-content-area table");if(!b.splits)try{if(b.staticRowIndex>=0)b.splitDistanceY=this.element.find(".ui-wijgrid-split-area-ne table")[0].offsetHeight;else b.splitDistanceY=0;if(a._staticColumnIndex>=0)b.splitDistanceX=this.element.find(".ui-wijgrid-split-area-nw table")[0].offsetWidth;else b.splitDistanceX=0}catch(r){}this._updateSplitAreaBounds();var e=this,n=e.element.find(".ui-wijgrid-scroller"),h=e._getMappedScrollMode(),o=$(c.element()).attr("cellpadding","0").attr("cellspacing","0").css("border-collapse","separate"),g=$(d.element()).attr("cellpadding","0").attr("cellspacing","0").css("border-collapse","separate"),k=a._field("visibleLeaves"),p=c.colTags(),l=d.colTags(),f=g.find(".ui-wijgrid-row:not(.ui-wijgrid-groupheaderrow):first"),m=f.find("td"),i=false;if(!f.is(":visible")){f.show();i=true}var j=[];$.each(k,function(a){var b=e.getHeaderCell(a);j.push(b)});$.each(j,function(b,c){var d=m[b],a=0;if(d!=undefined){a=Math.max(c.offsetWidth,d.offsetWidth);$(d).setOutWidth(a)}else a=c.offsetWidth;$(c).setOutWidth(a);p[b].width=l[b].width=a});i&&f.hide();e._ensureWidth();o.css("tableLayout","fixed");g.css("tableLayout","fixed");n.wijsuperpanel({vScroller:{scrollBarVisibility:h.vScrollBarVisibility},hScroller:{scrollBarVisibility:h.hScrollBarVisibility},allowResize:false,scrolled:jQuery.proxy(this._onScrolled,this)})};this._getMappedScrollMode=function(){var c=a.options.scrollMode,b=hScrollBarVisibility="auto";switch(c){case"horizontal":b="hidden";hScrollBarVisibility="visible";break;case"vertical":b="visible";hScrollBarVisibility="hidden";break;case"both":b="visible";hScrollBarVisibility="visible"}return{vScrollBarVisibility:b,hScrollBarVisibility:hScrollBarVisibility}};this.refreshPanel=function(){var a=this.element.find(".ui-wijgrid-scroller"),b=this._getMappedScrollMode();a.wijsuperpanel({vScroller:{scrollBarVisibility:b.vScrollBarVisibility},hScroller:{scrollBarVisibility:b.hScrollBarVisibility}});a.wijsuperpanel("paintPanel");this._ensureNEContainerWidth(a)};this._updateSplitAreaBounds=function(){var b=a.options,d=b.width||this.element.width(),c=b.height||this.element.height();if(c<=0)c=this.element.find(".ui-wijgrid-split-area-se > table")[0].offsetHeight;var e=18,f=18;this.element.height(c);this.element.width(d);this.element.find(".ui-wijgrid-scroller").height(c);this.element.find(".ui-wijgrid-scroller").width(d);this.element.find(".ui-wijgrid-split-area-nw").height(b.splitDistanceY);this.element.find(".ui-wijgrid-split-area-ne").height(b.splitDistanceY);this.element.find(".ui-wijgrid-split-area-sw").height(c-b.splitDistanceY).css("top",b.splitDistanceY);this.element.find(".ui-wijgrid-split-area-nw").width(b.splitDistanceX);this.element.find(".ui-wijgrid-split-area-sw").width(b.splitDistanceX);this.element.find(".ui-wijgrid-split-area-ne").width(d-b.splitDistanceX-(!b.splits?e:0)).css("left",b.splitDistanceX);this.element.find(".ui-wijgrid-split-area-se").css("marginLeft",b.splitDistanceX);this.element.find(".ui-wijgrid-split-area-se").css("marginTop",b.splitDistanceY)};this.render=function(){var n=a._field("visibleLeaves"),w=document.createDocumentFragment();b.nw=w.appendChild(document.createElement("table"));b.ne=w.appendChild(document.createElement("table"));b.sw=w.appendChild(document.createElement("table"));b.se=w.appendChild(document.createElement("table"));var M=a._getRealStaticRowIndex(),r=a._staticColumnIndex,p={},t=a._field("spanTable");if(t&&t.length){p.nw=b.nw.createTHead();p.ne=b.ne.createTHead();for(var S=t[0].length,o=0,Q=t.length;o<Q;o++){var i=null,g=null;i=p.nw.insertRow(-1);g=p.ne.insertRow(-1);i.className="ui-wijgrid-headerrow";g.className="ui-wijgrid-headerrow";for(var T=0,m=0;m<S;m++){var l=t[o][m];if(l.column&&(l.column.visible||l.column.visible===undefined)){l.column.thX=T++;l.column.thY=o;var e=document.createElement("th");if(m===0&&a.options.showRowHeader)e.className="ui-state-default ui-wijgrid-rowheader";if(l.colSpan>1)e.colSpan=l.colSpan;if(l.rowSpan>1)e.rowSpan=l.rowSpan;e.innerHTML=l.column.headerText?l.column.headerText:"&nbsp;";if(m<=r)i.appendChild(e);else g.appendChild(e)}}}}if(a.options.showFilter){if(p.nw){for(var z="",j=0,L=n.length;j<L&&j<=r;j++){var f=n[j];z+=f.dataIndex>=0&&!f.isBand&&f.showFilter?'<td><div class="ui-wijgrid-filter ui-widget ui-state-default ui-corner-all"><span class="ui-wijgrid-filtericon"></span><input type="text" class="ui-wijgrid-filter-input" style="width:1px" /><a class="ui-wijgrid-filter-trigger ui-corner-right ui-state-default" href="#"><span class="ui-icon ui-icon-triangle-1-s"></span></a></div></td>':"<td>&nbsp;</td>"}$(p.nw).append('<tr class="ui-wijgrid-filterrow ui-widget-content">'+z+"</tr>")}if(p.ne){for(var z="",j=r+1,L=n.length;j<L;j++){var f=n[j];z+=f.dataIndex>=0&&!f.isBand&&f.showFilter?'<td><table cellpadding="0" cellspacing="0" border="0"><tr><td class="filterOp" /><td class="filterEditor"/><td>&nbsp;</td><td class="filterBtn ui-state-default ui-corner-all"><div class="ui-icon ui-icon-triangle-1-s" >rollout</div></td></tr></table></td>':"<td>&nbsp;</td>"}$(p.ne).append('<tr class="ui-wijgrid-filterrow ui-widget-content">'+z+"</tr>")}}var u={t0:b.nw,t1:b.sw};for(var K in u){for(var x=document.createElement("colgroup"),j=0;j<=r;j++){var y=document.createElement("col"),f=n[j];if(f.width)y.width=f.width;x.appendChild(y)}var I=u[K];I.appendChild(x)}u={t0:b.ne,t1:b.se};for(var K in u){for(var x=document.createElement("colgroup"),j=r+1;j<n.length;j++){var y=document.createElement("col"),f=n[j];if(f.width)y.width=f.width;x.appendChild(y)}var I=u[K];I.appendChild(x)}var J=a.dataTable,k={};k.nw=b.nw.appendChild(document.createElement("tbody"));k.ne=b.ne.appendChild(document.createElement("tbody"));k.sw=b.sw.appendChild(document.createElement("tbody"));k.se=b.se.appendChild(document.createElement("tbody"));for(var v=0,A=M-(t.length+(a.options.showFilter?1:0)),o=0,R=J.length;o<R;o++){var c=J[o],N=c.length,i=null,g=null;if(o<=A){i=k.nw.insertRow(-1);g=k.ne.insertRow(-1)}else{i=k.sw.insertRow(-1);g=k.se.insertRow(-1)}var q="ui-wijgrid-row ui-widget-content";switch(c.rowType){case"data":q+=" ui-wijgrid-datarow";i.setAttribute("dataRowIndex",v);g.setAttribute("dataRowIndex",v);if(v%2!==0)q+=" ui-wijgrid-alternatingrow";v++;break;case"groupHeader":q+=" ui-wijgrid-groupheaderrow";break;case"groupFooter":q+=" ui-wijgrid-groupfooterrow"}if(q){i.className=q;g.className=q}if(c.display){i.style.display="none";g.style.display="none"}if(c.id){i.id=c.id;g.id=c.id}for(var m=0,P=n.length;m<P;m++){var f=n[m],O=f.dataIndex,d=0,D=false,C=false;switch(c.rowType){case"data":C=true;d=O;if(d>=0&&(!c[d]||c[d].visible===false))continue;break;case"groupHeader":case"groupFooter":d=m;if(d>=N)D=true}if(D)break;var e=document.createElement("td"),s=undefined;if(d>=0)if(C&&f.dataParser){var B=c[d].value;e.className="wijdata-type-"+(f.dataType||"string");if(f.dataType==="boolean")s=B?'<input type="checkbox" checked="checked" disabled="disabled" />':'<input type="checkbox" disabled="disabled" />';else s=a._toStr(f,B)}else s=c[d].html;if(!s)s="&nbsp;";if(m===0&&a.options.showRowHeader)e.className+=" ui-wijgrid-rowheader";e.className+=" wijgridtd";e.innerHTML=s;if(d>=0){if(c[d].rowSpan>1)e.rowSpan=c[d].rowSpan;if(c[d].colSpan>1)e.colSpan=c[d].colSpan;if(c[d].paddingLeft)e.style.paddingLeft=c[d].paddingLeft}if(m<=r)i.appendChild(e);else g.appendChild(e)}if(o<=A){!i.cells.length&&k.nw.removeChild(i);!g.cells.length&&k.ne.removeChild(g)}else{!i.cells.length&&k.sw.removeChild(i);!g.cells.length&&k.se.removeChild(g)}}var F=a.element.find(".ui-wijgrid-split-area-nw"),E=a.element.find(".ui-wijgrid-split-area-ne"),H=a.element.find(".ui-wijgrid-split-area-sw"),G=a.element.find(".ui-wijgrid-content-area");F[0].innerHTML="";E[0].innerHTML="";H[0].innerHTML="";G[0].innerHTML="";$(b.nw).appendTo(F);$(b.ne).appendTo(E);$(b.sw).appendTo(H);$(b.se).appendTo(G);h()};this.attachEvents=function(){};this.updateCss=function(){};this.subTables=function(){return[e,c,f,d]};this.focusableElement=function(){return d.element()};this.forEachRowCell=function(h,f,g){var c=this.getJoinedTables(false,h),d=c[0],e=c[1];if(d!=null){var b=c[2];if(b<d.element().rows.length){var a=d.forEachRowCell(b,f,g);if(a!=true)return a}if(e!=null&&b<e.element().rows.length){var a=e.forEachRowCell(b,f,g);if(a!=true)return a}}return true};this.forEachColumnCell=function(f,c,e){var a=this.getJoinedTables(true,f);if(a[0]!=null){var d=a[2],b=a[0].forEachColumnCell(d,c,e);if(b!=true)return b;if(a[1]!=null){b=a[1].forEachColumnCell(d,c,e);if(b!=true)return b}}return true};this.ensureWidth=function(){this._ensureWidth();var a=this.element.find(".ui-wijgrid-scroller");a.wijsuperpanel("paintPanel");this._ensureNEContainerWidth(a)};this._ensureNEContainerWidth=function(e){var c=this.element.find(".ui-wijgrid-split-area-ne"),b=a.options.width||this.element.width(),d=18;this._onScrolled();if(e.data("wijsuperpanel").vNeedScrollBar)c.width(b-d);else c.width(b)};this._ensureWidth=function(){var e=$(c.element()),b=$(d.element()),a=0;$.each(c.colTags(),function(c,b){a+=parseInt(b.width)});e.width(a);b.width(a)};this.getCell=function(d,h){var a=this.getJoinedTables(false,h);if(a[0]!=null){var c=this.getJoinedTables(true,d);if(c[0]!=null){var f=a[2],e=c[2],b=null;if(a[1]!=null)b=d==e?a[0]:a[1];else b=a[0];var g=b.getCellIdx(e,f);if(g>=0)return b.element().rows[f].cells[g]}}return null};this.getColumnIndex=function(j){for(var b=null,b=j.parentNode;b.tagName.toLowerCase()!="table";b=b.parentNode);if(b!=null){var g=null,h=false;if(b==e.element())g=e;else if(b==c.element()){g=c;h=true}else if(b==f.element())g=f;else if(b==d.element()){g=d;h=true}if(g!=null){var i=g.getColumnIdx(j);if(h)i+=a._staticColumnIndex+1;return i}}return-1};this.getAbsoluteRowIndex=function(d){var f=d.rowIndex,b=d.parentNode;while(b.tagName.toLowerCase()!="table")b=b.parentNode;return b==e.element()||b==c.element()?f:f+a._getRealStaticRowIndex()+1};this.getJoinedCols=function(b){var c=[],a=this.getJoinedTables(true,b);a.splice(a.length-1,1);$.each(a,function(d,a){c.push($(a.element()).find("col")[b])});return c};this.getJoinedRows=function(j,k){var l=null,m=null,b=null,i=null,r=a._getRealStaticRowIndex(),h=a._staticColumnIndex,s=a._field("leaves").length-1,t=g-1,q=r==t,n=r<0,p=!q&&!n,o=0;if(q||p){if(h>=0&&h<s){b=e;i=c}else b=h<0?c:e;o=b.getSectionLength(k);if(j<o){l=b.getSectionRow(j,k);if(i!=null)m=i.getSectionRow(j,k)}}if(n||p&&l==null){if(!n)j-=o;if(h>=0&&h<s){b=f;i=d}else b=h<0?d:f;l=b.getSectionRow(j,k);if(i!=null)m=i.getSectionRow(j,k)}return l==null&&m==null?null:[l,m]};this.getJoinedTables=function(m,l){var b=null,h=null,i=l,k=a._getRealStaticRowIndex(),j=a._staticColumnIndex;if(m){if(l<=j){b=e;h=f}else{b=c;h=d;i=i-(j+1)}if(k<0)b=null;if(k==g-1)h=null}else{if(l<=k){b=e;h=c}else{b=f;h=d;i=i-(k+1)}if(j<0)b=null;if(j==a._field("leaves").length-1)h=null}if(b==null){b=h;h=null}return[b,h,i]};this.getHeaderCell=function(d){var c=a._field("visibleLeaves")[d],b=a._headerRows();return b?(new $.ui.wijgrid.rowAccessor).getCell(b.item(c.thY),c.thX):null};this.getAbsCellInfo=function(a){return new $.ui.wijgrid.cellInfo(this.getColumnIndex(a),this.getAbsoluteRowIndex(a.parentNode))};this.getVisibleAreaBounds=function(){return $.ui.wijgrid.bounds(a.element.find(".ui-wijsuperpanel-contentwrapper:first"))};this.adjustCellsSizes=function(){for(var g=new $.ui.wijgrid.rowAccessor(this,9,0),i=g.length(),h=[],a=0;a<i;a++){for(var j=this.getJoinedRows(a,9),c=j[0],m=c!=null?c.cells.length:0,e=false,b=0;b<m&&!e;b++)e=c.cells[b].rowSpan>1;var d=j[1],n=d!=null?d.cells.length:0,f=false;if(!e)for(var b=0;b<n&&!f;b++)f=d.cells[b].rowSpan>1;var k=c!=null&&m>0?c.offsetHeight:0,l=d!=null&&n>0?d.offsetHeight:0;h[a]=e||f?Math.min(k,l):Math.max(k,l)}for(var a=0;a<i;a++){var o=this.getJoinedRows(a,9);g.iterateCells(o,this.setCellContentDivHeight,h[a])}};this.setCellContentDivHeight=function(b,a){b.style.height=a+"px";return true};function h(){e=new $.ui.wijgrid.htmlTableAccessor(b.nw);c=new $.ui.wijgrid.htmlTableAccessor(b.ne);f=new $.ui.wijgrid.htmlTableAccessor(b.sw);d=new $.ui.wijgrid.htmlTableAccessor(b.se)}}});$.extend($.ui.wijgrid,{resizer:function(f){var h=[],s=10,r=1,u="{0}."+f.widgetName+".resizer",d=false,a=null,q,g=null,c=null,e=null;this.addElement=function(a){a.element.bind(b("mousemove"),p).bind(b("mousedown"),o).bind(b("mouseout"),i);h.push(a)};this.dispose=function(){$.each(h,function(c,a){a.element.unbind(b("mousemove"),p).unbind(b("mousedown"),o).unbind(b("mouseout"),i)});l()};function p(c){if(!d){var b=n({x:c.pageX,y:c.pageY});if(b&&b._canSize()&&f._canInteract()){b.element.css("cursor","e-resize");a=b}else i(c)}}function i(){if(!d)if(a){a.element.css("cursor","");a=null}}function o(b){a=n({x:b.pageX,y:b.pageY});if(a&&a._canSize()&&f._canInteract())try{a.element.css("cursor","");q=document.body.style.cursor;document.body.style.cursor="e-resize";g=c=$.ui.wijgrid.bounds(a.element);e=$('<div class="ui-wijgrid-resizehandle ui-state-highlight">&nbsp;</div>');e.css({left:b.pageX,top:g.top,height:f._field("view").getVisibleAreaBounds().height-a.element[0].offsetTop});$(document.body).append(e)}finally{t();d=true}}function j(a){var b=r*Math.round((a.pageX-c.left)/r);c={left:c.left+b,top:a.pageY};e.css("left",c.left)}function k(){try{document.body.style.cursor=q;e.remove();g!==c&&f._fieldResized(a,c.left-g.left)}finally{a=null;e=null;l();d=false}}function m(a){a.preventDefault()}function t(){if(!d){$(document).bind(b("mousemove"),j).bind(b("mouseup"),k);$(document.body).disableSelection();$.browser.msie&&$(document.body).bind("selectstart",m)}}function l(){if(d){$(document).unbind(b("mousemove"),j).unbind(b("mouseup"),k);$(document.body).enableSelection();$.browser.msie&&$(document.body).unbind("selectstart",m)}}function n(d){for(var b=0,e=h.length;b<e;b++){var c=h[b],a=$.ui.wijgrid.bounds(c.element),f=$.ui.isOver(d.y,d.x,a.top,a.left+a.width-s,a.height,s);if(f)return c}return null}function b(a){return $.ui.wijgrid.stringFormat(u,a)}}});