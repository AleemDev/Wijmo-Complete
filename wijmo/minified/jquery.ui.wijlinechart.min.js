/*
 *
 * Wijmo Library 0.8.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
Raphael.fn.tri=function(b,c,e){var g=b,j=c-e,a=Math.cos(30*Math.PI/180)*e,d=Math.tan(60*Math.PI/180)*a,h=b+a,k=c+d,i=b-a,l=c+d,f=["M",g,j,"L",h,k,"L",i,l,"z"];return this.path(f.concat(" "))};Raphael.fn.invertedTri=function(b,c,e){var g=b,j=c+e,a=Math.cos(30*Math.PI/180)*e,d=Math.tan(60*Math.PI/180)*a,h=b+a,k=c-d,i=b-a,l=c-d,f=["M",g,j,"L",h,k,"L",i,l,"z"];return this.path(f.concat(" "))};Raphael.fn.box=function(b,c,e){var a=Math.cos(45*Math.PI/180)*e,d=["M",b-a,c-a,"L",b+a,c-a,"L",b+a,c+a,"L",b-a,c+a,"z"];return this.path(d.concat(" "))};Raphael.fn.diamond=function(b,c,a){var d=["M",b,c-a,"L",b+a,c,"L",b,c+a,"L",b-a,c,"z"];return this.path(d.concat(" "))};Raphael.fn.cross=function(b,c,e){var a=Math.cos(45*Math.PI/180)*e,d=["M",b-a,c-a,"L",b+a,c+a,"M",b-a,c+a,"L",b+a,c-a];return this.path(d.concat(" "))};(function(a){a.widget("ui.wijlinechart",a.ui.wijchartcore,{options:{animation:{enabled:true,duration:2e3},zoomOnHover:true},_create:function(){a.ui.wijchartcore.prototype._create.apply(this,arguments);this.chartElement.addClass("ui-wijlinechart");this.paths=[];this.shadowPaths=[];this.markersSet=[];this.animationSet=this.canvas.set();this.symbols=[];this.hoverPoint=null;this.hoverLine=null;this.linesStyle=[];this.shadow=true},destroy:function(){this.chartElement.removeClass("ui-wijlinechart");a.ui.wijchartcore.prototype.destroy.apply(this,arguments)},getLinePath:function(a){return this.paths[a]},getLineMarkers:function(a){var b=this.options;if(b.seriesList&&b.seriesList[a].markers&&b.seriesList[a].markers.visible)return this.markersSet[a];else{var c;return c}},_getAnchors:function(f,g,a,b,h,i){var j=(a-f)/2,k=(h-a)/2,c=Math.atan((a-f)/Math.abs(b-g)),d=Math.atan((h-a)/Math.abs(b-i));c=g<b?Math.PI-c:c;d=i<b?Math.PI-d:d;var e=Math.PI/2-(c+d)%(Math.PI*2)/2,l=j*Math.sin(e+c),n=j*Math.cos(e+c),m=k*Math.sin(e+d),o=k*Math.cos(e+d);return{x1:a-l,y1:b+n,x2:a+m,y2:b+o}},_paintLegend:function(){var g=this.options;a.extend(true,g,{legend:{size:{width:30,height:3}}});a.ui.wijchartcore.prototype._paintLegend.apply(this,arguments);if(g.legend.visible){if(this.legends.length&&this.legendIcons.length)for(var b=0,n=this.legendIcons.length;b<n;b++){var j=this.legendIcons[b];j.attr({fill:j.attr("stroke")})}var i=g.seriesList,l=g.seriesStyles,m=0;if(!g.legend.reversed)for(var b=0,n=i.length;b<n;b++){var c=i[b],h=l[b];if(c.legendEntry){if(c.markers&&c.markers.visible){var j=this.legendIcons[b],d=j.wijGetBBox(),o=d.x+d.width/2,p=d.y+d.height/2,e=c.markerStyle;e=a.extend({fill:h.stroke,stroke:h.stroke,opacity:1},e);var f=c.markers.type;if(!f)f="circle";var k=this._paintMarker(f,o,p,3);k.attr(e);this.legendEles.push(k)}m++}}else for(var b=i.length-1;b>=0;b--){var c=i[b],h=l[b];if(c.legendEntry&&c.markers.visible){if(c.markers.visible){var j=this.legendIcons[b],d=j.wijGetBBox(),o=d.x+d.width/2,p=d.y+d.height/2,e=c.markerStyle;e=a.extend({fill:h.stroke,stroke:h.stroke,opacity:1},e);var f=c.markers.type;if(!f)f="circle";var k=this._paintMarker(f,o,p,3);k.attr(e)}m++}}}},_clearChartElement:function(){this.linesStyle=[];if(this.paths.length){for(var b=0,c=this.paths.length;b<c;b++)this.paths[b].remove();this.paths=[]}if(this.shadowPaths.length){for(var b=0,c=this.shadowPaths.length;b<c;b++)this.shadowPaths[b].remove();this.shadowPaths=[]}if(this.markersSet.length){for(var b=0,c=this.markersSet.length;b<c;b++)for(var e=this.markersSet[b],d=0,f=e.length;d<f;d++)e[d].remove();this.markersSet=[]}if(this.animationSet.length){for(var b=0,c=this.animationSet.length;b<c;b++)this.animationSet[b].remove();this.animationSet=this.canvas.set()}if(this.symbols.length){for(var b=0,c=this.symbols.length;b<c;b++)this.symbols[b].remove();this.symbols=[]}a.ui.wijchartcore.prototype._clearChartElement.apply(this,arguments)},_paintMarker:function(e,c,d,b){var a=null;switch(e){case"circle":a=this.canvas.circle(c,d,b);break;case"tri":a=this.canvas.tri(c,d,b);break;case"invertedTri":a=this.canvas.invertedTri(c,d,b);break;case"box":a=this.canvas.box(c,d,b);break;case"diamond":a=this.canvas.diamond(c,d,b);break;case"cross":a=this.canvas.cross(c,d,b)}return a},_paintPlotArea:function(){var y=this,j=y.options,e=y.canvasBounds,H=e.endX-e.startX,x=e.endY-e.startY,N=j.seriesList,W=j.seriesStyles;this.plotInfos=[];for(var k=0,cb=N.length;k<cb;k++){var b=N[k],X=W[k];b=a.extend(true,{fitType:"line",markers:{visible:false,type:"circle"},visible:true},b);var Q=b.data,s=a.extend({stroke:"black",opacity:1,fill:"none","stroke-width":2,"stroke-linejoin":"round","stroke-linecap":"round"},X),r=b.markerStyle;r=a.extend({fill:s.stroke,stroke:s.stroke,opacity:1,width:3},r);var C=Q.x,w=Q.y,m=j.axis.x.min,t=j.axis.y.min,U=j.axis.x.max,V=j.axis.y.max,q=H/(U-m),J=x/(V-t),ab={minX:m,minY:t,maxX:U,maxY:V,width:H,height:x};this.plotInfos.push(ab);var n=this.canvas.set(),f=[],B=b.fitType,O=false;if(b.markers.symbol&&b.markers.symbol.length)O=true;for(var R=this.axisInfo.x.isTime,S=this.axisInfo.y.isTime,u=this.canvas.set(),c=0,I=w.length;c<I;c++){var p=C[c];if(R)p=this._toOADate(p);var z=w[c];if(S)z=this._toOADate(z);if(p==undefined)break;var d=0;if(isNaN(p))d=e.startX+(c-m)*q;else d=e.startX+(p-m)*q;var g=e.endY-(z-t)*J;if(B=="line")f=f.concat([c?"L":"M",d,g]);else if(B=="spline")if(!c)f=["M",d,g,"C",d,g];else if(c&&c<I-1){var F=w[c-1],G=w[c+1];if(S){F=this._toOADate(F);G=this._toOADate(G)}var eb=e.endY-(F-t)*J,K=0,fb=e.endY-(G-t)*J,L=0;if(isNaN(p)){K=e.startX+(c-1-m)*q;L=e.startX+(c+1-m)*q}else{var D=C[c-1],E=C[c+1];if(R){D=this._toOADate(D);E=this._toOADate(E)}K=e.startX+(D-m)*q;L=e.startX+(E-m)*q}var A=this._getAnchors(K,eb,d,g,L,fb);f=f.concat([A.x1,A.y1,d,g,A.x2,A.y2])}else f=f.concat([d,g,d,g]);else if(B=="bezier")if(!c)f=f.concat(["M",d,g]);else if(c==I-1&&c%2==1)f=f.concat(["Q",d,g,d,g]);else if(c%2==0)f=f.concat([d,g]);else f=f.concat(["Q",d,g]);if(j.showDefaultChartLabels){var v=this.canvas.text(d,g,z);this.chartLabelEles.push(v);var bb=v.wijGetBBox();v.translate(0,-bb.height);u.push(v)}var i=null,P=false;if(O)for(var T=b.markers.symbol,M=0,db=T.length;M<db;M++){var o=T[M];if(o.index==c){i=this.canvas.image(o.url,d-o.width/2,g-o.height/2,o.width,o.height);this.symbols.push(i);P=true;break}}if(i==null){var Z=b.markers.type,Y=r.width;i=this._paintMarker(Z,d,g,Y);b.markers.visible&&i.attr(r)}this._addClass(a(i.node),"wijchart-canvas-object wijchart-canvas-marker");var l={};l.marker=i;l.index=c;l.type="marker";l.lineSeries=b;l.x=d;l.y=g;l.isSymbol=P;a(i.node).data("wijchartDataObj",l);n.push(i);this.animationSet.push(i)}var h=this.canvas.path(f.join(" "));this._paintShadow(h);h.wijAttr(s);this.paths[k]=h;if(h.shadow)this.shadowPaths[k]=h.shadow;this.animationSet.push(h);this.linesStyle[k]={lineStyle:s,markerStyle:r};!b.markers.visible&&n.hide();if(!b.visible){h.hide();h.shadow&&h.shadow.hide()}b.markers.style&&n.attr(b.markers.style);n.toFront();if(u.length){u.attr(j.chartLabelStyle);u.toFront()}this.markersSet[k]=n;b.index=k;b.type="line";b.path=h;b.lineMarkers=n;b.lineStyle=s;this._addClass(a(h.node),"wijchart-canvas-object");a(h.node).data("wijchartDataObj",b)}if(j.animation.enabled){this.animationSet.wijAttr("clip-rect",e.startX+" "+e.startY+" 0 "+x);this.animationSet.wijAnimate({"clip-rect":e.startX+" "+e.startY+" "+H+" "+x},j.animation.duration,function(){if(Raphael.vml)for(var c=0,g=y.animationSet.length;c<g;c++){var b=y.animationSet[c];if(b.node.clipRect){var e=b.attrs;delete e["clip-rect"];b.node.clipRect=null;var f=a(b.node).parent(),d=f.parent();d.before(f);d.remove();b.attr(e)}}})}},_getChartLabelPointPosition:function(l){var m=this.options,n=l.attachMethod,e=l.attachMethodData,f={x:0,y:0};switch(n){case"coordinate":f.x=e.x;f.y=e.y;break;case"dataCoordinate":var d=e.seriesIndex;if(d>-1){var g=this.plotInfos;if(g.length>d){var b=e.x,c=e.y;if(this._isDate(b))b=this._toOADate(b);if(this._isDate(c))c=this._toOADate(c);var a=g[d],j=a.width/(a.maxX-a.minX);f.x=this.canvasBounds.startX+(b-a.minX)*j;var k=a.height/(a.maxY-a.minY);f.y=this.canvasBounds.startY+a.height-(c-a.minY)*k}}break;case"dataIndex":var d=e.seriesIndex,h=e.pointIndex,i=m.seriesList[d].data,b=i.x[h],c=i.y[h];if(this._isDate(b))b=this._toOADate(b);if(this._isDate(c))c=this._toOADate(c);if(d>-1){var g=this.plotInfos;if(g.length>d){var a=g[d],j=a.width/(a.maxX-a.minX);f.x=this.canvasBounds.startX+(b-a.minX)*j;var k=a.height/(a.maxY-a.minY);f.y=this.canvasBounds.startY+a.height-(c-a.minY)*k}}break;case"dataIndexY":var d=e.seriesIndex,h=e.pointIndex,i=m.seriesList[d].data,b=i.x[h],c=e.y;if(this._isDate(b))b=this._toOADate(b);if(this._isDate(c))c=this._toOADate(c);if(d>-1){var g=this.plotInfos;if(g.length>d){var a=g[d],j=a.width/(a.maxX-a.minX);f.x=this.canvasBounds.startX+(b-a.minX)*j;var k=a.height/(a.maxY-a.minY);f.y=this.canvasBounds.startY+a.height-(c-a.minY)*k}}}return f},_bindLiveEvents:function(){var b=this,e=false,d={element:this.chartElement,mousedown:function(c){var f=a(c.target),d=a(c.target).data("wijchartDataObj");if(f.hasClass("wijchart-canvas-marker")){var e=d.lineSeries;if(!e.markers.visible)b._trigger("mousedown",c,e);else b._trigger("mousedown",c,d)}else b._trigger("mousedown",c,d)},mouseup:function(c){var f=a(c.target),d=a(c.target).data("wijchartDataObj");if(f.hasClass("wijchart-canvas-marker")){var e=d.lineSeries;if(!e.markers.visible)b._trigger("mouseup",c,e);else b._trigger("mouseup",c,d)}else b._trigger("mouseup",c,d)},mouseover:function(g){var j=a(g.target),c=a(g.target).data("wijchartDataObj"),i=b.options.zoomOnHover;if(j.hasClass("wijchart-canvas-marker")){var d=c.lineSeries;if(!d.markers.visible)b._trigger("mouseover",g,d);else b._trigger("mouseover",g,c);if(!(b.hoverLine==d)){e=true;if(i){if(b.hoverLine!=null){var h=b.hoverLine.index,f=b.linesStyle[h];b.hoverLine.path.wijAttr({"stroke-width":parseInt(f.lineStyle["stroke-width"])});if(b.hoverPoint!=null&&!b.hoverPoint.isSymbol){b.hoverPoint.marker.wijAttr({stroke:f.markerStyle.stroke});b.hoverPoint.marker.scale(1,1)}}var h=d.index,f=b.linesStyle[h].lineStyle;d.path.wijAttr({"stroke-width":parseInt(f["stroke-width"])+1})}b.hoverLine=d;b.hoverPoint=null}}else{b._trigger("mouseover",g,c);if(c.type=="line")if(!(b.hoverLine==c)){e=true;if(i){if(b.hoverLine!=null){var h=b.hoverLine.index,f=b.linesStyle[h];b.hoverLine.path.wijAttr({"stroke-width":parseInt(f.lineStyle["stroke-width"])});if(b.hoverPoint!=null&&!b.hoverPoint.isSymbol){b.hoverPoint.marker.wijAttr({stroke:f.markerStyle.stroke});b.hoverPoint.marker.scale(1,1)}}var h=c.index,f=b.linesStyle[h].lineStyle;c.path.wijAttr({"stroke-width":parseInt(f["stroke-width"])+1})}b.hoverLine=c;b.hoverPoint=null}}},mouseout:function(c){var f=a(c.target),d=a(c.target).data("wijchartDataObj");if(f.hasClass("wijchart-canvas-marker")){var e=d.lineSeries;if(!e.markers.visible)b._trigger("mouseout",c,e);else b._trigger("mouseout",c,d)}else b._trigger("mouseout",c,d)},mousemove:function(c){var f=a(c.target),d=a(c.target).data("wijchartDataObj");if(f.hasClass("wijchart-canvas-marker")){var e=d.lineSeries;if(!e.markers.visible)b._trigger("mousemove",c,e);else b._trigger("mousemove",c,d)}else b._trigger("mousemove",c,d)},click:function(c){var f=a(c.target),d=a(c.target).data("wijchartDataObj");if(f.hasClass("wijchart-canvas-marker")){var e=d.lineSeries;if(!e.markers.visible)b._trigger("click",c,e);else b._trigger("click",c,d)}else b._trigger("click",c,d)}},i=this.options,c=i.hint;a(".wijchart-canvas-object",this.chartElement[0]).live("mousedown.wijliechart",a.proxy(d.mousedown,d)).live("mouseup.wijliechart",a.proxy(d.mouseup,d)).live("mouseover.wijliechart",a.proxy(d.mouseover,d)).live("mouseout.wijliechart",a.proxy(d.mouseout,d)).live("mousemove.wijliechart",a.proxy(d.mousemove,d)).live("click.wijliechart",a.proxy(d.click,d));if(c.enable)if(!this.tooltipEle)this.tooltipEle=this.canvas.wij.tooltip(this);var f=b.canvasBounds,h=b.chartElement.offset(),g=i.zoomOnHover;this.chartElement.bind("mousemove",function(z){var n={left:z.pageX-h.left,top:z.pageY-h.top};if(n.left>=f.startX&&n.left<=f.endX&&n.top>=f.startY&&n.top<=f.endY){if(b.hoverLine!=null){if(e){c.enable&&b.tooltipEle.hide(0);e=false}for(var s=b.hoverLine.lineMarkers,i=-1,r=0,j={x:0,y:0},l=0,D=s.length;l<D;l++){var A=s[l],k=A.wijGetBBox(),w=k.x+k.width/2,v=Math.abs(w-n.left);if(l==0){r=v;i=l;j={x:w,y:k.y+k.height/2}}else if(v<r){r=v;i=l;j={x:w,y:k.y+k.height/2}}}if(b.hoverPoint!=null&&b.hoverPoint.index==i)return;if(i>-1){var j=a(s[i].node).data("wijchartDataObj");if(g){if(b.hoverPoint!=null&&!b.hoverPoint.isSymbol){var B=b.hoverLine.index,u=b.linesStyle[B];b.hoverPoint.marker.wijAttr({stroke:u.markerStyle.stroke});b.hoverPoint.marker.scale(1,1)}if(!j.isSymbol){j.marker.wijAttr({stroke:"white"});j.marker.scale(1.5,1.5)}}b.hoverPoint=j}if(c.enable){var p,q,m=b.hoverLine.data;if(m.x){p=m.x[i];q=m.y[i]}else{p=m.xy[2*i];q=m.xy[2*i+1]}var x=b.hoverPoint,d={data:x,content:"",cancel:false,offset:c.offset,compass:c.compass,showDelay:c.showDelay,hideDelay:c.hideDelay,textStyle:c.textStyle,duration:c.duration,easing:c.easing,style:c.style,x:p,y:q,index:i};b._trigger("hintshowing",null,d);if(!d.cancel){var o=d.content,t=c.formatter;if(!o)if(a.isFunction(t)){var y={x:p,y:q,data:x,fmt:t},C=a.proxy(y.fmt,y);o=C()}else o=t;b.tooltipEle.showDelay=d.showDelay;b.tooltipEle.hideDelay=d.hideDelay;b.tooltipEle.duration=d.duration;b.tooltipEle.easing=d.easing;b.tooltipEle.textAttr=d.textStyle;b.tooltipEle.rectAttr=a.extend({stroke:b.hoverLine.path.attr("stroke")},d.style);b.tooltipEle.text=o;b.tooltipEle.offset=d.offset;b.tooltipEle.compass=d.compass;b.tooltipEle.showAt(j);b._trigger("hintshown",null,d)}}}}else{c.enable&&b.tooltipEle.hide();if(g)if(b.hoverLine!=null){var i=b.hoverLine.index,u=b.linesStyle[i];b.hoverLine.path.wijAttr({"stroke-width":parseInt(u.lineStyle["stroke-width"])});if(b.hoverPoint!=null&&!b.hoverPoint.isSymbol){b.hoverPoint.marker.wijAttr({stroke:u.markerStyle.stroke});b.hoverPoint.marker.scale(1,1)}}b.hoverLine=null;b.hoverPoint=null}})},_unbindLiveEvents:function(){a(".wijchart-canvas-object",this.chartElement[0]).die("wijlinechart")}})})(jQuery);