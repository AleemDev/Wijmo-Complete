/*
 *
 * Wijmo Library 0.8.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){a.widget("ui.wijpiechart",a.ui.wijchartcore,{options:{radius:null,innerRadius:0},_create:function(){var b=["0-#8ac4c0-#77b3af","0-#73a19e-#67908e","0-#4f687b-#465d6e","0-#69475b-#5d3f51","0-#7a3b3f-#682e32","0-#9d5b5b-#8c5151","0-#e5a36d-#ce9262","0-#e6cc70-#ceb664","0-#8ec858-#7fb34f","0-#3a9073-#2a7b5f","0-#6c88e3-#6079cb","0-#6cb4e3-#60a0cb"];a.ui.wijchartcore.prototype._create.apply(this,arguments);this.chartElement.addClass("ui-wijpiechart");a.each(this.options.seriesStyles,function(c,a){if(a.fill==null)a.fill=b[c]})},destroy:function(){this.chartElement.removeClass("ui-wijpiechart ui-helper-reset");a.ui.wijchartcore.prototype.destroy.apply(this,arguments)},getSector:function(a){return this.sectors[a]},_paintPlotArea:function(){var b=this.options,i=this.canvasBounds.endX-this.canvasBounds.startX,h=this.canvasBounds.endY-this.canvasBounds.startY;if(!b.radius)b.radius=Math.min(i,h)/2;else{if(i<2*b.radius)b.radius=i/2;if(h<2*b.radius)b.radius=h/2}this.canvasBounds.startX+=i/2-b.radius;this.canvasBounds.endX=this.canvasBounds.startX+2*b.radius;this.canvasBounds.startY+=h/2-b.radius;this.canvasBounds.endY=this.canvasBounds.startY+2*b.radius;for(var f=b.seriesList,m=b.seriesStyles,j=0,g=0;g<f.length;g++)if(f[g]!=null&&typeof f[g].data=="number")j+=f[g].data;var k=[],c=0,d=this.canvas,e=b.radius,n=this.canvasBounds.startX,o=this.canvasBounds.startY;this.total=j;var l=this;a.each(f,function(t,g){var q=a.extend({opacity:1,stroke:"gray","stroke-width":1},m[t]),p=360*g.data/j,h=n+e,i=o+e;if(g.offset){var r=d.wij.getPositionByAngle(h,i,g.offset,c+p/2);h=r.x;i=r.y}var f=null;if(b.innerRadius){f=d.wij.donut(h,i,e,b.innerRadius,c,c+p);f.innerRadius=b.innerRadius}else f=d.wij.sector(h,i,e,c,c+p);l._paintShadow(f);f.wijAttr(q);f.angles={start:c,end:c+p};f.getOffset=function(b){var a=d.wij.getPositionByAngle(h,i,b,(f.angles.start+f.angles.end)/2);return{x:a.x-h,y:a.y-i}};f.center={x:h,y:i};f.radius=e;l._addClass(a(f.node),"wijchart-canvas-object");a(f.node).data("wijchartDataObj",g);if(b.showDefaultChartLabels){var s=d.wij.getPositionByAngle(h,i,g.offset+e*2/3,c+p/2),u=a.extend(true,{},b.textStyle,b.chartLabelStyle);d.text(s.x,s.y,g.label).attr(u)}k.push(f);g.style=q;g.index=t;g.type="pie";c+=p});this.sectors=k},_paintChartLabels:function(){var f=this.options,b=f.chartLabels;if(b&&b.length)for(var d=0,n=f.radius,m=0,u=b.length;m<u;m++){var k=this.canvasBounds.startX+n,l=this.canvasBounds.startY+n,c=a.extend(true,{compass:"east",attachMethod:"coordinate",attachMethodData:{seriesIndex:-1,x:-1,y:-1},offset:0,visible:false,text:"",connected:false},b[m]);if(c.visible){var r=c.attachMethod,t=c.attachMethodData,e={x:0,y:0},i=0,q=null;if(r=="dataIndex"){var g=t.seriesIndex;if(g>-1){var j=f.seriesList[g],s=j.data,h=360*s/this.total,o=f.seriesStyles[g];q={stroke:o.stroke||o.fill};i=d+h/2;if(j.offset){var p=this.canvas.wij.getPositionByAngle(k,l,j.offset,d+h/2);k=p.x;l=p.y}e=this.canvas.wij.getPositionByAngle(k,l,n,i);d=d+h}}if(isNaN(e.x)||isNaN(e.y))break;this._setChartLabel(c,e,i,q)}}},_bindLiveEvents:function(){var d={mousedown:function(b){this._trigger("mousedown",b,a(b.target).data("wijchartDataObj"))},mouseup:function(b){this._trigger("mouseup",b,a(b.target).data("wijchartDataObj"))},mouseover:function(b){this._trigger("mouseover",b,a(b.target).data("wijchartDataObj"))},mouseout:function(b){this._trigger("mouseout",b,a(b.target).data("wijchartDataObj"))},mousemove:function(b){this._trigger("mousemove",b,a(b.target).data("wijchartDataObj"))},click:function(b){this._trigger("click",b,a(b.target).data("wijchartDataObj"))}},c=this.options;a(".wijchart-canvas-object",this.chartElement[0]).live("mousedown.wijpiechart",a.proxy(d.mousedown,this)).live("mouseup.wijpiechart",a.proxy(d.mouseup,this)).live("mouseover.wijpiechart",a.proxy(d.mouseover,this)).live("mouseout.wijpiechart",a.proxy(d.mouseout,this)).live("mousemove.wijpiechart",a.proxy(d.mousemove,this)).live("click.wijpiechart",a.proxy(d.click,this));if(c.hint.enable){if(!this.tooltipEle)this.tooltipEle=this.canvas.wij.tooltip(this);var b=this;a(".wijchart-canvas-object",this.chartElement[0]).live("mousemove.wijpiechart",function(l){var d=a(this).data("wijchartDataObj"),m=d.index,g=b.chartElement.offset(),j=d.data,h={x:l.pageX,y:l.pageY};data={data:d,content:"",cancel:false,offset:c.hint.offset||3,compass:c.hint.compass,showDelay:c.hint.showDelay,hideDelay:c.hint.hideDelay,textStyle:c.hint.textStyle,duration:c.hint.duration,easing:c.hint.easing,style:c.hint.style,value:j,index:m};var n={x:h.x-g.left+data.offset,y:h.y-g.top-data.offset};b.element.trigger("hintShowing",data);if(!data.cancel){var e=data.content,f=c.hint.formatter;if(!e)if(a.isFunction(f)){var k={value:j,total:b.total,data:d,fmt:f},o=a.proxy(k.fmt,k);e=o()}else e=f;var i=d.style;b.tooltipEle.showDelay=data.showDelay;b.tooltipEle.hideDelay=data.hideDelay;b.tooltipEle.duration=data.duration;b.tooltipEle.easing=data.easing;b.tooltipEle.textAttr=a.extend(true,{},c.textStyle,data.textStyle);b.tooltipEle.rectAttr=a.extend({stroke:i.stroke||i.fill,"stroke-opacity":"0.9"},data.style);b.tooltipEle.text=e;b.tooltipEle.offset=data.offset;b.tooltipEle.compass=data.compass;b.tooltipEle.showAt(n,200);b._trigger("hintshown",null,data)}});a(".wijchart-canvas-object",this.chartElement[0]).live("mouseout.wijpiechart",function(){b.tooltipEle.hide()})}},_unbindLiveEvents:function(){a(".wijchart-canvas-object",this.chartElement[0]).die("wijpiechart")}})})(jQuery);