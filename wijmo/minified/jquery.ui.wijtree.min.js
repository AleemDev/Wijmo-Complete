/*
 *
 * Wijmo Library 0.8.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){a.widget("ui.wijtree",{options:{accessKey:"",allowDrag:false,allowDrop:false,allowEdit:false,allowSorting:true,allowTriState:true,autoCheckNodes:true,autoCollapse:false,disabled:false,expandCollapseHoverUsed:false,showCheckBoxes:false,showExpandCollapse:true,expandAnimation:{effect:"blind",easing:"easeOutExpo",duration:200},expandDelay:0,collapseAnimation:{effect:"blind",easing:"easeOutExpo",duration:200},collapseDelay:0},_create:function(){this._initState();this._createTree();this._attachEvent();this._attachNodeEvent()},_init:function(){},_setOption:function(e,c){var b=this,d=false;switch(e){case"allowDrag":b._setAllowDrag(c);break;case"allowDrop":b._setAllowDrop(c);break;case"showCheckBoxes":b._setCheckBoxes(c);break;case"showExpandCollapse":if(b.options.showExpandCollapse!=c)d=true}a.Widget.prototype._setOption.apply(b,arguments);d==true&&b._setHitArea(c)},_initState:function(){this._selectedNodes=[];this._checkedNodes=[];this._enabled=true;this._insertPosition="unKnown"},_createTree:function(){var b=this,d=b.options,c=[];if(b.element.is("ul")){b.element.wrap("<div></div>");b.widgetDom=b.element.parent();b.widgetDom.addClass("ui-wijtree ui-widget ui-widget-content ui-helper-clearfix ui-corner-all");b.element.addClass("ui-wijtree-list ui-helper-reset");b.element.children("li").each(function(){var f=a(this);b._createNodeWidget(f,d);var e=b._getNodeWidget(a(this));c.push(e)});b._hasChildren=c.length>0;b._setField("nodes",c);b.nodes=c;b.widgetDom.append(a("<div>").css("clear","both"))}},_createNodeWidget:function(b,c){if(a.fn.wijtreenode){b.data("owner",this);b.wijtreenode(c)}return b},_attachEvent:function(){var b=this;b.element.bind(a.browser.msie?"focusin.":"focus."+b.widgetName,a.proxy(b._onFocus,b)).bind("mouseover."+this.widgetName,a.proxy(b._onMouseOver,b));b.options.allowDrop&&b._attachDroppable()},_attachDroppable:function(){var b=this;b.widgetDom.droppable({drop:function(n,l){var c=l.draggable,e=b._getNodeWidget(c);if(e){var f=e._dropTarget;if(f){var d=e._insertPosition;if(f&&d!="unKnown"){var g=c.data("owner");g&&g.remove(c);if(!g.element.is(":ui-wijtree")&&g._getField("nodes").length>0)b.options.showCheckBoxes&&b.options.allowTriState&&g._getField("nodes")[0]._setParentCheckState();if(d==="end"){c.show();f.add(c)}else if(d=="before"||d=="after"){var h=f._getField("owner"),m=h._getField("nodes"),i=a.inArray(f,m);if(i!=-1){c.show();if(d==="before")h.add(c,i);else d==="after"&&h.add(c,i+1)}}e._tree=b;for(var k=e._getField("nodes"),j=0;j<k.length;j++)k[j]._tree=b;b._trigger("nodeDroped",n,l)}}else c.draggable("option","revert",true)}},accept:"li",scope:"tree"})},_attachNodeEvent:function(){this.element.bind("click."+this.widgetName,a.proxy(this._onClick,this)).bind("mouseout."+this.widgetName,a.proxy(this._onMouseOut,this)).bind("keydown."+this.widgetName,a.proxy(this._onKeyDown,this))},_onClick:function(a){this._callEvent(a,"_onClick")},_onFocus:function(a){this._callEvent(a,"_onFocus")},_onKeyDown:function(a){this._callEvent(a,"_onKeyDown")},_onMouseOut:function(a){this._callEvent(a,"_onMouseOut")},_onMouseOver:function(a){this._callEvent(a,"_onMouseOver")},_callEvent:function(a,d){var c=a.target;if(c){var b=this._getNodeWidgetByDom(c);if(b==null)return;b[d](a)}},getSelectedNodes:function(){return this._selectedNodes},getCheckedNodes:function(){return this._checkedNodes},destroy:function(){var b=this;b.widgetDom.removeClass("ui-wijtree ui-widget ui-widget-content ui-helper-clearfix ui-corner-all");var c=b.element;b.widgetDom.data("droppable")&&b.widgetDom.droppable("destroy");c.removeData("nodes").removeClass("ui-wijtree-list ui-helper-reset");c.children("li").each(function(){var c=b._getNodeWidget(a(this));c&&c.destroy()});a.Widget.prototype.destroy.apply(this)},add:function(c,d){var b=null,g=this.options;if(typeof c==="string"){var i="<li><a>{0}</a></li>",e=a(i.replace(/\{0\}/,c));this._createNodeWidget(e,g);b=e.data(e.data("widgetName"))}else if(c.jquery){!c.data("widgetName")&&this._createNodeWidget(c,g);b=c.data(c.data("widgetName"))}else if(c.nodeType){e=a(c);this._createNodeWidget(e,g);b=e.data(e.data("widgetName"))}if(b==null)return;var f=this._getField("nodes");if(!d&&d>f.length)d=f.length;b._setField("owner",this);var h=f.length;f.splice(d,0,b);if(h>0&&h!=d)b.element.get(0)!=f[d+1].element.get(0)&&b.element.insertBefore(f[d+1].element);else this.element.append(b.element);this._refreshNodesClass()},remove:function(b){var a=-1;if(b.jquery)a=b.index();else if(typeof b=="number")a=b;var c=this._getField("nodes");if(a<0&&a>=c.length)return;var d=c[a];d.element.detach();c.splice(a,1);this._refreshNodesClass()},findNodeByText:function(c){var b=a(".ui-wijtree-node a>span",this.element).filter(function(){return a(this).text()==c});return b.length?this._getNodeWidgetByDom(b.get(0)):null},_setAllowDrag:function(c){var b;if(c){b=this.element.find(":ui-wijtreenode");b.each(function(){var b=a(this).data("wijtreenode");if(!a(this).data("draggable")&&!b.$navigateUrl.data("events").mousedown)b.$navigateUrl.one("mousedown",b,b._onMouseDown)})}else{b=this.element.find(":ui-wijtreenode:ui-draggable");b.draggable("destroy")}},_setAllowDrop:function(a){if(a)!this.widgetDom.data("droppable")&&this._attachDroppable();else this.widgetDom.droppable&&this.widgetDom.droppable("destroy")},_setCheckBoxes:function(c){var b=this;b.element.children("li").each(function(){var d=b._getNodeWidget(a(this));d!=null&&d._setCheckBoxes(c)})},_setHitArea:function(c){var b=this;b.element.children("li").each(function(){var d=b._getNodeWidget(a(this));d!=null&&d._setHitArea(c)})},_getNodeWidget:function(a){return a.is(":ui-wijtreenode")?a.data(a.data("widgetName")):null},_getNodeWidgetByDom:function(b){var a=this._getNodeByDom(b);return this._getNodeWidget(a)},_getNodeByDom:function(b){return a(b).closest(":ui-wijtreenode")},_refreshNodesClass:function(){for(var b=this._getField("nodes"),a=0;a<b.length;a++){var c=b[a];c._initNodeClass()}},_getField:function(a){return this.element.data(a)},_setField:function(b,a){return this.element.data(b,a)}})})(jQuery);(function(a){a.widget("ui.wijtreenode",{options:{accessKey:"",checked:false,collapsedIconClass:"",expanded:false,expandedIconClass:"",itemIconClass:"",navigateUrl:"",selected:false,text:"",toolTip:""},_setOption:function(d,b){var c=this;switch(d){case"accessKey":this.$navigateUrl!=null&&this.$navigateUrl.attr("accesskey",b);case"checked":this._checkState=b?"checked":"unChecked";c._setChecked(b);break;case"collapsedIconClass":case"expandedIconClass":case"itemIconClass":this.options[d]=b;c._initNodeImg();break;case"expanded":c._setExpanded(b);break;case"selected":c._setSelected(b);break;case"text":c._setText(b);break;case"toolTip":this._setToolTip(b);break;case"navigateUrl":this._setNavigateUrlHref(b)}a.Widget.prototype._setOption.apply(c,arguments)},_initState:function(){this._tree=null,this._dropTarget=null;this._checkState="unChecked";this._value=this._text=this._navigateUrl="";this._insertPosition="unKnown";this._hasPotentialNodes=false},_create:function(){this._initState();this._createTreeNode();this._initNode();this.element.data("widgetName","wijtreenode")},_createTreeNode:function(){var b=this.element,c=this,d=[];this.$navigateUrl=b.children("a");if(this._tree==null)this._tree=this._getTree();this.$nodeBody=null,this.$checkBox=null,this.$nodeImage=a("<span>"),this.$hitArea=null,this.$nodes=null,this.$nodeBody=a("<div>");if(this._tree.options.showCheckBoxes===true)this.$checkBox=a("<div>");if(this.$navigateUrl.length==0){this.$navigateUrl=a("<a>");this.$navigateUrl.attr("href","#")}this.$text=this.$navigateUrl.find("span:eq(0)");if(this.$text.length==0){this.$navigateUrl.wrapInner("<span></span>");this.$text=this.$navigateUrl.find("span:eq(0)")}this._hasChildren=this._getChildren();this.$inner=a("<span class='ui-helper-clearfix ui-wijtree-inner ui-corner-all'></span>");if(this._hasChildren){b.addClass("ui-wijtree-parent");this.$nodeBody.addClass("ui-wijtree-node ui-wijtree-header ui-state-default");this.$hitArea=a("<span>");this.$inner.append(this.$navigateUrl);if(this.$checkBox!=null){this.$inner.prepend(this.$checkBox);this.$checkBox.wijtreecheck()}this.$inner.prepend(this.$nodeImage).prepend(this.$hitArea);this.$nodes=b.find("ul:eq(0)");this.$nodes.addClass("ui-wijtree-list ui-helper-reset ui-wijtree-child");this.$nodes.children().filter("li").each(function(f){var b=a(this);b.data("owner",c);b.wijtreenode(c.options);var e=c._getNodeWidget(b);e._index=f;d.push(e)})}else{b.addClass("ui-wijtree-item");this.$nodeBody.addClass("ui-wijtree-node ui-state-default");this.$inner.append(this.$navigateUrl);if(this.$checkBox!=null){this.$inner.prepend(this.$checkBox);this.$checkBox.wijtreecheck()}this.$inner.prepend(this.$nodeImage)}this.$nodeBody.append(this.$inner);this._setField("nodes",d);b.prepend(this.$nodeBody)},_initNodeClass:function(){var b=this,d=b.options,c="ui-icon "+(d.expanded?"ui-icon-triangle-1-se":"ui-icon-triangle-1-e");if(b._tree.options.showExpandCollapse)if(b._hasChildren)if(b.$hitArea!=null)b.$hitArea.removeClass("ui-icon ui-icon-triangle-1-se ui-icon-triangle-1-e").addClass(c);else{b.$hitArea=a("<span>").addClass(c).prependTo(b.$inner);b.element.removeClass("ui-wijtree-node ui-state-default ui-corner-all").addClass("ui-wijtree-parent")}else if(b.$hitArea){b.$hitArea.remove();b.$hitArea=null;b.element.removeClass("ui-wijtree-parent").addClass("ui-wijtree-node ui-state-default ui-corner-all")}},_initNode:function(){if(!this._initialized){this._initialized=true;this._initNodeImg();this._initNavigateUrl();this._text=this.$text.html();this._hasChildren=this._getChildren();this._initNodesUL();this._initNodeClass();this.$navigateUrl.one("mousedown",this,this._onMouseDown)}},_initNodesUL:function(){var a=this;if(a._tree.options.showExpandCollapse)a._hasChildren&&a.$nodes[a._expanded?"show":"hide"]()},_initNavigateUrl:function(){var a=this;a.$navigateUrl.bind("blur."+a.widgetName,a,a._onBlur);var b=a.$navigateUrl.attr("href");a._navigateUrl=!!b?b:"";a._setNavigateUrlHref(b)},_initNodeImg:function(){var b=this,c=this.options;if(this.$nodeImage==null||!this.$nodeImage.length)this.$nodeImage=a("<span>");if(b.options.collapsedIconClass!=""&&b.options.expandedIconClass!=""){this.$nodeImage.removeClass().addClass("ui-icon");this.$nodeImage.addClass(b._expanded?c.expandedIconClass:c.collapsedIconClass);!b._tree.options.showExpandCollapse&&this.$nodeImage.addClass(b.options.expandedIconClass);this.$nodeImage.insertBefore(this.$checkBox)}else if(b.options.itemIconClass!=""){this.$nodeImage.removeClass().addClass("ui-icon");this.$nodeImage.addClass(b.options.itemIconClass);this.$nodeImage.insertBefore(this.$checkBox)}},_setNavigateUrlHref:function(a){if(this.$navigateUrl){if(a===""||typeof a=="undefined")a="#";this.$navigateUrl.attr("href",a)}},_editNode:function(){this._tree._editMode=true;this.$navigateUrl.hide();if(!this.$editArea)this.$editArea=a("<input>").wijtextboxdecorator();this.$editArea.val(this.$text.html());this.$editArea.insertBefore(this.$navigateUrl);this.$editArea.bind("blur",this,this._editionComplete);this.$editArea.focus()},_editionComplete:function(b){var a=b.data;a._tree._editMode=false;if(a.$editArea){var c=a.$editArea.val();a.$editArea.remove()}a.$navigateUrl.show();a.$editArea=null;a._changeText(c)},_changeText:function(a){if(this.$text!=null&&a!=""){this.$text.text(a);this._tree._trigger("nodeTextChanged",this)}},_expandCollapseItem:function(){if(!this._tree.options.disabled)this._hasChildren&&this._setExpanded(!this._expanded)},_expandNode:function(a){if(!this._tree.options.disabled)if(a)if(this.options.expandDelay>0){if(typeof this._expandTimer!="undefined")this._expandTimer=window.clearTimeout(this._expandTimer);this._expandTimer=window.setTimeout(this._expandNodeVisually,this.options.expandDelay)}else this._expandNodeVisually();else if(this.options.collapseDelay>0){this._collapseTimer=window.clearTimeout(this._collapseTimer);this._collapseTimer=window.setTimeout(this._collapseNodeVisually,this.options.collapseDelay)}else this._collapseNodeVisually()},_expandNodeVisually:function(){var b=this;if(b._tree.options.autoCollapse){var c=b.element.siblings(":ui-wijtreenode");a.each(c,function(d){var a=b._getNodeWidget(c[d]);a._expanded&&a._setExpanded(false)})}b.options.collapsedIconClass!=""&&b.options.expandedIconClass!=""&&b.$nodeImage.removeClass(b.options.collapsedIconClass).addClass(b.options.expandedIconClass);b._internalSetNodeClass(true);b._show()},_collapseNodeVisually:function(){var a=this;a.options.collapsedIconClass!=""&&a.options.expandedIconClass!=""&&a.$nodeImage.removeClass(a.options.expandedIconClass).addClass(a.options.collapsedIconClass);a._internalSetNodeClass(false);a._hide()},_internalSetNodeClass:function(a){this.$hitArea.removeClass("ui-icon ui-icon-triangle-1-se ui-icon-triangle-1-e").addClass("ui-icon "+(a?"ui-icon-triangle-1-se":"ui-icon-triangle-1-e"))},_show:function(){this._animation(true)},_hide:function(){this._animation(false)},_animation:function(d){var b=this,e=b.$nodes;if(e){var c=d?"expandAnimation":"collapseAnimation",f=d?"nodeExpanded":"nodeCollapsed";if(a.effects&&!!b._tree.options[c].duration)e[d?"show":"hide"](b._tree.options[c].effect,{},b._tree.options[c].duration,function(){b._tree._trigger(f,null,b)});else e[d?"show":"hide"](b._tree.options[c].duration,function(){b._tree._trigger(f,null,b)})}},_getBounds:function(a){var b=a.height(),e=a.width(),d=a.offset().top,c=a.offset().left;return{h:b,w:e,t:d,l:c}},_isMouseInsideRect:function(b,a){return b.x<a.l||b.x>=a.l+a.w?false:b.y<=a.t+1||b.y>=a.t+a.h?false:true},_getNodeByMouseOn:function(b){a("li").each(function(){var c=this._getBounds(a(this));if(a.ui.isOver(b.y,b.x,c.t,c.l,c.h,c.w))return a(this)});return null},_drowTemplate:function(b,e,d){var f=d.is(".ui-wijtree-node")?d:d.children(".ui-wijtree-node");e.width(f.width());var c="unKnown",a=this._getBounds(f);if(b.y>a.t&&b.y<a.t+a.h/2){e.offset({left:a.l,top:a.t});c="before"}else if(b.y>a.t+a.h/2&&b.y<a.t+a.h){e.offset({left:a.l,top:a.t+a.h});c="after"}return c},_beginDrag:function(d){var b=this,c=b.element;this._insertionTemplate=a("<div>").addClass("ui-wijtree-insertion ui-state-default").hide();c.draggable({cursor:"point",cursorAt:{top:15,left:-25},helper:function(){return a("<div class='ui-widget-header ui-corner-all'>"+b.$text.html()+"</div>")},start:function(a){b._tree._isDragging=true;b._tree._trigger("nodeDragStarted",a,b);b._tree.widgetDom.prepend(b._insertionTemplate);c.hide()},distance:a.browser.msie?1:10,handle:b.$navigateUrl,scope:"tree",drag:function(c){b._insertionTemplate&&b._insertionTemplate.hide();var g=c.srcElement||c.originalTarget,e=a(g);if(e){var d=b._getNodeWidget(e);if(d)if(e.closest(".ui-wijtree-inner",b.element).length){b._dropTarget=d;b._insertPosition="end"}else{var f={x:c.pageX,y:c.pageY};b._insertionTemplate.show();b._insertPosition=b._drowTemplate(f,b._insertionTemplate,d.element);b._dropTarget=d}}b._tree._trigger("nodeDragging",c,b)},stop:function(){c.show();b._insertionTemplate.remove();b._dropTarget=null;b._insertPosition="unKnown";b._tree._isDragging=false;b._resetDrag()}}).trigger(d);a.browser.mozilla&&b._setFocused(true)},_resetDrag:function(){var a=this;!a._tree.options.allowDrag&&a.element.data("draggable")&&a.element.draggable("destroy");for(var c=a._getField("nodes"),b=0;b<c.length;b++)c[b]._resetDrag()},_checkClick:function(){if(!this._tree.options.disabled)if(this._checked&&this._checkState==="indeterminate"){this._checkState="checked";this._checkItem()}else{var a=this._checked;this._checkState=a?"unChecked":"checked";this._setChecked(!a)}},_checkItem:function(){var b=this;if(this._tree==null||!this._tree.options.showCheckBoxes)return;var a=false;if(this._tree.options.autoCheckNodes&&b._checkState!="indeterminate"){a=true;this._changeCheckState(this._checked)}this._tree.options.allowTriState&&this._setParentCheckState();this._checked?this._checkNode(a):this._unCheckNode(a);this._tree._trigger("nodeCheckChanged",null,this)},_checkNode:function(c){if(this._checkState==="checked")this.$checkBox.wijtreecheck("option","checkState","check");else this._checkState=="indeterminate"&&this.$checkBox.wijtreecheck("option","checkState","triState");var b=this._getField("nodes");if(c)for(var a=0;a<b.length;a++)b[a]._checkNode(true)},_unCheckNode:function(c){this.$checkBox.wijtreecheck("option","checkState","unCheck");var b=this._getField("nodes");if(c)for(var a=0;a<b.length;a++)b[a]._unCheckNode(true)},_changeCheckState:function(a){for(var d=this._getField("nodes"),c=0;c<d.length;c++){var b=d[c];b._checked=a;b.options.checked=a;b._checkState=a?"checked":"unChecked";b._changeCheckState(a)}},_setParentCheckState:function(){var a=this._getOwner();if(a.element.is(":ui-wijtree"))return;for(var e=a._getField("nodes"),d=true,c=false,f=false,b=0;b<e.length;b++){if(e[b]._checkState=="indeterminate")f=true;e[b]._checked?(c=true):(d=false);if(!d&&c)break}if(f){a._checkState="indeterminate";a._setChecked(true)}else if(c){if(d){a._checkState="checked";a._checkNode(false)}else a._checkState="indeterminate";a._setChecked(true)}else{a._checkState="unChecked";a._setChecked(false);a._unCheckNode(false)}a._setParentCheckState()},_onKeyDown:function(b){var d=a(b.target),c=this;d.closest(".ui-wijtree-inner",c.element).length>0&&c._keyAction(b)},_onClick:function(b){var d=a(b.target),c=this;if(d.closest(".ui-checkbox",c.element).length>0){c._checkClick(b);b.preventDefault();b.stopPropagation()}else if(d.hasClass("ui-icon-triangle-1-se")||d.hasClass("ui-icon-triangle-1-e")){c._expandCollapseItem(b);b.preventDefault();b.stopPropagation()}else d.closest(".ui-wijtree-inner",c.element).length>0&&c._click(b)},_onMouseDown:function(b){var d=a(b.target),c=b.data;if(c._tree.options.allowDrag)d.closest(".ui-wijtree-node",c.element).length>0&&c._beginDrag(b)},_onMouseOver:function(c){var e=a(c.target),b=this,d=a(c.relatedTarget);if(e.closest(".ui-wijtree-inner",b.element).length>0&&(this._tree._overNode!=b||d.is(":ui-wijtreenode"))){b._mouseOver(c);this._tree._overNode=b}b._mouseOverHitArea(c)},_onMouseOut:function(b){var f=a(b.target),c=this,e=a(b.relatedTarget),d=this._getNodeWidget(e);if(f.closest(".ui-wijtree-inner",c.element).length>0&&(this._tree._overNode!=d||e.is(":ui-wijtreenode"))){c._mouseOut(b);if(!d)this._tree._overNode=null}c._mouseOutHitArea(b)},_onFocus:function(c){var d=a(c.target),b=this;if(d.closest("a",b.element).length>0&&!this._tree.options.disabled){b._tree._focusNode&&b._tree._focusNode.$navigateUrl.blur();b._focused=true;b._tree._focusNode=this;b.$inner.addClass("ui-state-focus")}},_onBlur:function(c){var d=a(c.target),b=c.data;if(!b._tree.options.disabled){b._focused=false;d.closest("a",b.element).length>0&&b.$inner.removeClass("ui-state-focus");b._tree._trigger("nodeBlur",c,b)}},_click:function(a){if(!this._tree.options.disabled){if(!/^[#,\s]*$/.test(this._navigateUrl))return;this._isClick=true;this._tree._ctrlKey=a.ctrlKey;if(this._selected&&this._tree._ctrlKey)this._setSelected(false);else if(this._selected&&this._tree.options.allowEdit)this._editNode();else this._setSelected(!this._selected);a.preventDefault();a.stopPropagation()}else this._setNavigateUrlHref("")},_selectNode:function(d,e){if(!this._tree.options.disabled&&!this._tree._isDragging){var f=this._tree._ctrlKey,b;if(f){b=a.inArray(this,this._tree._selectedNodes);if(b!=-1&&!d){this._tree._selectedNodes.splice(b,1);this.$inner.removeClass("ui-state-active")}}else{for(var c=0;c<this._tree._selectedNodes.length;c++){this._tree._selectedNodes[c].$inner.removeClass("ui-state-active");this._tree._selectedNodes[c].options.selected=false;this._tree._selectedNodes[c]._selected=false}this._tree._selectedNodes=[]}if(d){b=a.inArray(this,this._tree._selectedNodes);b==-1&&this._tree._selectedNodes.push(this);this.$inner.addClass("ui-state-active")}else this.$inner.removeClass("ui-state-active");this._isClick&&this._tree._trigger("nodeClick",e,this);this._tree._ctrlKey=false;this._tree._trigger("selectedNodeChanged",e,this)}},_keyAction:function(b){if(this._tree.options.disabled)return;var c=b.target;if(c){if(this._tree._editMode&&b.keyCode!=a.ui.keyCode.ENTER)return;switch(b.keyCode){case a.ui.keyCode.UP:this._moveUp();break;case a.ui.keyCode.DOWN:this._moveDown();break;case a.ui.keyCode.RIGHT:this._tree.options.showExpandCollapse&&this._moveRight();break;case a.ui.keyCode.LEFT:this._tree.options.showExpandCollapse&&this._moveLeft();break;case 83:!this._tree._editMode&&this._tree.options.allowSorting&&this.sortNodes();break;case 113:this._tree.options.allowEdit&&this._editNode();break;case 109:this._tree.options.showExpandCollapse&&this._expanded&&this._setExpanded(false);break;case 107:this._tree.options.showExpandCollapse&&!this._expanded&&this._setExpanded(true);break;case a.ui.keyCode.ENTER:if(this._tree._editMode){b.data=this;this._editionComplete(b)}break;case a.ui.keyCode.SPACE:if(this._tree.options.showCheckBoxes){this._checkState=this._checked?"unChecked":"checked";this._setChecked(!this._checked)}}b.preventDefault();b.stopPropagation()}},_prevNode:function(a){if(a.element.prev().length>0)return a.element.prev().data("wijtreenode")},_nextNode:function(a){if(a.element.next().length>0)return a.element.next().data("wijtreenode")},_getNextExpandedNode:function(b){var c=b,a=b._getField("nodes");if(b._expanded&&a.length>0){var d=a[a.length-1];if(d!=null)c=this._getNextExpandedNode(d)}return c},_getNextNode:function(b){var a=null;if(b.element.is(":ui-wijtree"))return null;a=this._nextNode(b);return a?a:this._getNextNode(b._getOwner())},_moveUp:function(){var b=this._getCurrentLevel(),a=this._prevNode(this);if(!a)b>0&&this._getOwner()._setFocused(true);else this._getNextExpandedNode(a)._setFocused(true)},_moveDown:function(){var c=this._getField("nodes");if(this._expanded&&c.length>0)c[0]._setFocused(true);else{var b=this._nextNode(this);if(b!=null)b._setFocused(true);else{var d=this._getOwner(),a=this._getNextNode(d);a!=null&&a._setFocused(true)}}},_moveLeft:function(){if(this._expanded)this._setExpanded(false);else if(this._getOwner()._getOwner()!=null){var a=this._getOwner();a._setFocused(true)}},_moveRight:function(){if(this._hasChildren)if(!this._expanded)this._setExpanded(true);else{var a=this._getField("nodes")[0];a!=null&&a._setFocused(true)}},_mouseOver:function(a){if(!this._tree.options.disabled&&!this._tree._editMode){this._mouseOverNode();!this._tree._isDragging&&this._tree._trigger("nodeMouseOver",a,this)}},_mouseOut:function(a){if(!this._tree.options.disabled&&!this._tree._editMode){this._mouseOutNode();!this._tree._isDragging&&this._tree._trigger("nodeMouseOut",a,this)}},_mouseOverNode:function(){if(this.$inner!=null&&!this._isOverNode){this.$inner.addClass("ui-state-hover");this._isOverNode=true}},_mouseOutNode:function(){if(this.$inner!=null&&this._isOverNode){this.$inner.removeClass("ui-state-hover");this._isOverNode=false}},_mouseOverHitArea:function(a){if(!this._tree.options.disabled)if(this._tree.options.expandCollapseHoverUsed)if(this._hasChildren&&!this._isOverHitArea){var b=this._getBounds(this.element),c={x:a.pageX,y:a.pageY};if(this._isMouseInsideRect(c,b)){this._isOverHitArea=true;this._setExpanded(true)}}},_mouseOutHitArea:function(b){if(!this._tree.options.disabled)if(this._tree.options.expandCollapseHoverUsed){var c={x:b.pageX,y:b.pageY},a;if(this._hasChildren&&!!this._isOverHitArea){a=this._getBounds(this.element);if(!this._isMouseInsideRect(c,a)){this._isOverHitArea=false;this._setExpanded(false)}}else if(this._getOwner().element.is(":ui-wijtreenode")){a=this._getBounds(this._getOwner().element);if(!this._isMouseInsideRect(c,a)){this._getOwner()._isOverHitArea=false;this._getOwner()._setExpanded(false)}}}},destroy:function(){var b=this;b.element.data("draggable")&&b.element.draggable("destroy");b.$hitArea&&b.$hitArea.remove();b.$checkBox&&b.$checkBox.remove();b.$nodeImage&&b.$nodeImage.remove();b.$navigateUrl.unwrap().unwrap().removeClass("ui-state-default ui-state-active").unbind("mousedown").unbind("blur");var c=this.element.find("ul:first").show();c.removeClass();c.children("li").each(function(){var c=b._getNodeWidget(a(this));c.destroy()});b.element.removeData("nodes").removeData("owner").removeData("widgetName").removeClass();a.Widget.prototype.destroy.apply(this)},add:function(c,d){var b=null;if(typeof c=="string"){var h="<li><a>{0}</a></li>",e=a(h.replace(/\{0\}/,c));this._createNodeWidget(e);b=e.data(e.data("widgetName"))}else if(c.jquery){!c.data("widgetName")&&this._createNodeWidget(c);b=c.data(c.data("widgetName"))}else if(c.nodeType){e=a(c);this._createNodeWidget(e);b=e.data(e.data("widgetName"))}if(b==null)return;var f=this._getField("nodes");if(!d||d>f.length)if(d!=0)d=f.length;b._setField("owner",this);var g=f.length;if(!this.$nodes){this.$nodes=a("<ul class='ui-wijtree-list ui-helper-reset ui-wijtree-child'></ul>");this.element.append(this.$nodes)}if(g>0&&g!=d)b.element.get(0)!=f[d].element.get(0)&&b.element.insertBefore(f[d].element);else this.$nodes.append(b.element);f.splice(d,0,b);this._collectionChanged("add")},remove:function(b){var a=-1;if(b.jquery)a=b.index();else if(typeof b=="number")a=b;var c=this._getField("nodes");if(a<0&&a>=c.length)return;var d=c[a];d.element.detach();c.splice(a,1);this._collectionChanged("remove")},sortNodes:function(){this._sort();for(var c=this._getField("nodes"),a=0;a<c.length;a++){var b=c[a];b._index=a;b._insertBefore(a)}this._refreshNodesClass()},check:function(a){this._setOption("checked",a)},select:function(a){this._setOption("selected",a)},expand:function(){this._setOption("expanded",true)},collapse:function(){this._setOption("expanded",false)},_insertBefore:function(a){var b=this.element.parent().children("li");this.element.index()!=a&&this.element.insertBefore(b.eq(a))},_sort:function(){var a=this._getField("nodes");if(this._isSorted)if(!this._isDecsSort){a.sort(this._compare2NodeTextAcs);this._isDecsSort=true}else{a.sort(this._compare2NodeTextDesc);this._isDecsSort=false}else{a.sort(this._compare2NodeTextAcs);this._isSorted=true;this._isDecsSort=true}},_compare2NodeTextAcs:function(a,b){if(a!=null&&b!=null)return a._text.localeCompare(b._text)},_compare2NodeTextDesc:function(a,b){if(a!=null&&b!=null)return-1*a._text.localeCompare(b._text)},_collectionChanged:function(){this._hasChildren=this._getChildren();this._initNodeClass();this._refreshNodesClass()},_refreshNodesClass:function(){for(var b=this._getField("nodes"),a=0;a<b.length;a++){var c=b[a];c._initNodeClass()}},_setChecked:function(b){var a=this;if(a._checked==b&&a._checkState!="indeterminate")return;a._checked=b;a.options.checked=b;this._checkItem()},_setExpanded:function(a){var b=this;if(b._expanded==a)return;if(b._hasChildren){b._expanded=a;b.options.expanded=a;this._expandNode(a)}},_setFocused:function(a){if(a)this.$navigateUrl.focus();else this.$navigateUrl.blur()},_setToolTip:function(a){if(a.length)this.element.attr("title",a);else this.element.removeAttr("title")},_setText:function(a){if(this._text!=a&&a.length){this._text=a;this._changeText(a)}},_setSelected:function(a){if(this.options.selected!=a){this._selected=a;this.options.selected=a;this._selectNode(a)}},_setCheckBoxes:function(c){var b=this;b.$checkBox&&b.$checkBox[c?"show":"hide"]();b.$nodes&&b.$nodes.children("li").each(function(){var d=b._getNodeWidget(a(this));d!=null&&d._setCheckBoxes(c)})},_setHitArea:function(c){var b=this;if(this._hasChildren)if(c){this._initNodeClass();this.$hitArea&&this.$hitArea.show()}else{this._expanded=true;this.options.expanded=true;this.$nodes&&this.$nodes.show();this._initNodeClass();this.$hitArea&&this.$hitArea.hide()}b.$nodes&&b.$nodes.children("li").each(function(){var d=b._getNodeWidget(a(this));d!=null&&d._setHitArea(c)})},_getOwner:function(){return this._getField("owner")},_getTree:function(){var a=this._getOwner();return a?a.element.is(":ui-wijtree")?a:a._getTree():null},_getChildren:function(){return this.element.children("ul:first").children("li").length>0&&this.element.children("ul:first")},_getNodeWidget:function(c){var a=this._getNodeByDom(c);return a.length>0?a.data(a.data("widgetName")):null},_createNodeWidget:function(b,c){if(a.fn.wijtreenode){b.data("owner",this);b.wijtreenode(c)}return b},_getNodeByDom:function(b){return a(b).closest(":ui-wijtreenode")},_getCurrentLevel:function(){return this.element.parentsUntil(":ui-wijtree").length-1},_getField:function(a){return this.element.data(a)},_setField:function(b,a){return this.element.data(b,a)}})})(jQuery);(function(a){var c="ui-icon ui-icon-check",b="ui-icon ui-icon-stop";a.widget("ui.wijtreecheck",{options:{checkState:"unCheck"},_create:function(){var b=this,c=this.options;if(b.element.is("div")){b.element.addClass("ui-checkbox ui-widget");b.$icon=a("<span>");b.$icon.addClass("ui-checkbox-icon");if(c.checkState=="check")b.$icon.addClass("ui-icon ui-icon-check");else c.checkState=="triState"&&b.$icon.addClass("ui-icon ui-icon-stop");b.$body=a('<div class="ui-checkbox-box ui-widget ui-corner-all ui-state-default"></div>').css({position:"relative"}).append(b.$icon);b.element.append(b.$body);b.element.bind("mouseover.wijtreecheck",function(){!b.options.disabled&&b.$body.removeClass("ui-state-default").addClass("ui-state-hover")}).bind("mouseout.wijtreecheck",function(){!b.options.disabled&&b.$body.removeClass("ui-state-hover").not(".ui-state-focus").addClass("ui-state-default")})}},_setOption:function(e,a){var d=this;if(e=="checkState")if(a=="unCheck")d.$icon.removeClass("ui-icon ui-icon-check ui-icon-stop");else if(a=="check")d.$icon.removeClass(b).addClass(c);else a=="triState"&&d.$icon.removeClass(c).addClass(b)},destory:function(){this.element.children().remove();this.element.removeClass("ui-checkbox ui-widget");a.Widget.prototype.destroy.apply(this)}})})(jQuery);