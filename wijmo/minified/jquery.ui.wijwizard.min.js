/*
 *
 * Wijmo Library 0.8.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){a.widget("ui.wijwizard",{options:{navButtons:"auto",autoPlay:false,delay:3e3,loop:false,hideOption:{fade:true},showOption:{fade:true,duration:400},ajaxOptions:null,cache:false,cookie:null,load:null,stepHeaderTemplate:'<li><h1>"#{title}"</h1>"#{desc}"</li>',panelTemplate:"<div></div>",spinner:"<em>Loading&#8230;</em>",add:null,remove:null,show:null,validating:null},_create:function(){this._pageLize(true)},_init:function(){var a=this.options;a.autoPlay&&this.play()},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments);switch(c){case"activeIndex":this.show(b);break;default:this._pageLize()}},play:function(){var b=this.options,a=this;if(!this.element.data("intId.wijwizard")){var c=window.setInterval(function(){var c=b.activeIndex+1;if(c>=a.panels.length)if(b.loop)c=0;else{a.stop();return}a.show(c)},b.delay);this.element.data("intId.wijwizard",c)}},stop:function(){var a=this.element.data("intId.wijwizard");if(a){window.clearInterval(a);this.element.removeData("intId.wijwizard")}},_normalizeBlindOption:function(a){if(a.blind===undefined)a.blind=false;if(a.fade===undefined)a.fade=false;if(a.duration===undefined)a.duration=200;if(typeof a.duration=="string")try{a.duration=parseInt(a.duration)}catch(b){a.duration=200}},_createButtons:function(){var d=this,f=this.options;if(f.navButtons==="none"){this._removeButtons();return}if(!this.buttons){var e=f.navButtons;if(e==="auto")e=this.list?"common":"edge";this.buttons=a("<div/>");this.buttons.addClass("ui-wijwizard-buttons");var c=function(b,a){a.is(":not(.ui-state-disabled)")&&a.addClass("ui-state-"+b)},b=function(a,b){b.removeClass("ui-state-"+a)};if(e==="common"){this.backBtn=a("<a href='#'><span class='ui-button-text'>back</span></a>").addClass("ui-widget ui-button ui-button-text-only ui-state-default ui-corner-all").appendTo(this.buttons).bind({click:function(){d.back()},mouseover:function(){c("hover",a(this))},mouseout:function(){b("hover",a(this))},mousedown:function(){c("active",a(this))},mouseup:function(){b("active",a(this))}});this.nextBtn=a("<a href='#'><span class='ui-button-text'>next</span></a>").addClass("ui-widget ui-button ui-button-text-only ui-state-default ui-corner-all").appendTo(this.buttons).bind({click:function(){d.next()},mouseover:function(){c("hover",a(this))},mouseout:function(){b("hover",a(this))},mousedown:function(){c("active",a(this))},mouseup:function(){b("active",a(this))}})}else{this.backBtn=a("<a href='#'/>").addClass("ui-wijwizard-prev ui-state-default ui-corner-right").append("<span class='ui-icon ui-icon-triangle-1-w'></span>").appendTo(this.buttons).bind({click:function(){d.back()},mouseover:function(){c("hover",a(this))},mouseout:function(){b("hover",a(this))},mousedown:function(){c("active",a(this))},mouseup:function(){b("active",a(this))}});this.nextBtn=a("<a href='#'/>").addClass("ui-wijwizard-next ui-state-default ui-corner-left").append("<span class='ui-icon ui-icon-triangle-1-e'></span>").appendTo(this.buttons).bind({click:function(){d.next()},mouseover:function(){c("hover",a(this))},mouseout:function(){b("hover",a(this))},mousedown:function(){c("active",a(this))},mouseup:function(){b("active",a(this))}})}this.buttons.appendTo(this.element)}},_removeButtons:function(){if(this.buttons){this.buttons.remove();this.buttons=undefined}},_pageLize:function(d){var e=this,b=this.options;if(d){this.list=this.element.find("ol,ul").eq(0);if(this.list&&this.list.length==0)this.list=null;if(this.list)this.lis=a("li",this.list);this.panels=a("> div",this.element);var c=/^#.+/;this.panels.each(function(e,d){var b=a(d).attr("url");b&&!c.test(b)&&a.data(d,"load.wijwizard",b.replace(/#.*$/,""))});this.element.addClass("ui-wijwizard ui-widget ui-helper-clearfix");if(this.list){this.list.addClass("ui-widget ui-helper-reset ui-wijwizard-steps ui-helper-clearfix");this.lis.addClass("ui-widget-header ui-corner-all")}this.container=a("<div/>");this.container.addClass("ui-wijwizard-content ui-widget ui-widget-content ui-corner-all");this.container.append(this.panels);this.container.appendTo(this.element);this.panels.addClass("ui-wijwizard-panel ui-widget-content");if(b.activeIndex===undefined){if(typeof b.activeIndex!="number"&&b.cookie)b.activeIndex=parseInt(e._cookie(),10);if(typeof b.activeIndex!="number"&&this.panels.filter(".ui-wijwizard-actived").length)b.activeIndex=this.panels.index(this.panels.filter(".ui-wijwizard-actived"));b.activeIndex=b.activeIndex||(this.panels.length?0:-1)}else if(b.activeIndex===null)b.activeIndex=-1;b.activeIndex=b.activeIndex>=0&&this.panels[b.activeIndex]||b.activeIndex<0?b.activeIndex:0;this.panels.addClass("ui-wijwizard-hide");if(b.activeIndex>=0&&this.panels.length){this.panels.eq(b.activeIndex).removeClass("ui-wijwizard-hide").addClass("ui-wijwizard-actived");this.load(b.activeIndex)}this._createButtons()}else b.activeIndex=this.panels.index(this.panels.filter(".ui-wijwizard-actived"));this._refreshStep();this._initScroller();b.cookie&&this._cookie(b.activeIndex,b.cookie);b.cache===false&&this.panels.removeData("cache.wijwizard");if(b.showOption===undefined||b.showOption===null)b.showOption={};this._normalizeBlindOption(b.showOption);if(b.hideOption===undefined||b.hideOption===null)b.hideOption={};this._normalizeBlindOption(b.hideOption);this.panels.unbind(".wijwizard")},_initScroller:function(){if(!this.lis)return;var b=0;this.lis.each(function(){b+=a(this).outerWidth(true)});if(this.element.innerWidth()<b){if(this.scrollWrap==undefined){this.list.wrap("<div class='scrollWrap'></div>");this.scrollWrap=this.list.parent();a.effects.save(this.list,["width","height","overflow"])}this.list.width(b+8);this.scrollWrap.height(this.list.outerHeight(true));this.scrollWrap.wijsuperpanel({allowResize:false,hScroller:{scrollBarVisibility:"hidden"},vScroller:{scrollBarVisibility:"hidden"}})}else this._removeScroller()},_removeScroller:function(){if(this.scrollWrap){this.scrollWrap.wijsuperpanel("destroy").replaceWith(this.scrollWrap.contents());this.scrollWrap=undefined;a.effects.restore(this.list,["width","height","overflow"])}},_refreshStep:function(){var a=this.options;if(this.lis){this.lis.removeClass("ui-priority-primary").addClass("ui-priority-secondary");if(a.activeIndex>=0&&a.activeIndex<=this.lis.length-1){this.lis&&this.lis.eq(a.activeIndex).removeClass("ui-priority-secondary").addClass("ui-priority-primary");this.scrollWrap&&this.scrollWrap.wijsuperpanel("scrollChildIntoView",this.lis.eq(a.activeIndex))}}if(this.buttons&&!a.loop){this.backBtn[a.activeIndex==0?"addClass":"removeClass"]("ui-state-disabled");this.nextBtn[a.activeIndex>=this.panels.length-1?"addClass":"removeClass"]("ui-state-disabled")}},_sanitizeSelector:function(a){return a.replace(/:/g,"\\:")},_cookie:function(){var b=this.cookie||(this.cookie=this.options.cookie.name);return a.cookie.apply(null,[b].concat(a.makeArray(arguments)))},_ui:function(a){return{panel:a,index:this.panels.index(a)}},_removeSpinner:function(){this.element.removeClass("ui-state-processing");var a=this.element.data("spinner.wijwizard");if(a){this.element.removeData("spinner.wijwizard");a.remove()}},_resetStyle:function(b){b.css({display:""});!a.support.opacity&&b[0].style.removeAttribute("filter")},destroy:function(){var b=this.options;this.abort();this.stop();this._removeScroller();this._removeButtons();this.element.unbind(".wijwizard").removeClass(["ui-wijwizard","ui-widget","ui-helper-clearfix"].join(" ")).removeData("wijwizard");this.list&&this.list.removeClass("ui-widget ui-helper-reset ui-wijwizard-steps ui-helper-clearfix");if(this.lis){this.lis.removeClass("ui-widget-header ui-corner-all ui-priority-primary ui-priority-secondary");this.lis.each(function(){a.data(this,"destroy.wijwizard")&&a(this).remove()})}this.panels.each(function(){var b=a(this).unbind(".wijwizard");a.each(["load","cache"],function(c,a){b.removeData(a+".wijwizard")});if(a.data(this,"destroy.wijwizard"))a(this).remove();else a(this).removeClass(["ui-state-default","ui-wijwizard-actived","ui-state-active","ui-state-hover","ui-state-focus","ui-state-disabled","ui-wijwizard-panel","ui-widget-content","ui-wijwizard-hide"].join(" ")).css({position:"",left:"",top:""})});this.container.replaceWith(this.container.contents());b.cookie&&this._cookie(null,b.cookie);return this},add:function(b,e,h){if(b===undefined)b=this.panels.length;if(e==undefined)e="Step "+b;var f=this,g=this.options,c=a(g.panelTemplate).data("destroy.wijwizard",true);c.addClass("ui-wijwizard-panel ui-widget-content ui-corner-all ui-wijwizard-hide");if(b>=this.panels.length)if(this.panels.length>0)c.insertAfter(this.panels[this.panels.length-1]);else c.appendTo(this.list[0].parentNode);else c.insertBefore(this.panels[b]);if(this.list&&this.lis){var d=a(g.stepHeaderTemplate.replace(/#\{title\}/g,e).replace(/#\{desc\}/g,h));d.addClass("ui-widget-header ui-corner-all").data("destroy.wijwizard",true);if(b>=this.lis.length)d.appendTo(this.list);else d.insertBefore(this.lis[b])}this._pageLize();if(this.panels.length==1){g.activeIndex=0;d.addClass("ui-priority-primary");c.removeClass("ui-wijwizard-hide");this.element.queue("wijwizard",function(){f._trigger("show",null,f._ui(f.panels[0]))});this.load(0)}this._trigger("add",null,this._ui(this.panels[b]));return this},remove:function(a){var b=this.panels.eq(a).remove();this.lis&&this.lis.eq(a).remove();b.hasClass("ui-wijwizard-actived")&&this.panels.length>1&&this.show(a+(a+1<this.panels.length?1:-1));this._pageLize();this._trigger("remove",null,this._ui(b[0]));return this},_showPanel:function(f){var e=this,b=this.options,c=a(f);c.addClass("ui-wijwizard-actived");if((b.showOption.blind||b.showOption.fade)&&b.showOption.duration>0){var d={duration:b.showOption.duration};if(b.showOption.blind)d.height="toggle";if(b.showOption.fade)d.opacity="toggle";c.hide().removeClass("ui-wijwizard-hide").animate(d,b.showOption.duration||"normal",function(){e._resetStyle(c);e._trigger("show",null,e._ui(c[0]))})}else{c.removeClass("ui-wijwizard-hide");this._trigger("show",null,this._ui(c[0]))}},_hidePanel:function(f){var e=this,b=this.options,c=a(f);c.removeClass("ui-wijwizard-actived");if((b.hideOption.blind||b.hideOption.fade)&&b.hideOption.duration>0){var d={duration:b.hideOption.duration};if(b.hideOption.blind)d.height="toggle";if(b.hideOption.fade)d.opacity="toggle";c.animate(d,b.hideOption.duration||"normal",function(){c.addClass("ui-wijwizard-hide");e._resetStyle(c);e.element.dequeue("wijwizard")})}else{c.addClass("ui-wijwizard-hide");this.element.dequeue("wijwizard")}},show:function(b){if(b<0||b>=this.panels.length)return this;if(this.element.queue("wijwizard").length>0)return this;var g=this,c=this.options,d=a.extend({},this._ui(this.panels[c.activeIndex]));d.nextIndex=b;d.nextPanel=this.panels[b];this._trigger("validating",d);if(d.cancel)return this;var e=this.panels.filter(":not(.ui-wijwizard-hide)"),f=this.panels.eq(b);c.activeIndex=b;this.abort();c.cookie&&this._cookie(c.activeIndex,c.cookie);this._refreshStep();if(f.length){e.length&&this.element.queue("wijwizard",function(){g._hidePanel(e)});this.element.queue("wijwizard",function(){g._showPanel(f)});this.load(b)}else throw"jQuery UI wijwizard: Mismatching fragment identifier.";return this},next:function(){var b=this.options,a=b.activeIndex+1;if(b.loop)a=a%this.panels.length;if(a<this.panels.length){this.show(a);return true}return false},back:function(){var b=this.options,a=b.activeIndex-1;if(b.loop)a=a<0?this.panels.length-1:a;if(a>=0){this.show(a);return true}return false},load:function(f){var b=this,d=this.options,e=this.panels.eq(f)[0],g=a.data(e,"load.wijwizard");this.abort();if(!g||this.element.queue("wijwizard").length!==0&&a.data(e,"cache.wijwizard")){this.element.dequeue("wijwizard");return}this.element.addClass("ui-state-processing");if(d.spinner){var c=this.element.data("spinner.winwizard");if(!c){c=a("<div/>");c.addClass("ui-wijwizard-spinner");c.html(d.spinner);c.appendTo(document.body);this.element.data("spinner.winwizard",c);c.wijpopup({showEffect:"blind",hideEffect:"blind"})}c.wijpopup("show",{of:this.element,my:"center center",at:"center center"})}this.xhr=a.ajax(a.extend({},d.ajaxOptions,{url:g,success:function(c,g){a(e).html(c);b._removeSpinner();d.cache&&a.data(e,"cache.wijwizard",true);b._trigger("load",null,b._ui(b.panels[f]));try{d.ajaxOptions.success(c,g)}catch(h){}},error:function(a,c){b._removeSpinner();b._trigger("load",null,b._ui(b.panels[f]));try{d.ajaxOptions.error(a,c,f,e)}catch(g){}}}));b.element.dequeue("wijwizard");return this},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("wijwizard",this.element.queue("wijwizard").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr}this._removeSpinner();return this},url:function(a,b){this.panels.eq(a).removeData("cache.wijwizard").data("load.wijwizard",b);return this},count:function(){return this.panels.length}})})(jQuery);